var Mr=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var kl=Mr((H,de)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const cn=n=>+n;function Rr(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Gt="http://www.w3.org/1999/xhtml";const fn={svg:"http://www.w3.org/2000/svg",xhtml:Gt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function _t(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),fn.hasOwnProperty(e)?{space:fn[e],local:n}:n}function Fr(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Gt&&e.documentElement.namespaceURI===Gt?e.createElement(n):e.createElementNS(t,n)}}function Tr(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function qn(n){var e=_t(n);return(e.local?Tr:Fr)(e)}function Sr(){}function nn(n){return n==null?Sr:function(){return this.querySelector(n)}}function Pr(n){typeof n!="function"&&(n=nn(n));for(var e=this._groups,t=e.length,r=new Array(t),o=0;o<t;++o)for(var a=e[o],i=a.length,s=r[o]=new Array(i),l,u,h=0;h<i;++h)(l=a[h])&&(u=n.call(l,l.__data__,h,a))&&("__data__"in l&&(u.__data__=l.__data__),s[h]=u);return new K(r,this._parents)}function zr(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function Nr(){return[]}function Yn(n){return n==null?Nr:function(){return this.querySelectorAll(n)}}function Or(n){return function(){return zr(n.apply(this,arguments))}}function Dr(n){typeof n=="function"?n=Or(n):n=Yn(n);for(var e=this._groups,t=e.length,r=[],o=[],a=0;a<t;++a)for(var i=e[a],s=i.length,l,u=0;u<s;++u)(l=i[u])&&(r.push(n.call(l,l.__data__,u,i)),o.push(l));return new K(r,o)}function Xn(n){return function(){return this.matches(n)}}function Zn(n){return function(e){return e.matches(n)}}var Ur=Array.prototype.find;function Lr(n){return function(){return Ur.call(this.children,n)}}function Qr(){return this.firstElementChild}function Gr(n){return this.select(n==null?Qr:Lr(typeof n=="function"?n:Zn(n)))}var jr=Array.prototype.filter;function Vr(){return Array.from(this.children)}function Wr(n){return function(){return jr.call(this.children,n)}}function Hr(n){return this.selectAll(n==null?Vr:Wr(typeof n=="function"?n:Zn(n)))}function qr(n){typeof n!="function"&&(n=Xn(n));for(var e=this._groups,t=e.length,r=new Array(t),o=0;o<t;++o)for(var a=e[o],i=a.length,s=r[o]=[],l,u=0;u<i;++u)(l=a[u])&&n.call(l,l.__data__,u,a)&&s.push(l);return new K(r,this._parents)}function Kn(n){return new Array(n.length)}function Yr(){return new K(this._enter||this._groups.map(Kn),this._parents)}function ht(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}ht.prototype={constructor:ht,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function Xr(n){return function(){return n}}function Zr(n,e,t,r,o,a){for(var i=0,s,l=e.length,u=a.length;i<u;++i)(s=e[i])?(s.__data__=a[i],r[i]=s):t[i]=new ht(n,a[i]);for(;i<l;++i)(s=e[i])&&(o[i]=s)}function Kr(n,e,t,r,o,a,i){var s,l,u=new Map,h=e.length,c=a.length,f=new Array(h),d;for(s=0;s<h;++s)(l=e[s])&&(f[s]=d=i.call(l,l.__data__,s,e)+"",u.has(d)?o[s]=l:u.set(d,l));for(s=0;s<c;++s)d=i.call(n,a[s],s,a)+"",(l=u.get(d))?(r[s]=l,l.__data__=a[s],u.delete(d)):t[s]=new ht(n,a[s]);for(s=0;s<h;++s)(l=e[s])&&u.get(f[s])===l&&(o[s]=l)}function $r(n){return n.__data__}function Jr(n,e){if(!arguments.length)return Array.from(this,$r);var t=e?Kr:Zr,r=this._parents,o=this._groups;typeof n!="function"&&(n=Xr(n));for(var a=o.length,i=new Array(a),s=new Array(a),l=new Array(a),u=0;u<a;++u){var h=r[u],c=o[u],f=c.length,d=ei(n.call(h,h&&h.__data__,u,r)),v=d.length,g=s[u]=new Array(v),p=i[u]=new Array(v),_=l[u]=new Array(f);t(h,c,g,p,_,d,e);for(var E=0,x=0,m,y;E<v;++E)if(m=g[E]){for(E>=x&&(x=E+1);!(y=p[x])&&++x<v;);m._next=y||null}}return i=new K(i,r),i._enter=s,i._exit=l,i}function ei(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function ti(){return new K(this._exit||this._groups.map(Kn),this._parents)}function ni(n,e,t){var r=this.enter(),o=this,a=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(o=e(o),o&&(o=o.selection())),t==null?a.remove():t(a),r&&o?r.merge(o).order():o}function ri(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,o=t.length,a=r.length,i=Math.min(o,a),s=new Array(o),l=0;l<i;++l)for(var u=t[l],h=r[l],c=u.length,f=s[l]=new Array(c),d,v=0;v<c;++v)(d=u[v]||h[v])&&(f[v]=d);for(;l<o;++l)s[l]=t[l];return new K(s,this._parents)}function ii(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],o=r.length-1,a=r[o],i;--o>=0;)(i=r[o])&&(a&&i.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(i,a),a=i);return this}function oi(n){n||(n=ai);function e(c,f){return c&&f?n(c.__data__,f.__data__):!c-!f}for(var t=this._groups,r=t.length,o=new Array(r),a=0;a<r;++a){for(var i=t[a],s=i.length,l=o[a]=new Array(s),u,h=0;h<s;++h)(u=i[h])&&(l[h]=u);l.sort(e)}return new K(o,this._parents).order()}function ai(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function si(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function li(){return Array.from(this)}function ui(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],o=0,a=r.length;o<a;++o){var i=r[o];if(i)return i}return null}function hi(){let n=0;for(const e of this)++n;return n}function ci(){return!this.node()}function fi(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o=e[t],a=0,i=o.length,s;a<i;++a)(s=o[a])&&n.call(s,s.__data__,a,o);return this}function di(n){return function(){this.removeAttribute(n)}}function gi(n){return function(){this.removeAttributeNS(n.space,n.local)}}function mi(n,e){return function(){this.setAttribute(n,e)}}function vi(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function pi(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function Ai(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function yi(n,e){var t=_t(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?gi:di:typeof e=="function"?t.local?Ai:pi:t.local?vi:mi)(t,e))}function $n(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function bi(n){return function(){this.style.removeProperty(n)}}function _i(n,e,t){return function(){this.style.setProperty(n,e,t)}}function wi(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function xi(n,e,t){return arguments.length>1?this.each((e==null?bi:typeof e=="function"?wi:_i)(n,e,t??"")):Be(this.node(),n)}function Be(n,e){return n.style.getPropertyValue(e)||$n(n).getComputedStyle(n,null).getPropertyValue(e)}function Ei(n){return function(){delete this[n]}}function ki(n,e){return function(){this[n]=e}}function Ci(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function Ii(n,e){return arguments.length>1?this.each((e==null?Ei:typeof e=="function"?Ci:ki)(n,e)):this.node()[n]}function Jn(n){return n.trim().split(/^|\s+/)}function rn(n){return n.classList||new er(n)}function er(n){this._node=n,this._names=Jn(n.getAttribute("class")||"")}er.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function tr(n,e){for(var t=rn(n),r=-1,o=e.length;++r<o;)t.add(e[r])}function nr(n,e){for(var t=rn(n),r=-1,o=e.length;++r<o;)t.remove(e[r])}function Bi(n){return function(){tr(this,n)}}function Mi(n){return function(){nr(this,n)}}function Ri(n,e){return function(){(e.apply(this,arguments)?tr:nr)(this,n)}}function Fi(n,e){var t=Jn(n+"");if(arguments.length<2){for(var r=rn(this.node()),o=-1,a=t.length;++o<a;)if(!r.contains(t[o]))return!1;return!0}return this.each((typeof e=="function"?Ri:e?Bi:Mi)(t,e))}function Ti(){this.textContent=""}function Si(n){return function(){this.textContent=n}}function Pi(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function zi(n){return arguments.length?this.each(n==null?Ti:(typeof n=="function"?Pi:Si)(n)):this.node().textContent}function Ni(){this.innerHTML=""}function Oi(n){return function(){this.innerHTML=n}}function Di(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function Ui(n){return arguments.length?this.each(n==null?Ni:(typeof n=="function"?Di:Oi)(n)):this.node().innerHTML}function Li(){this.nextSibling&&this.parentNode.appendChild(this)}function Qi(){return this.each(Li)}function Gi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ji(){return this.each(Gi)}function Vi(n){var e=typeof n=="function"?n:qn(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Wi(){return null}function Hi(n,e){var t=typeof n=="function"?n:qn(n),r=e==null?Wi:typeof e=="function"?e:nn(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function qi(){var n=this.parentNode;n&&n.removeChild(this)}function Yi(){return this.each(qi)}function Xi(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Zi(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function Ki(n){return this.select(n?Zi:Xi)}function $i(n){return arguments.length?this.property("__data__",n):this.node().__data__}function Ji(n){return function(e){n.call(this,e,this.__data__)}}function eo(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function to(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,o=e.length,a;t<o;++t)a=e[t],(!n.type||a.type===n.type)&&a.name===n.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function no(n,e,t){return function(){var r=this.__on,o,a=Ji(e);if(r){for(var i=0,s=r.length;i<s;++i)if((o=r[i]).type===n.type&&o.name===n.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=a,o.options=t),o.value=e;return}}this.addEventListener(n.type,a,t),o={type:n.type,name:n.name,value:e,listener:a,options:t},r?r.push(o):this.__on=[o]}}function ro(n,e,t){var r=eo(n+""),o,a=r.length,i;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,u=s.length,h;l<u;++l)for(o=0,h=s[l];o<a;++o)if((i=r[o]).type===h.type&&i.name===h.name)return h.value}return}for(s=e?no:to,o=0;o<a;++o)this.each(s(r[o],e,t));return this}function rr(n,e,t){var r=$n(n),o=r.CustomEvent;typeof o=="function"?o=new o(e,t):(o=r.document.createEvent("Event"),t?(o.initEvent(e,t.bubbles,t.cancelable),o.detail=t.detail):o.initEvent(e,!1,!1)),n.dispatchEvent(o)}function io(n,e){return function(){return rr(this,n,e)}}function oo(n,e){return function(){return rr(this,n,e.apply(this,arguments))}}function ao(n,e){return this.each((typeof e=="function"?oo:io)(n,e))}function*so(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],o=0,a=r.length,i;o<a;++o)(i=r[o])&&(yield i)}var ir=[null];function K(n,e){this._groups=n,this._parents=e}function He(){return new K([[document.documentElement]],ir)}function lo(){return this}K.prototype=He.prototype={constructor:K,select:Pr,selectAll:Dr,selectChild:Gr,selectChildren:Hr,filter:qr,data:Jr,enter:Yr,exit:ti,join:ni,merge:ri,selection:lo,order:ii,sort:oi,call:si,nodes:li,node:ui,size:hi,empty:ci,each:fi,attr:yi,style:xi,property:Ii,classed:Fi,text:zi,html:Ui,raise:Qi,lower:ji,append:Vi,insert:Hi,remove:Yi,clone:Ki,datum:$i,on:ro,dispatch:ao,[Symbol.iterator]:so};function Z(n){return typeof n=="string"?new K([[document.querySelector(n)]],[document.documentElement]):new K([[n]],ir)}function uo(n){let e;for(;e=n.sourceEvent;)n=e;return n}function be(n,e){if(n=uo(n),e===void 0&&(e=n.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=n.clientX,r.y=n.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[n.clientX-o.left-e.clientLeft,n.clientY-o.top-e.clientTop]}}return[n.pageX,n.pageY]}var ho={value:()=>{}};function on(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new it(t)}function it(n){this._=n}function co(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",o=t.indexOf(".");if(o>=0&&(r=t.slice(o+1),t=t.slice(0,o)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}it.prototype=on.prototype={constructor:it,on:function(n,e){var t=this._,r=co(n+"",t),o,a=-1,i=r.length;if(arguments.length<2){for(;++a<i;)if((o=(n=r[a]).type)&&(o=fo(t[o],n.name)))return o;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<i;)if(o=(n=r[a]).type)t[o]=dn(t[o],n.name,e);else if(e==null)for(o in t)t[o]=dn(t[o],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new it(n)},call:function(n,e){if((o=arguments.length-2)>0)for(var t=new Array(o),r=0,o,a;r<o;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(a=this._[n],r=0,o=a.length;r<o;++r)a[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],o=0,a=r.length;o<a;++o)r[o].value.apply(e,t)}};function fo(n,e){for(var t=0,r=n.length,o;t<r;++t)if((o=n[t]).name===e)return o.value}function dn(n,e,t){for(var r=0,o=n.length;r<o;++r)if(n[r].name===e){n[r]=ho,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}const jt={capture:!0,passive:!1};function Vt(n){n.preventDefault(),n.stopImmediatePropagation()}function go(n){var e=n.document.documentElement,t=Z(n).on("dragstart.drag",Vt,jt);"onselectstart"in e?t.on("selectstart.drag",Vt,jt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function mo(n,e){var t=n.document.documentElement,r=Z(n).on("dragstart.drag",null);e&&(r.on("click.drag",Vt,jt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}function an(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function or(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function qe(){}var Ge=.7,ct=1/Ge,Ie="\\s*([+-]?\\d+)\\s*",je="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",oe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vo=/^#([0-9a-f]{3,8})$/,po=new RegExp(`^rgb\\(${Ie},${Ie},${Ie}\\)$`),Ao=new RegExp(`^rgb\\(${oe},${oe},${oe}\\)$`),yo=new RegExp(`^rgba\\(${Ie},${Ie},${Ie},${je}\\)$`),bo=new RegExp(`^rgba\\(${oe},${oe},${oe},${je}\\)$`),_o=new RegExp(`^hsl\\(${je},${oe},${oe}\\)$`),wo=new RegExp(`^hsla\\(${je},${oe},${oe},${je}\\)$`),gn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};an(qe,Ve,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:mn,formatHex:mn,formatHex8:xo,formatHsl:Eo,formatRgb:vn,toString:vn});function mn(){return this.rgb().formatHex()}function xo(){return this.rgb().formatHex8()}function Eo(){return ar(this).formatHsl()}function vn(){return this.rgb().formatRgb()}function Ve(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=vo.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?pn(e):t===3?new Y(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Ke(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Ke(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=po.exec(n))?new Y(e[1],e[2],e[3],1):(e=Ao.exec(n))?new Y(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=yo.exec(n))?Ke(e[1],e[2],e[3],e[4]):(e=bo.exec(n))?Ke(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=_o.exec(n))?bn(e[1],e[2]/100,e[3]/100,1):(e=wo.exec(n))?bn(e[1],e[2]/100,e[3]/100,e[4]):gn.hasOwnProperty(n)?pn(gn[n]):n==="transparent"?new Y(NaN,NaN,NaN,0):null}function pn(n){return new Y(n>>16&255,n>>8&255,n&255,1)}function Ke(n,e,t,r){return r<=0&&(n=e=t=NaN),new Y(n,e,t,r)}function ko(n){return n instanceof qe||(n=Ve(n)),n?(n=n.rgb(),new Y(n.r,n.g,n.b,n.opacity)):new Y}function ft(n,e,t,r){return arguments.length===1?ko(n):new Y(n,e,t,r??1)}function Y(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}an(Y,ft,or(qe,{brighter(n){return n=n==null?ct:Math.pow(ct,n),new Y(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Ge:Math.pow(Ge,n),new Y(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Y(xe(this.r),xe(this.g),xe(this.b),dt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:An,formatHex:An,formatHex8:Co,formatRgb:yn,toString:yn}));function An(){return`#${we(this.r)}${we(this.g)}${we(this.b)}`}function Co(){return`#${we(this.r)}${we(this.g)}${we(this.b)}${we((isNaN(this.opacity)?1:this.opacity)*255)}`}function yn(){const n=dt(this.opacity);return`${n===1?"rgb(":"rgba("}${xe(this.r)}, ${xe(this.g)}, ${xe(this.b)}${n===1?")":`, ${n})`}`}function dt(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function xe(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function we(n){return n=xe(n),(n<16?"0":"")+n.toString(16)}function bn(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new ne(n,e,t,r)}function ar(n){if(n instanceof ne)return new ne(n.h,n.s,n.l,n.opacity);if(n instanceof qe||(n=Ve(n)),!n)return new ne;if(n instanceof ne)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,o=Math.min(e,t,r),a=Math.max(e,t,r),i=NaN,s=a-o,l=(a+o)/2;return s?(e===a?i=(t-r)/s+(t<r)*6:t===a?i=(r-e)/s+2:i=(e-t)/s+4,s/=l<.5?a+o:2-a-o,i*=60):s=l>0&&l<1?0:i,new ne(i,s,l,n.opacity)}function Io(n,e,t,r){return arguments.length===1?ar(n):new ne(n,e,t,r??1)}function ne(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}an(ne,Io,or(qe,{brighter(n){return n=n==null?ct:Math.pow(ct,n),new ne(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Ge:Math.pow(Ge,n),new ne(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,o=2*t-r;return new Y(St(n>=240?n-240:n+120,o,r),St(n,o,r),St(n<120?n+240:n-120,o,r),this.opacity)},clamp(){return new ne(_n(this.h),$e(this.s),$e(this.l),dt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=dt(this.opacity);return`${n===1?"hsl(":"hsla("}${_n(this.h)}, ${$e(this.s)*100}%, ${$e(this.l)*100}%${n===1?")":`, ${n})`}`}}));function _n(n){return n=(n||0)%360,n<0?n+360:n}function $e(n){return Math.max(0,Math.min(1,n||0))}function St(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const sr=n=>()=>n;function Bo(n,e){return function(t){return n+t*e}}function Mo(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function Ro(n){return(n=+n)==1?lr:function(e,t){return t-e?Mo(e,t,n):sr(isNaN(e)?t:e)}}function lr(n,e){var t=e-n;return t?Bo(n,t):sr(isNaN(n)?e:n)}const wn=function n(e){var t=Ro(e);function r(o,a){var i=t((o=ft(o)).r,(a=ft(a)).r),s=t(o.g,a.g),l=t(o.b,a.b),u=lr(o.opacity,a.opacity);return function(h){return o.r=i(h),o.g=s(h),o.b=l(h),o.opacity=u(h),o+""}}return r.gamma=n,r}(1);function ge(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}var Wt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Pt=new RegExp(Wt.source,"g");function Fo(n){return function(){return n}}function To(n){return function(e){return n(e)+""}}function So(n,e){var t=Wt.lastIndex=Pt.lastIndex=0,r,o,a,i=-1,s=[],l=[];for(n=n+"",e=e+"";(r=Wt.exec(n))&&(o=Pt.exec(e));)(a=o.index)>t&&(a=e.slice(t,a),s[i]?s[i]+=a:s[++i]=a),(r=r[0])===(o=o[0])?s[i]?s[i]+=o:s[++i]=o:(s[++i]=null,l.push({i,x:ge(r,o)})),t=Pt.lastIndex;return t<e.length&&(a=e.slice(t),s[i]?s[i]+=a:s[++i]=a),s.length<2?l[0]?To(l[0].x):Fo(e):(e=l.length,function(u){for(var h=0,c;h<e;++h)s[(c=l[h]).i]=c.x(u);return s.join("")})}var xn=180/Math.PI,ur={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function hr(n,e,t,r,o,a){var i,s,l;return(i=Math.sqrt(n*n+e*e))&&(n/=i,e/=i),(l=n*t+e*r)&&(t-=n*l,r-=e*l),(s=Math.sqrt(t*t+r*r))&&(t/=s,r/=s,l/=s),n*r<e*t&&(n=-n,e=-e,l=-l,i=-i),{translateX:o,translateY:a,rotate:Math.atan2(e,n)*xn,skewX:Math.atan(l)*xn,scaleX:i,scaleY:s}}var Je;function Po(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?ur:hr(e.a,e.b,e.c,e.d,e.e,e.f)}function zo(n){return n==null||(Je||(Je=document.createElementNS("http://www.w3.org/2000/svg","g")),Je.setAttribute("transform",n),!(n=Je.transform.baseVal.consolidate()))?ur:(n=n.matrix,hr(n.a,n.b,n.c,n.d,n.e,n.f))}function cr(n,e,t,r){function o(u){return u.length?u.pop()+" ":""}function a(u,h,c,f,d,v){if(u!==c||h!==f){var g=d.push("translate(",null,e,null,t);v.push({i:g-4,x:ge(u,c)},{i:g-2,x:ge(h,f)})}else(c||f)&&d.push("translate("+c+e+f+t)}function i(u,h,c,f){u!==h?(u-h>180?h+=360:h-u>180&&(u+=360),f.push({i:c.push(o(c)+"rotate(",null,r)-2,x:ge(u,h)})):h&&c.push(o(c)+"rotate("+h+r)}function s(u,h,c,f){u!==h?f.push({i:c.push(o(c)+"skewX(",null,r)-2,x:ge(u,h)}):h&&c.push(o(c)+"skewX("+h+r)}function l(u,h,c,f,d,v){if(u!==c||h!==f){var g=d.push(o(d)+"scale(",null,",",null,")");v.push({i:g-4,x:ge(u,c)},{i:g-2,x:ge(h,f)})}else(c!==1||f!==1)&&d.push(o(d)+"scale("+c+","+f+")")}return function(u,h){var c=[],f=[];return u=n(u),h=n(h),a(u.translateX,u.translateY,h.translateX,h.translateY,c,f),i(u.rotate,h.rotate,c,f),s(u.skewX,h.skewX,c,f),l(u.scaleX,u.scaleY,h.scaleX,h.scaleY,c,f),u=h=null,function(d){for(var v=-1,g=f.length,p;++v<g;)c[(p=f[v]).i]=p.x(d);return c.join("")}}}var No=cr(Po,"px, ","px)","deg)"),Oo=cr(zo,", ",")",")"),Do=1e-12;function En(n){return((n=Math.exp(n))+1/n)/2}function Uo(n){return((n=Math.exp(n))-1/n)/2}function Lo(n){return((n=Math.exp(2*n))-1)/(n+1)}const Qo=function n(e,t,r){function o(a,i){var s=a[0],l=a[1],u=a[2],h=i[0],c=i[1],f=i[2],d=h-s,v=c-l,g=d*d+v*v,p,_;if(g<Do)_=Math.log(f/u)/e,p=function(k){return[s+k*d,l+k*v,u*Math.exp(e*k*_)]};else{var E=Math.sqrt(g),x=(f*f-u*u+r*g)/(2*u*t*E),m=(f*f-u*u-r*g)/(2*f*t*E),y=Math.log(Math.sqrt(x*x+1)-x),A=Math.log(Math.sqrt(m*m+1)-m);_=(A-y)/e,p=function(k){var C=k*_,R=En(y),P=u/(t*E)*(R*Lo(e*C+y)-Uo(y));return[s+P*d,l+P*v,u*R/En(e*C+y)]}}return p.duration=_*1e3*e/Math.SQRT2,p}return o.rho=function(a){var i=Math.max(.001,+a),s=i*i,l=s*s;return n(i,s,l)},o}(Math.SQRT2,2,4);var Me=0,Le=0,Fe=0,fr=1e3,gt,Qe,mt=0,Ee=0,wt=0,We=typeof performance=="object"&&performance.now?performance:Date,dr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function sn(){return Ee||(dr(Go),Ee=We.now()+wt)}function Go(){Ee=0}function vt(){this._call=this._time=this._next=null}vt.prototype=gr.prototype={constructor:vt,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?sn():+t)+(e==null?0:+e),!this._next&&Qe!==this&&(Qe?Qe._next=this:gt=this,Qe=this),this._call=n,this._time=t,Ht()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ht())}};function gr(n,e,t){var r=new vt;return r.restart(n,e,t),r}function jo(){sn(),++Me;for(var n=gt,e;n;)(e=Ee-n._time)>=0&&n._call.call(void 0,e),n=n._next;--Me}function kn(){Ee=(mt=We.now())+wt,Me=Le=0;try{jo()}finally{Me=0,Wo(),Ee=0}}function Vo(){var n=We.now(),e=n-mt;e>fr&&(wt-=e,mt=n)}function Wo(){for(var n,e=gt,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:gt=t);Qe=n,Ht(r)}function Ht(n){if(!Me){Le&&(Le=clearTimeout(Le));var e=n-Ee;e>24?(n<1/0&&(Le=setTimeout(kn,n-We.now()-wt)),Fe&&(Fe=clearInterval(Fe))):(Fe||(mt=We.now(),Fe=setInterval(Vo,fr)),Me=1,dr(kn))}}function Cn(n,e,t){var r=new vt;return e=e==null?0:+e,r.restart(o=>{r.stop(),n(o+e)},e,t),r}var Ho=on("start","end","cancel","interrupt"),qo=[],mr=0,In=1,qt=2,ot=3,Bn=4,Yt=5,at=6;function xt(n,e,t,r,o,a){var i=n.__transition;if(!i)n.__transition={};else if(t in i)return;Yo(n,t,{name:e,index:r,group:o,on:Ho,tween:qo,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:mr})}function ln(n,e){var t=re(n,e);if(t.state>mr)throw new Error("too late; already scheduled");return t}function ae(n,e){var t=re(n,e);if(t.state>ot)throw new Error("too late; already running");return t}function re(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Yo(n,e,t){var r=n.__transition,o;r[e]=t,t.timer=gr(a,0,t.time);function a(u){t.state=In,t.timer.restart(i,t.delay,t.time),t.delay<=u&&i(u-t.delay)}function i(u){var h,c,f,d;if(t.state!==In)return l();for(h in r)if(d=r[h],d.name===t.name){if(d.state===ot)return Cn(i);d.state===Bn?(d.state=at,d.timer.stop(),d.on.call("interrupt",n,n.__data__,d.index,d.group),delete r[h]):+h<e&&(d.state=at,d.timer.stop(),d.on.call("cancel",n,n.__data__,d.index,d.group),delete r[h])}if(Cn(function(){t.state===ot&&(t.state=Bn,t.timer.restart(s,t.delay,t.time),s(u))}),t.state=qt,t.on.call("start",n,n.__data__,t.index,t.group),t.state===qt){for(t.state=ot,o=new Array(f=t.tween.length),h=0,c=-1;h<f;++h)(d=t.tween[h].value.call(n,n.__data__,t.index,t.group))&&(o[++c]=d);o.length=c+1}}function s(u){for(var h=u<t.duration?t.ease.call(null,u/t.duration):(t.timer.restart(l),t.state=Yt,1),c=-1,f=o.length;++c<f;)o[c].call(n,h);t.state===Yt&&(t.on.call("end",n,n.__data__,t.index,t.group),l())}function l(){t.state=at,t.timer.stop(),delete r[e];for(var u in r)return;delete n.__transition}}function st(n,e){var t=n.__transition,r,o,a=!0,i;if(t){e=e==null?null:e+"";for(i in t){if((r=t[i]).name!==e){a=!1;continue}o=r.state>qt&&r.state<Yt,r.state=at,r.timer.stop(),r.on.call(o?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[i]}a&&delete n.__transition}}function Xo(n){return this.each(function(){st(this,n)})}function Zo(n,e){var t,r;return function(){var o=ae(this,n),a=o.tween;if(a!==t){r=t=a;for(var i=0,s=r.length;i<s;++i)if(r[i].name===e){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function Ko(n,e,t){var r,o;if(typeof t!="function")throw new Error;return function(){var a=ae(this,n),i=a.tween;if(i!==r){o=(r=i).slice();for(var s={name:e,value:t},l=0,u=o.length;l<u;++l)if(o[l].name===e){o[l]=s;break}l===u&&o.push(s)}a.tween=o}}function $o(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=re(this.node(),t).tween,o=0,a=r.length,i;o<a;++o)if((i=r[o]).name===n)return i.value;return null}return this.each((e==null?Zo:Ko)(t,n,e))}function un(n,e,t){var r=n._id;return n.each(function(){var o=ae(this,r);(o.value||(o.value={}))[e]=t.apply(this,arguments)}),function(o){return re(o,r).value[e]}}function vr(n,e){var t;return(typeof e=="number"?ge:e instanceof Ve?wn:(t=Ve(e))?(e=t,wn):So)(n,e)}function Jo(n){return function(){this.removeAttribute(n)}}function ea(n){return function(){this.removeAttributeNS(n.space,n.local)}}function ta(n,e,t){var r,o=t+"",a;return function(){var i=this.getAttribute(n);return i===o?null:i===r?a:a=e(r=i,t)}}function na(n,e,t){var r,o=t+"",a;return function(){var i=this.getAttributeNS(n.space,n.local);return i===o?null:i===r?a:a=e(r=i,t)}}function ra(n,e,t){var r,o,a;return function(){var i,s=t(this),l;return s==null?void this.removeAttribute(n):(i=this.getAttribute(n),l=s+"",i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s)))}}function ia(n,e,t){var r,o,a;return function(){var i,s=t(this),l;return s==null?void this.removeAttributeNS(n.space,n.local):(i=this.getAttributeNS(n.space,n.local),l=s+"",i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s)))}}function oa(n,e){var t=_t(n),r=t==="transform"?Oo:vr;return this.attrTween(n,typeof e=="function"?(t.local?ia:ra)(t,r,un(this,"attr."+n,e)):e==null?(t.local?ea:Jo)(t):(t.local?na:ta)(t,r,e))}function aa(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function sa(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function la(n,e){var t,r;function o(){var a=e.apply(this,arguments);return a!==r&&(t=(r=a)&&sa(n,a)),t}return o._value=e,o}function ua(n,e){var t,r;function o(){var a=e.apply(this,arguments);return a!==r&&(t=(r=a)&&aa(n,a)),t}return o._value=e,o}function ha(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=_t(n);return this.tween(t,(r.local?la:ua)(r,e))}function ca(n,e){return function(){ln(this,n).delay=+e.apply(this,arguments)}}function fa(n,e){return e=+e,function(){ln(this,n).delay=e}}function da(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?ca:fa)(e,n)):re(this.node(),e).delay}function ga(n,e){return function(){ae(this,n).duration=+e.apply(this,arguments)}}function ma(n,e){return e=+e,function(){ae(this,n).duration=e}}function va(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?ga:ma)(e,n)):re(this.node(),e).duration}function pa(n,e){if(typeof e!="function")throw new Error;return function(){ae(this,n).ease=e}}function Aa(n){var e=this._id;return arguments.length?this.each(pa(e,n)):re(this.node(),e).ease}function ya(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;ae(this,n).ease=t}}function ba(n){if(typeof n!="function")throw new Error;return this.each(ya(this._id,n))}function _a(n){typeof n!="function"&&(n=Xn(n));for(var e=this._groups,t=e.length,r=new Array(t),o=0;o<t;++o)for(var a=e[o],i=a.length,s=r[o]=[],l,u=0;u<i;++u)(l=a[u])&&n.call(l,l.__data__,u,a)&&s.push(l);return new ce(r,this._parents,this._name,this._id)}function wa(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,o=t.length,a=Math.min(r,o),i=new Array(r),s=0;s<a;++s)for(var l=e[s],u=t[s],h=l.length,c=i[s]=new Array(h),f,d=0;d<h;++d)(f=l[d]||u[d])&&(c[d]=f);for(;s<r;++s)i[s]=e[s];return new ce(i,this._parents,this._name,this._id)}function xa(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Ea(n,e,t){var r,o,a=xa(e)?ln:ae;return function(){var i=a(this,n),s=i.on;s!==r&&(o=(r=s).copy()).on(e,t),i.on=o}}function ka(n,e){var t=this._id;return arguments.length<2?re(this.node(),t).on.on(n):this.each(Ea(t,n,e))}function Ca(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function Ia(){return this.on("end.remove",Ca(this._id))}function Ba(n){var e=this._name,t=this._id;typeof n!="function"&&(n=nn(n));for(var r=this._groups,o=r.length,a=new Array(o),i=0;i<o;++i)for(var s=r[i],l=s.length,u=a[i]=new Array(l),h,c,f=0;f<l;++f)(h=s[f])&&(c=n.call(h,h.__data__,f,s))&&("__data__"in h&&(c.__data__=h.__data__),u[f]=c,xt(u[f],e,t,f,u,re(h,t)));return new ce(a,this._parents,e,t)}function Ma(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Yn(n));for(var r=this._groups,o=r.length,a=[],i=[],s=0;s<o;++s)for(var l=r[s],u=l.length,h,c=0;c<u;++c)if(h=l[c]){for(var f=n.call(h,h.__data__,c,l),d,v=re(h,t),g=0,p=f.length;g<p;++g)(d=f[g])&&xt(d,e,t,g,f,v);a.push(f),i.push(h)}return new ce(a,i,e,t)}var Ra=He.prototype.constructor;function Fa(){return new Ra(this._groups,this._parents)}function Ta(n,e){var t,r,o;return function(){var a=Be(this,n),i=(this.style.removeProperty(n),Be(this,n));return a===i?null:a===t&&i===r?o:o=e(t=a,r=i)}}function pr(n){return function(){this.style.removeProperty(n)}}function Sa(n,e,t){var r,o=t+"",a;return function(){var i=Be(this,n);return i===o?null:i===r?a:a=e(r=i,t)}}function Pa(n,e,t){var r,o,a;return function(){var i=Be(this,n),s=t(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(n),Be(this,n))),i===l?null:i===r&&l===o?a:(o=l,a=e(r=i,s))}}function za(n,e){var t,r,o,a="style."+e,i="end."+a,s;return function(){var l=ae(this,n),u=l.on,h=l.value[a]==null?s||(s=pr(e)):void 0;(u!==t||o!==h)&&(r=(t=u).copy()).on(i,o=h),l.on=r}}function Na(n,e,t){var r=(n+="")=="transform"?No:vr;return e==null?this.styleTween(n,Ta(n,r)).on("end.style."+n,pr(n)):typeof e=="function"?this.styleTween(n,Pa(n,r,un(this,"style."+n,e))).each(za(this._id,n)):this.styleTween(n,Sa(n,r,e),t).on("end.style."+n,null)}function Oa(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function Da(n,e,t){var r,o;function a(){var i=e.apply(this,arguments);return i!==o&&(r=(o=i)&&Oa(n,i,t)),r}return a._value=e,a}function Ua(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Da(n,e,t??""))}function La(n){return function(){this.textContent=n}}function Qa(n){return function(){var e=n(this);this.textContent=e??""}}function Ga(n){return this.tween("text",typeof n=="function"?Qa(un(this,"text",n)):La(n==null?"":n+""))}function ja(n){return function(e){this.textContent=n.call(this,e)}}function Va(n){var e,t;function r(){var o=n.apply(this,arguments);return o!==t&&(e=(t=o)&&ja(o)),e}return r._value=n,r}function Wa(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,Va(n))}function Ha(){for(var n=this._name,e=this._id,t=Ar(),r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],s=i.length,l,u=0;u<s;++u)if(l=i[u]){var h=re(l,e);xt(l,n,t,u,i,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new ce(r,this._parents,n,t)}function qa(){var n,e,t=this,r=t._id,o=t.size();return new Promise(function(a,i){var s={value:i},l={value:function(){--o===0&&a()}};t.each(function(){var u=ae(this,r),h=u.on;h!==n&&(e=(n=h).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),u.on=e}),o===0&&a()})}var Ya=0;function ce(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function Ar(){return++Ya}var se=He.prototype;ce.prototype={constructor:ce,select:Ba,selectAll:Ma,selectChild:se.selectChild,selectChildren:se.selectChildren,filter:_a,merge:wa,selection:Fa,transition:Ha,call:se.call,nodes:se.nodes,node:se.node,size:se.size,empty:se.empty,each:se.each,on:ka,attr:oa,attrTween:ha,style:Na,styleTween:Ua,text:Ga,textTween:Wa,remove:Ia,tween:$o,delay:da,duration:va,ease:Aa,easeVarying:ba,end:qa,[Symbol.iterator]:se[Symbol.iterator]};var Xa={time:null,delay:0,duration:250,ease:Rr};function Za(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function Ka(n){var e,t;n instanceof ce?(e=n._id,n=n._name):(e=Ar(),(t=Xa).time=sn(),n=n==null?null:n+"");for(var r=this._groups,o=r.length,a=0;a<o;++a)for(var i=r[a],s=i.length,l,u=0;u<s;++u)(l=i[u])&&xt(l,n,e,u,i,t||Za(l,e));return new ce(r,this._parents,n,e)}He.prototype.interrupt=Xo;He.prototype.transition=Ka;const et=n=>()=>n;function $a(n,{sourceEvent:e,target:t,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function he(n,e,t){this.k=n,this.x=e,this.y=t}he.prototype={constructor:he,scale:function(n){return n===1?this:new he(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new he(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var _e=new he(1,0,0);he.prototype;function zt(n){n.stopImmediatePropagation()}function Te(n){n.preventDefault(),n.stopImmediatePropagation()}function Ja(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function es(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function Mn(){return this.__zoom||_e}function ts(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function ns(){return navigator.maxTouchPoints||"ontouchstart"in this}function rs(n,e,t){var r=n.invertX(e[0][0])-t[0][0],o=n.invertX(e[1][0])-t[1][0],a=n.invertY(e[0][1])-t[0][1],i=n.invertY(e[1][1])-t[1][1];return n.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>a?(a+i)/2:Math.min(0,a)||Math.max(0,i))}function is(){var n=Ja,e=es,t=rs,r=ts,o=ns,a=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],s=250,l=Qo,u=on("start","zoom","end"),h,c,f,d=500,v=150,g=0,p=10;function _(b){b.property("__zoom",Mn).on("wheel.zoom",C,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",P).filter(o).on("touchstart.zoom",M).on("touchmove.zoom",N).on("touchend.zoom touchcancel.zoom",z).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}_.transform=function(b,B,w,S){var I=b.selection?b.selection():b;I.property("__zoom",Mn),b!==I?y(b,B,w,S):I.interrupt().each(function(){A(this,arguments).event(S).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},_.scaleBy=function(b,B,w,S){_.scaleTo(b,function(){var I=this.__zoom.k,T=typeof B=="function"?B.apply(this,arguments):B;return I*T},w,S)},_.scaleTo=function(b,B,w,S){_.transform(b,function(){var I=e.apply(this,arguments),T=this.__zoom,F=w==null?m(I):typeof w=="function"?w.apply(this,arguments):w,O=T.invert(F),D=typeof B=="function"?B.apply(this,arguments):B;return t(x(E(T,D),F,O),I,i)},w,S)},_.translateBy=function(b,B,w,S){_.transform(b,function(){return t(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof w=="function"?w.apply(this,arguments):w),e.apply(this,arguments),i)},null,S)},_.translateTo=function(b,B,w,S,I){_.transform(b,function(){var T=e.apply(this,arguments),F=this.__zoom,O=S==null?m(T):typeof S=="function"?S.apply(this,arguments):S;return t(_e.translate(O[0],O[1]).scale(F.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof w=="function"?-w.apply(this,arguments):-w),T,i)},S,I)};function E(b,B){return B=Math.max(a[0],Math.min(a[1],B)),B===b.k?b:new he(B,b.x,b.y)}function x(b,B,w){var S=B[0]-w[0]*b.k,I=B[1]-w[1]*b.k;return S===b.x&&I===b.y?b:new he(b.k,S,I)}function m(b){return[(+b[0][0]+ +b[1][0])/2,(+b[0][1]+ +b[1][1])/2]}function y(b,B,w,S){b.on("start.zoom",function(){A(this,arguments).event(S).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(S).end()}).tween("zoom",function(){var I=this,T=arguments,F=A(I,T).event(S),O=e.apply(I,T),D=w==null?m(O):typeof w=="function"?w.apply(I,T):w,U=Math.max(O[1][0]-O[0][0],O[1][1]-O[0][1]),L=I.__zoom,Q=typeof B=="function"?B.apply(I,T):B,G=l(L.invert(D).concat(U/L.k),Q.invert(D).concat(U/Q.k));return function(j){if(j===1)j=Q;else{var V=G(j),q=U/V[2];j=new he(q,D[0]-V[0]*q,D[1]-V[1]*q)}F.zoom(null,j)}})}function A(b,B,w){return!w&&b.__zooming||new k(b,B)}function k(b,B){this.that=b,this.args=B,this.active=0,this.sourceEvent=null,this.extent=e.apply(b,B),this.taps=0}k.prototype={event:function(b){return b&&(this.sourceEvent=b),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(b,B){return this.mouse&&b!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&b!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&b!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(b){var B=Z(this.that).datum();u.call(b,this.that,new $a(b,{sourceEvent:this.sourceEvent,target:_,type:b,transform:this.that.__zoom,dispatch:u}),B)}};function C(b,...B){if(!n.apply(this,arguments))return;var w=A(this,B).event(b),S=this.__zoom,I=Math.max(a[0],Math.min(a[1],S.k*Math.pow(2,r.apply(this,arguments)))),T=be(b);if(w.wheel)(w.mouse[0][0]!==T[0]||w.mouse[0][1]!==T[1])&&(w.mouse[1]=S.invert(w.mouse[0]=T)),clearTimeout(w.wheel);else{if(S.k===I)return;w.mouse=[T,S.invert(T)],st(this),w.start()}Te(b),w.wheel=setTimeout(F,v),w.zoom("mouse",t(x(E(S,I),w.mouse[0],w.mouse[1]),w.extent,i));function F(){w.wheel=null,w.end()}}function R(b,...B){if(f||!n.apply(this,arguments))return;var w=b.currentTarget,S=A(this,B,!0).event(b),I=Z(b.view).on("mousemove.zoom",D,!0).on("mouseup.zoom",U,!0),T=be(b,w),F=b.clientX,O=b.clientY;go(b.view),zt(b),S.mouse=[T,this.__zoom.invert(T)],st(this),S.start();function D(L){if(Te(L),!S.moved){var Q=L.clientX-F,G=L.clientY-O;S.moved=Q*Q+G*G>g}S.event(L).zoom("mouse",t(x(S.that.__zoom,S.mouse[0]=be(L,w),S.mouse[1]),S.extent,i))}function U(L){I.on("mousemove.zoom mouseup.zoom",null),mo(L.view,S.moved),Te(L),S.event(L).end()}}function P(b,...B){if(n.apply(this,arguments)){var w=this.__zoom,S=be(b.changedTouches?b.changedTouches[0]:b,this),I=w.invert(S),T=w.k*(b.shiftKey?.5:2),F=t(x(E(w,T),S,I),e.apply(this,B),i);Te(b),s>0?Z(this).transition().duration(s).call(y,F,S,b):Z(this).call(_.transform,F,S,b)}}function M(b,...B){if(n.apply(this,arguments)){var w=b.touches,S=w.length,I=A(this,B,b.changedTouches.length===S).event(b),T,F,O,D;for(zt(b),F=0;F<S;++F)O=w[F],D=be(O,this),D=[D,this.__zoom.invert(D),O.identifier],I.touch0?!I.touch1&&I.touch0[2]!==D[2]&&(I.touch1=D,I.taps=0):(I.touch0=D,T=!0,I.taps=1+!!h);h&&(h=clearTimeout(h)),T&&(I.taps<2&&(c=D[0],h=setTimeout(function(){h=null},d)),st(this),I.start())}}function N(b,...B){if(this.__zooming){var w=A(this,B).event(b),S=b.changedTouches,I=S.length,T,F,O,D;for(Te(b),T=0;T<I;++T)F=S[T],O=be(F,this),w.touch0&&w.touch0[2]===F.identifier?w.touch0[0]=O:w.touch1&&w.touch1[2]===F.identifier&&(w.touch1[0]=O);if(F=w.that.__zoom,w.touch1){var U=w.touch0[0],L=w.touch0[1],Q=w.touch1[0],G=w.touch1[1],j=(j=Q[0]-U[0])*j+(j=Q[1]-U[1])*j,V=(V=G[0]-L[0])*V+(V=G[1]-L[1])*V;F=E(F,Math.sqrt(j/V)),O=[(U[0]+Q[0])/2,(U[1]+Q[1])/2],D=[(L[0]+G[0])/2,(L[1]+G[1])/2]}else if(w.touch0)O=w.touch0[0],D=w.touch0[1];else return;w.zoom("touch",t(x(F,O,D),w.extent,i))}}function z(b,...B){if(this.__zooming){var w=A(this,B).event(b),S=b.changedTouches,I=S.length,T,F;for(zt(b),f&&clearTimeout(f),f=setTimeout(function(){f=null},d),T=0;T<I;++T)F=S[T],w.touch0&&w.touch0[2]===F.identifier?delete w.touch0:w.touch1&&w.touch1[2]===F.identifier&&delete w.touch1;if(w.touch1&&!w.touch0&&(w.touch0=w.touch1,delete w.touch1),w.touch0)w.touch0[1]=this.__zoom.invert(w.touch0[0]);else if(w.end(),w.taps===2&&(F=be(F,this),Math.hypot(c[0]-F[0],c[1]-F[1])<p)){var O=Z(this).on("dblclick.zoom");O&&O.apply(this,arguments)}}}return _.wheelDelta=function(b){return arguments.length?(r=typeof b=="function"?b:et(+b),_):r},_.filter=function(b){return arguments.length?(n=typeof b=="function"?b:et(!!b),_):n},_.touchable=function(b){return arguments.length?(o=typeof b=="function"?b:et(!!b),_):o},_.extent=function(b){return arguments.length?(e=typeof b=="function"?b:et([[+b[0][0],+b[0][1]],[+b[1][0],+b[1][1]]]),_):e},_.scaleExtent=function(b){return arguments.length?(a[0]=+b[0],a[1]=+b[1],_):[a[0],a[1]]},_.translateExtent=function(b){return arguments.length?(i[0][0]=+b[0][0],i[1][0]=+b[1][0],i[0][1]=+b[0][1],i[1][1]=+b[1][1],_):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},_.constrain=function(b){return arguments.length?(t=b,_):t},_.duration=function(b){return arguments.length?(s=+b,_):s},_.interpolate=function(b){return arguments.length?(l=b,_):l},_.on=function(){var b=u.on.apply(u,arguments);return b===u?_:b},_.clickDistance=function(b){return arguments.length?(g=(b=+b)*b,_):Math.sqrt(g)},_.tapDistance=function(b){return arguments.length?(p=+b,_):p},_}var os=1e-6,me=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function as(){var n=new me(9);return me!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ss(n,e){var t=e[0],r=e[1],o=e[2],a=e[3],i=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],v=e[12],g=e[13],p=e[14],_=e[15],E=t*s-r*i,x=t*l-o*i,m=t*u-a*i,y=r*l-o*s,A=r*u-a*s,k=o*u-a*l,C=h*g-c*v,R=h*p-f*v,P=h*_-d*v,M=c*p-f*g,N=c*_-d*g,z=f*_-d*p,b=E*z-x*N+m*M+y*P-A*R+k*C;return b?(b=1/b,n[0]=(s*z-l*N+u*M)*b,n[1]=(l*P-i*z-u*R)*b,n[2]=(i*N-s*P+u*C)*b,n[3]=(o*N-r*z-a*M)*b,n[4]=(t*z-o*P+a*R)*b,n[5]=(r*P-t*N-a*C)*b,n[6]=(g*k-p*A+_*y)*b,n[7]=(p*m-v*k-_*x)*b,n[8]=(v*A-g*m+_*E)*b,n):null}function Se(){var n=new me(16);return me!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Nt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ot(n,e,t){var r=e[0],o=e[1],a=e[2],i=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],v=e[11],g=e[12],p=e[13],_=e[14],E=e[15],x=t[0],m=t[1],y=t[2],A=t[3];return n[0]=x*r+m*s+y*c+A*g,n[1]=x*o+m*l+y*f+A*p,n[2]=x*a+m*u+y*d+A*_,n[3]=x*i+m*h+y*v+A*E,x=t[4],m=t[5],y=t[6],A=t[7],n[4]=x*r+m*s+y*c+A*g,n[5]=x*o+m*l+y*f+A*p,n[6]=x*a+m*u+y*d+A*_,n[7]=x*i+m*h+y*v+A*E,x=t[8],m=t[9],y=t[10],A=t[11],n[8]=x*r+m*s+y*c+A*g,n[9]=x*o+m*l+y*f+A*p,n[10]=x*a+m*u+y*d+A*_,n[11]=x*i+m*h+y*v+A*E,x=t[12],m=t[13],y=t[14],A=t[15],n[12]=x*r+m*s+y*c+A*g,n[13]=x*o+m*l+y*f+A*p,n[14]=x*a+m*u+y*d+A*_,n[15]=x*i+m*h+y*v+A*E,n}function Rn(n,e,t){var r=t[0],o=t[1],a=t[2],i,s,l,u,h,c,f,d,v,g,p,_;return e===n?(n[12]=e[0]*r+e[4]*o+e[8]*a+e[12],n[13]=e[1]*r+e[5]*o+e[9]*a+e[13],n[14]=e[2]*r+e[6]*o+e[10]*a+e[14],n[15]=e[3]*r+e[7]*o+e[11]*a+e[15]):(i=e[0],s=e[1],l=e[2],u=e[3],h=e[4],c=e[5],f=e[6],d=e[7],v=e[8],g=e[9],p=e[10],_=e[11],n[0]=i,n[1]=s,n[2]=l,n[3]=u,n[4]=h,n[5]=c,n[6]=f,n[7]=d,n[8]=v,n[9]=g,n[10]=p,n[11]=_,n[12]=i*r+h*o+v*a+e[12],n[13]=s*r+c*o+g*a+e[13],n[14]=l*r+f*o+p*a+e[14],n[15]=u*r+d*o+_*a+e[15]),n}function Fn(n,e,t,r){var o=r[0],a=r[1],i=r[2],s=Math.hypot(o,a,i),l,u,h,c,f,d,v,g,p,_,E,x,m,y,A,k,C,R,P,M,N,z,b,B;return s<os?null:(s=1/s,o*=s,a*=s,i*=s,l=Math.sin(t),u=Math.cos(t),h=1-u,c=e[0],f=e[1],d=e[2],v=e[3],g=e[4],p=e[5],_=e[6],E=e[7],x=e[8],m=e[9],y=e[10],A=e[11],k=o*o*h+u,C=a*o*h+i*l,R=i*o*h-a*l,P=o*a*h-i*l,M=a*a*h+u,N=i*a*h+o*l,z=o*i*h+a*l,b=a*i*h-o*l,B=i*i*h+u,n[0]=c*k+g*C+x*R,n[1]=f*k+p*C+m*R,n[2]=d*k+_*C+y*R,n[3]=v*k+E*C+A*R,n[4]=c*P+g*M+x*N,n[5]=f*P+p*M+m*N,n[6]=d*P+_*M+y*N,n[7]=v*P+E*M+A*N,n[8]=c*z+g*b+x*B,n[9]=f*z+p*b+m*B,n[10]=d*z+_*b+y*B,n[11]=v*z+E*b+A*B,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function ls(n,e,t,r,o){var a=1/Math.tan(e/2),i;return n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(i=1/(r-o),n[10]=(o+r)*i,n[14]=2*o*r*i):(n[10]=-1,n[14]=-2*r),n}var us=ls;function hs(n,e,t,r,o,a,i){var s=1/(e-t),l=1/(r-o),u=1/(a-i);return n[0]=-2*s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*u,n[11]=0,n[12]=(e+t)*s,n[13]=(o+r)*l,n[14]=(i+a)*u,n[15]=1,n}var cs=hs;function lt(){var n=new me(3);return me!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}(function(){var n=lt();return function(e,t,r,o,a,i){var s,l;for(t||(t=3),r||(r=0),o?l=Math.min(o*t+r,e.length):l=e.length,s=r;s<l;s+=t)n[0]=e[s],n[1]=e[s+1],n[2]=e[s+2],a(n,n,i),e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2];return e}})();function yr(){var n=new me(4);return me!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function fs(n,e,t){var r=e[0],o=e[1],a=e[2],i=e[3];return n[0]=t[0]*r+t[4]*o+t[8]*a+t[12]*i,n[1]=t[1]*r+t[5]*o+t[9]*a+t[13]*i,n[2]=t[2]*r+t[6]*o+t[10]*a+t[14]*i,n[3]=t[3]*r+t[7]*o+t[11]*a+t[15]*i,n}(function(){var n=yr();return function(e,t,r,o,a,i){var s,l;for(t||(t=4),r||(r=0),o?l=Math.min(o*t+r,e.length):l=e.length,s=r;s<l;s+=t)n[0]=e[s],n[1]=e[s+1],n[2]=e[s+2],n[3]=e[s+3],a(n,n,i),e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3];return e}})();function ds(n,e){let t=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null;for(let o=0;o<t.length;++o){try{r=n.getContext(t[o],e)}catch{}if(r)break}return r}function $(n,e,t){let r;return r=n.createShader(t),n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.log("ERROR with script: ",e),console.log(n.getShaderInfoLog(r)),null)}function Ce(n,e,t,r,o){let a=o.createProgram();if(o.attachShader(a,n),o.attachShader(a,e),o.linkProgram(a),!o.getProgramParameter(a,o.LINK_STATUS)){alert("Shader Compilation Error."+o.getProgramInfoLog(a));return}if(this.ID=a,this.uniforms=new Object,this.attributes=new Object,t)for(let i=0;i<t.length;i++)this.uniforms[t[i]]=o.getUniformLocation(this.ID,t[i]);if(this.attributes.enable=function(i){o.enableVertexAttribArray(this[i])},this.attributes.disable=function(i){o.disableVertexAttribArray(this[i])},r)for(let i=0;i<r.length;i++)this.attributes[r[i]]=o.getAttribLocation(this.ID,r[i]);this.use=function(i){i.useProgram(this.ID)}}function br(n,e=!0,t=!0){let r=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],o=[0,0,1,0,0,1,0,0,1,0,0,1],a=[0,1,0,1,0,0,1,1,0,0,0,0],i={};return t&&(i.texCoordObject=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,i.texCoordObject),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW)),e&&(i.normalObject=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,i.normalObject),n.bufferData(n.ARRAY_BUFFER,new Float32Array(o),n.STATIC_DRAW)),i.vertexObject=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,i.vertexObject),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),i.numIndices=4,i}function Tn(n){return n*Math.PI/180}function Xt(n,e,t,r){if(r<=t)return t;const o=Math.floor(t+(r-t)/2),a=e-n[o].value,i=e-n[o+1].value;return a<0?Xt(n,e,t,o-1):i<0?o:Xt(n,e,o+1,r)}const gs=(n,e,t)=>{const r=(n-e)/(t-e);return[1-r,r]};function ms(n){return n.value!==void 0&&n.mapped!==void 0}function vs(n){return n.length>0&&ms(n[0])}function Sn(n,e,t,r){return[n*e[0]+t*r[0],n*e[1]+t*r[1],n*e[2]+t*r[2]]}function Pn(n){return n||gs}function ps(n,e,t){return!Array.isArray(n)||n.length<1?bs:vs(n)?As(n,e,Pn(t),Sn):ys(n,e,Pn(t),Sn)}function As(n,e,t,r){const o=n.sort((a,i)=>a.value<i.value?-1:1);return function(a){const i=e(a),s=Xt(o,i,0,o.length-1);if(s==0&&i<o[0].value||s==o.length-1)return o[s].mapped;const[l,u]=t(i,o[s].value,o[s+1].value);return r(l,o[s].mapped,u,o[s+1].mapped)}}function ys(n,e,t,r){return function(o){const a=e(o),i=(n.length-1)*a;if(i<=0)return n[0];if(i>=n.length-1)return n[n.length-1];const s=Math.floor(i),[l,u]=t(i,s,s+1);return r(l,n[s],u,n[s+1])}}function bs(n){return[0,0,0]}function _s(n,e){let[t,r]=n;const[o,a]=e;return Math.abs(t-r)<Number.EPSILON&&(r=t+1),function(i){return o+(a-o)*((i-t)/(r-t))}}const ws=[[.001462,466e-6,.013866],[.002267,.00127,.01857],[.003299,.002249,.024239],[.004547,.003392,.030909],[.006006,.004692,.038558],[.007676,.006136,.046836],[.009561,.007713,.055143],[.011663,.009417,.06346],[.013995,.011225,.071862],[.016561,.013136,.080282],[.019373,.015133,.088767],[.022447,.017199,.097327],[.025793,.019331,.10593],[.029432,.021503,.114621],[.033385,.023702,.123397],[.037668,.025921,.132232],[.042253,.028139,.141141],[.046915,.030324,.150164],[.051644,.032474,.159254],[.056449,.034569,.168414],[.06134,.03659,.177642],[.066331,.038504,.186962],[.071429,.040294,.196354],[.076637,.041905,.205799],[.081962,.043328,.215289],[.087411,.044556,.224813],[.09299,.045583,.234358],[.098702,.046402,.243904],[.104551,.047008,.25343],[.110536,.047399,.262912],[.116656,.047574,.272321],[.122908,.047536,.281624],[.129285,.047293,.290788],[.135778,.046856,.299776],[.142378,.046242,.308553],[.149073,.045468,.317085],[.15585,.044559,.325338],[.162689,.043554,.333277],[.169575,.042489,.340874],[.176493,.041402,.348111],[.183429,.040329,.354971],[.190367,.039309,.361447],[.197297,.0384,.367535],[.204209,.037632,.373238],[.211095,.03703,.378563],[.217949,.036615,.383522],[.224763,.036405,.388129],[.231538,.036405,.3924],[.238273,.036621,.396353],[.244967,.037055,.400007],[.25162,.037705,.403378],[.258234,.038571,.406485],[.26481,.039647,.409345],[.271347,.040922,.411976],[.27785,.042353,.414392],[.284321,.043933,.416608],[.290763,.045644,.418637],[.297178,.04747,.420491],[.303568,.049396,.422182],[.309935,.051407,.423721],[.316282,.05349,.425116],[.32261,.055634,.426377],[.328921,.057827,.427511],[.335217,.06006,.428524],[.3415,.062325,.429425],[.347771,.064616,.430217],[.354032,.066925,.430906],[.360284,.069247,.431497],[.366529,.071579,.431994],[.372768,.073915,.4324],[.379001,.076253,.432719],[.385228,.078591,.432955],[.391453,.080927,.433109],[.397674,.083257,.433183],[.403894,.08558,.433179],[.410113,.087896,.433098],[.416331,.090203,.432943],[.422549,.092501,.432714],[.428768,.09479,.432412],[.434987,.097069,.432039],[.441207,.099338,.431594],[.447428,.101597,.43108],[.453651,.103848,.430498],[.459875,.106089,.429846],[.4661,.108322,.429125],[.472328,.110547,.428334],[.478558,.112764,.427475],[.484789,.114974,.426548],[.491022,.117179,.425552],[.497257,.119379,.424488],[.503493,.121575,.423356],[.50973,.123769,.422156],[.515967,.12596,.420887],[.522206,.12815,.419549],[.528444,.130341,.418142],[.534683,.132534,.416667],[.54092,.134729,.415123],[.547157,.136929,.413511],[.553392,.139134,.411829],[.559624,.141346,.410078],[.565854,.143567,.408258],[.572081,.145797,.406369],[.578304,.148039,.404411],[.584521,.150294,.402385],[.590734,.152563,.40029],[.59694,.154848,.398125],[.603139,.157151,.395891],[.60933,.159474,.393589],[.615513,.161817,.391219],[.621685,.164184,.388781],[.627847,.166575,.386276],[.633998,.168992,.383704],[.640135,.171438,.381065],[.64626,.173914,.378359],[.652369,.176421,.375586],[.658463,.178962,.372748],[.66454,.181539,.369846],[.670599,.184153,.366879],[.676638,.186807,.363849],[.682656,.189501,.360757],[.688653,.192239,.357603],[.694627,.195021,.354388],[.700576,.197851,.351113],[.7065,.200728,.347777],[.712396,.203656,.344383],[.718264,.206636,.340931],[.724103,.20967,.337424],[.729909,.212759,.333861],[.735683,.215906,.330245],[.741423,.219112,.326576],[.747127,.222378,.322856],[.752794,.225706,.319085],[.758422,.229097,.315266],[.76401,.232554,.311399],[.769556,.236077,.307485],[.775059,.239667,.303526],[.780517,.243327,.299523],[.785929,.247056,.295477],[.791293,.250856,.29139],[.796607,.254728,.287264],[.801871,.258674,.283099],[.807082,.262692,.278898],[.812239,.266786,.274661],[.817341,.270954,.27039],[.822386,.275197,.266085],[.827372,.279517,.26175],[.832299,.283913,.257383],[.837165,.288385,.252988],[.841969,.292933,.248564],[.846709,.297559,.244113],[.851384,.30226,.239636],[.855992,.307038,.235133],[.860533,.311892,.230606],[.865006,.316822,.226055],[.869409,.321827,.221482],[.873741,.326906,.216886],[.878001,.33206,.212268],[.882188,.337287,.207628],[.886302,.342586,.202968],[.890341,.347957,.198286],[.894305,.353399,.193584],[.898192,.358911,.18886],[.902003,.364492,.184116],[.905735,.37014,.17935],[.90939,.375856,.174563],[.912966,.381636,.169755],[.916462,.387481,.164924],[.919879,.393389,.16007],[.923215,.399359,.155193],[.92647,.405389,.150292],[.929644,.411479,.145367],[.932737,.417627,.140417],[.935747,.423831,.13544],[.938675,.430091,.130438],[.941521,.436405,.125409],[.944285,.442772,.120354],[.946965,.449191,.115272],[.949562,.45566,.110164],[.952075,.462178,.105031],[.954506,.468744,.099874],[.956852,.475356,.094695],[.959114,.482014,.089499],[.961293,.488716,.084289],[.963387,.495462,.079073],[.965397,.502249,.073859],[.967322,.509078,.068659],[.969163,.515946,.063488],[.970919,.522853,.058367],[.97259,.529798,.053324],[.974176,.53678,.048392],[.975677,.543798,.043618],[.977092,.55085,.03905],[.978422,.557937,.034931],[.979666,.565057,.031409],[.980824,.572209,.028508],[.981895,.579392,.02625],[.982881,.586606,.024661],[.983779,.593849,.02377],[.984591,.601122,.023606],[.985315,.608422,.024202],[.985952,.61575,.025592],[.986502,.623105,.027814],[.986964,.630485,.030908],[.987337,.63789,.034916],[.987622,.64532,.039886],[.987819,.652773,.045581],[.987926,.66025,.05175],[.987945,.667748,.058329],[.987874,.675267,.065257],[.987714,.682807,.072489],[.987464,.690366,.07999],[.987124,.697944,.087731],[.986694,.70554,.095694],[.986175,.713153,.103863],[.985566,.720782,.112229],[.984865,.728427,.120785],[.984075,.736087,.129527],[.983196,.743758,.138453],[.982228,.751442,.147565],[.981173,.759135,.156863],[.980032,.766837,.166353],[.978806,.774545,.176037],[.977497,.782258,.185923],[.976108,.789974,.196018],[.974638,.797692,.206332],[.973088,.805409,.216877],[.971468,.813122,.227658],[.969783,.820825,.238686],[.968041,.828515,.249972],[.966243,.836191,.261534],[.964394,.843848,.273391],[.962517,.851476,.285546],[.960626,.859069,.29801],[.95872,.866624,.31082],[.956834,.874129,.323974],[.954997,.881569,.337475],[.953215,.888942,.351369],[.951546,.896226,.365627],[.950018,.903409,.380271],[.948683,.910473,.395289],[.947594,.917399,.410665],[.946809,.924168,.426373],[.946392,.930761,.442367],[.946403,.937159,.458592],[.946903,.943348,.47497],[.947937,.949318,.491426],[.949545,.955063,.50786],[.95174,.960587,.524203],[.954529,.965896,.540361],[.957896,.971003,.556275],[.961812,.975924,.571925],[.966249,.980678,.587206],[.971162,.985282,.602154],[.976511,.989753,.61676],[.982257,.994109,.631017],[.988362,.998364,.644924]];class xs{constructor(e,t,r,o){for(const[a,i]of Object.entries(e))a=="color"||a=="size"||a=="position"||a=="outlineColor"||a=="outlineWidth"||(this[a]=i);this._network=o,this.ID=t,this.index=r}set color(e){let t=this.index;this._network.colors[t*4+0]=e[0],this._network.colors[t*4+1]=e[1],this._network.colors[t*4+2]=e[2],e.length>3&&(this._network.colors[t*4+3]=e[3])}get color(){let e=this.index;return[this._network.colors[e*4+0],this._network.colors[e*4+1],this._network.colors[e*4+2],this._network.colors[e*4+3]]}set opacity(e){let t=this.index;this._network.colors[t*4+3]=e}get opacity(){let e=this.index;return this._network.colors[e*4+3]}set size(e){this._network.sizes[this.index]=e}get size(){return this._network.sizes[this.index]}set outlineColor(e){let t=this.index;this._network.outlineColors[t*4+0]=e[0],this._network.outlineColors[t*4+1]=e[1],this._network.outlineColors[t*4+2]=e[2],e.length>3&&(this._network.outlineColors[t*4+3]=e[3])}get outlineColor(){let e=this.index;return[this._network.outlineColors[e*4+0],this._network.outlineColors[e*4+1],this._network.outlineColors[e*4+2],this._network.outlineColors[e*4+3]]}set outlineWidth(e){this._network.outlineWidths[this.index]=e}get outlineWidth(){return this._network.outlineWidths[this.index]}get network(){return this._network}set position(e){let t=this.index;this._network.positions[t*3+0]=e[0],this._network.positions[t*3+1]=e[1],this._network.positions[t*3+2]=e[2]}get position(){let e=this.index;return[this._network.positions[e*3+0],this._network.positions[e*3+1],this._network.positions[e*3+2]]}}class Es{constructor(e,t,r){this.ID2index=new Object,this.index2Node=[];for(const[i,s]of Object.entries(e))if(!this.ID2index.hasOwnProperty(i)){let l=this.index2Node.length;this.ID2index[i]=l,s.index=l,s.ID=i,this.index2Node.push(s),s.neighbors=[],s.edges=[]}this.indexedEdges=new Int32Array(t.length*2);for(let i=0;i<t.length;i++){const s=t[i];let l=this.ID2index[s.source],u=this.ID2index[s.target];this.indexedEdges[i*2]=l,this.indexedEdges[i*2+1]=u}this.positions=new Float32Array(3*this.index2Node.length),this.colors=new Float32Array(4*this.index2Node.length),this.sizes=new Float32Array(this.index2Node.length),this.outlineColors=new Float32Array(4*this.index2Node.length);for(let i=0;i<this.index2Node.length;i++)this.colors[i*4+3]=1,this.outlineColors[i*4+3]=1;this.outlineWidths=new Float32Array(this.index2Node.length),this.edgePositions=null,this.edgeColors=null,this.edgeSizes=null,this.nodes={};let o=_s([0,this.index2Node.length],[0,1]),a=ps(ws,o);for(let i=0;i<this.index2Node.length;i++){let s=this.index2Node[i];if(s.hasOwnProperty("position")?(this.positions[i*3]=s.position[0],this.positions[i*3+1]=s.position[1],this.positions[i*3+2]=s.position[2]):(this.positions[i*3+0]=(Math.random()-.5)*2*200,this.positions[i*3+1]=(Math.random()-.5)*2*200,this.positions[i*3+2]=(Math.random()-.5)*2*200),s.hasOwnProperty("color"))i==0&&console.log("NODE COLOR:",s.color),this.colors[i*4+0]=s.color[0],this.colors[i*4+1]=s.color[1],this.colors[i*4+2]=s.color[2],s.color.length>3?this.colors[i*4+3]=s.color[3]:this.colors[i*4+3]=1;else{let u=a(i);this.colors[i*4+0]=u[0],this.colors[i*4+1]=u[1],this.colors[i*4+2]=u[2],u.length>3?this.colors[i*4+3]=u[3]:this.colors[i*4+3]=1}s.hasOwnProperty("size")?this.sizes[i]=s.size:this.sizes[i]=1,s.hasOwnProperty("outlineColor")?(this.outlineColors[i*4+0]=s.outlineColor[0],this.outlineColors[i*4+1]=s.outlineColor[1],this.outlineColors[i*4+2]=s.outlineColor[2],s.outlineColor.length>3?this.outlineColors[i*4+3]=s.outlineColor[3]:this.outlineColors[i*4+3]=1):(this.outlineColors[i*4+0]=1,this.outlineColors[i*4+1]=1,this.outlineColors[i*4+2]=1,this.outlineColors[i*4+3]=1),s.hasOwnProperty("outlineWidth")?this.outlineWidths[i]=s.outlineWidth:this.outlineWidths[i]=0;let l=new xs(s,s.ID,i,this);this.index2Node[i]=l,this.nodes[s.ID]=l}for(let i=0;i<t.length;i++){const s=t[i];let l=this.ID2index[s.source],u=this.ID2index[s.target],h=this.index2Node[l],c=this.index2Node[u];h.neighbors.push(c),c.neighbors.push(h),h.edges.push(i),c.edges.push(i)}}get nodeCount(){return this.index2Node.length}updateEdgePositions(){this.edgePositions==null&&(this.edgePositions=new Float32Array(3*this.indexedEdges.length));const e=this.indexedEdges.length,t=this.positions,r=this.edgePositions,o=this.indexedEdges;for(let a=0;a<e/2;a++){const i=o[a*2]*3,s=o[a*2+1]*3,l=a*6,u=l+3;r[l]=t[i],r[l+1]=t[i+1],r[l+2]=t[i+2],r[u]=t[s],r[u+1]=t[s+1],r[u+2]=t[s+2]}}updateEdgeColors(e=!0){this.edgeColors==null&&(this.edgeColors=new Float32Array(4*this.indexedEdges.length));const t=this.indexedEdges.length,r=this.edgeColors,o=this.colors,a=this.indexedEdges;for(let i=0;i<t/2;i++){const s=a[i*2]*4,l=a[i*2+1]*4,u=i*8,h=u+4;r[u]=o[s],r[u+1]=o[s+1],r[u+2]=o[s+2],r[h]=o[l],r[h+1]=o[l+1],r[h+2]=o[l+2],e&&(r[u+3]=o[s+3],r[h+3]=o[l+3])}}updateEdgeSizes(){this.edgeSizes==null&&(this.edgeSizes=new Float32Array(this.indexedEdges.length));const e=this.indexedEdges.length,t=this.edgeSizes,r=this.sizes,o=this.indexedEdges;for(let a=0;a<e/2;a++){const i=o[a*2],s=o[a*2+1];t[a*2]=r[i],t[a*2+1]=r[s]}}updateEdgeOpacity(e){this.edgeColors==null&&(this.edgeColors=new Float32Array(4*this.indexedEdges.length));const t=this.indexedEdges.length,r=this.edgeColors,o=this.colors,a=this.indexedEdges;for(let i=0;i<t/2;i++){const s=a[i*2]*4,l=a[i*2+1]*4;r[i*8+3]=o[s+3],r[i*8+7]=o[l+3]}}}class ks{constructor(e,{FPS:t=120,throttle:r=!0,maxQueueLength:o=10}){this.helios=e,this.needsRender=!1,this.needsUpdateNodesGeometry=!1,this.needsUpdateEdgesGeometry=!1,this._FPS=t,this._throttle=r,this._maxQueueLength=o,this._started=!1,this._paused=!0,this._lastFPS=0,this._averageFPS=0,this._tasks={},this._executionCount=0,this._lastTimestamp=null,this._currentTimestamp=null,this._lastExecutionTimestamp=null,this._lastRequestFrameID=0,this._timeout=null,this._times=[],this._lastRepeatInterval=0,this._shouldCleanup=!1}FPS(e){return e===void 0?this.FPS:(this.FPS=e,this)}schedule({name:e="default",callback:t=null,delay:r=0,repeat:o=!1,maxRepeatCount:a=1/0,maxRepeatTime:i=1/0,repeatInterval:s=0,synchronized:l=!0,immediateUpdates:u=!1,updateNodesGeometry:h=!1,updateEdgesGeometry:c=!1,afterRedraw:f=!1,redraw:d=!0,replace:v=!0}){let g={name:e,callback:t,delay:r,repeat:o,maxRepeatCount:a,maxRepeatTime:i,repeatInterval:s,synchronized:l,immediateUpdates:u,updateNodesGeometry:h,updateEdgesGeometry:c,afterRedraw:f,redraw:d,replace:v,executionCount:0,lastTimestamp:window.performance.now(),lastExecutionTime:0,shouldBeRemoved:!1,cancel:function(){this.shouldBeRemoved=!0,this.synchronized||clearTimeout(this._timeout)}};return e in this._tasks||(this._tasks[e]=[]),v&&this._clearTask(e),l||this.runAsyncTask(g,g.delay),this._addTaskToQueue(g,e),this._paused&&this._started&&this._updateTimeout(),this}runAsyncTask(e,t=0){this._executionCount+=1,e.timeout=setTimeout(()=>{var a;if(e.shouldBeRemoved)return;let r=window.performance.now(),o=r-e.lastTimestamp;if((a=e.callback)==null||a.call(e,o,e),e.executionCount+=1,e.immediateUpdates?this._updateHelios(e.needsRender,e.needsUpdateNodesGeometry,e.needsUpdateEdgesGeometry):(e.redraw&&(this.needsRender=!0),e.updateNodesGeometry&&(this.needsUpdateNodesGeometry=!0),e.updateEdgesGeometry&&(this.needsUpdateEdgesGeometry=!0)),e.repeat){let i=window.performance.now();e.lastExecutionTime=i-r,e.lastTimestamp=r;let s=e.repeatInterval-(i-r);s<0&&(s=0),e.executionCount>=e.maxRepeatCount?e.shouldBeRemoved=!0:this.runAsyncTask(e,s)}else e.shouldBeRemoved=!0;this._started&&this._paused&&this._updateTimeout()},t)}_executeTask(e,t,r){var o;if((o=e.callback)==null||o.call(e,t,e),e===void 0)return!1;if(e.executionCount+=1,e.repeat&&e.executionCount<e.maxRepeatCount){let a=window.performance.now();e.lastExecutionTime=a-r,e.lastTimestamp=r}else e.shouldBeRemoved=!0;return!0}runSyncTasks(){var r,o;if(this._shouldCleanup)return;this._executionCount+=1;let e=[],t=window.performance.now();for(let a of Object.keys(this._tasks).sort()){let i=this._tasks[a];for(let s=0;s<i.length;s++){if((i[s].synchronized||!i[s].immediateUpdates)&&(i[s].redraw&&(this.needsRender=!0),i[s].updateNodesGeometry&&(this.needsUpdateNodesGeometry=!0),i[s].updateEdgesGeometry&&(this.needsUpdateEdgesGeometry=!0)),!((r=i[s])!=null&&r.shouldBeRemoved)){let l=window.performance.now(),u=l-i[s].lastTimestamp+i[s].lastExecutionTime;u<0&&(u=0);let h=!1;if(i[s].executionCount==0?u>=i[s].delay&&(h=!0):u>=i[s].repeatInterval&&(h=!0),h){if(i[s].afterRedraw)e.push({task:i[s],elapsedTime:u,currentTimestamp:l});else if(!this._executeTask(i[s],u,l))break}}(o=i[s])!=null&&o.shouldBeRemoved&&(i.splice(s,1),s--)}i.length==0&&delete this._tasks[a]}this._updateHelios(this.needsRender,this.needsUpdateNodesGeometry,this.needsUpdateEdgesGeometry,!0,e),this._lastTimestamp=t}_updateHelios(e,t,r,o,a){e===void 0&&(e=this.needsRender),t===void 0&&(t=this.needsUpdateNodesGeometry),r===void 0&&(r=this.needsUpdateEdgesGeometry),t&&(this.helios.updateNodesGeometry(),this.needsUpdateNodesGeometry=!1),r&&(this.helios.updateEdgesGeometry(),this.needsUpdateEdgesGeometry=!1),cancelAnimationFrame(this.lastRequestFrameID),this.lastRequestFrameID=requestAnimationFrame(()=>{if(this._shouldCleanup)return;const i=window.performance.now();for(;this._times.length>0&&this._times[0]<=i-1e3;)this._times.shift();this._times.push(i),this._averageFPS=this._times.length,e&&(this.helios.redraw(),this.needsRender=!1),((a==null?void 0:a.length)||0)>0&&a.forEach(s=>{s.task._timeout=setTimeout(()=>{this._executeTask(s.task,s.elapsedTime,s.currentTimestamp)},0)}),o&&(this._lastExecutionTimestamp=window.performance.now(),this._updateTimeout())})}_addTaskToQueue(e,t){let r=this._tasks[t];r.push(e),r.length>this._maxQueueLength&&(r[0].timeout&&(r[0].shouldBeRemoved=!0,clearTimeout(e.taskQueue[0])),r.shift(),console.warn(`One task was discarded because of too many tasks in the ${t} queue. (maxQueueLength = ${this._maxQueueLength})`))}_clearTask(e){if(e in this._tasks){let t=this._tasks[e];for(let r=0;r<t.length;r++){let o=t[r];o.timeout&&(o.shouldBeRemoved=!0,clearTimeout(o.timeout))}t.length=0}}unschedule(e){return e in this._tasks&&(this._clearTask(e),delete this._tasks[e]),this._updateTimeout(),this}hasTask(e){return e in this._tasks}start(){return this._started=!0,this._updateTimeout(),this}stop(){return this._shouldCleanup=!0,clearTimeout(this._timeout),this.paused=!1,this.started=!1,this._lastTimestamp=null,this._lastExecutionTime=0,this}_updateTimeout(){if(clearTimeout(this._timeout),this._started)if(Object.keys(this._tasks).length===0)this.paused=!0;else{this.paused=!1;let e=0,t=window.performance.now();this._lastTimestamp!=null&&this._throttle&&(e=1e3/this._FPS-(t-this._lastTimestamp),e<0&&(e=0)),this._lastFPS=1e3/(t-this._lastTimestamp),this._timeout=setTimeout(()=>{this.runSyncTasks()},e)}}}function tt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Zt={},Cs={get exports(){return Zt},set exports(n){Zt=n}};/*!

pica
https://github.com/nodeca/pica

*/(function(n,e){(function(t){n.exports=t()})(function(){return function(){function t(r,o,a){function i(u,h){if(!o[u]){if(!r[u]){var c=typeof tt=="function"&&tt;if(!h&&c)return c(u,!0);if(s)return s(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=o[u]={exports:{}};r[u][0].call(d.exports,function(v){var g=r[u][1][v];return i(g||v)},d,d.exports,t,r,o,a)}return o[u].exports}for(var s=typeof tt=="function"&&tt,l=0;l<a.length;l++)i(a[l]);return i}return t}()({1:[function(t,r,o){var a=t("multimath"),i=t("./mm_unsharp_mask"),s=t("./mm_resize");function l(u){var h=u||[],c={js:h.indexOf("js")>=0,wasm:h.indexOf("wasm")>=0};a.call(this,c),this.features={js:c.js,wasm:c.wasm&&this.has_wasm()},this.use(i),this.use(s)}l.prototype=Object.create(a.prototype),l.prototype.constructor=l,l.prototype.resizeAndUnsharp=function(u,h){var c=this.resize(u,h);return u.unsharpAmount&&this.unsharp_mask(c,u.toWidth,u.toHeight,u.unsharpAmount,u.unsharpRadius,u.unsharpThreshold),c},r.exports=l},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(t,r,o){function a(c){return c<0?0:c>255?255:c}function i(c){return c>=0?c:0}function s(c,f,d,v,g,p){var _,E,x,m,y,A,k,C,R,P,M,N=0,z=0;for(R=0;R<v;R++){for(y=0,P=0;P<g;P++){for(A=p[y++],k=p[y++],C=N+A*4|0,_=E=x=m=0;k>0;k--)M=p[y++],m=m+M*c[C+3]|0,x=x+M*c[C+2]|0,E=E+M*c[C+1]|0,_=_+M*c[C]|0,C=C+4|0;f[z+3]=i(m>>7),f[z+2]=i(x>>7),f[z+1]=i(E>>7),f[z]=i(_>>7),z=z+v*4|0}z=(R+1)*4|0,N=(R+1)*d*4|0}}function l(c,f,d,v,g,p){var _,E,x,m,y,A,k,C,R,P,M,N=0,z=0;for(R=0;R<v;R++){for(y=0,P=0;P<g;P++){for(A=p[y++],k=p[y++],C=N+A*4|0,_=E=x=m=0;k>0;k--)M=p[y++],m=m+M*c[C+3]|0,x=x+M*c[C+2]|0,E=E+M*c[C+1]|0,_=_+M*c[C]|0,C=C+4|0;_>>=7,E>>=7,x>>=7,m>>=7,f[z+3]=a(m+8192>>14),f[z+2]=a(x+8192>>14),f[z+1]=a(E+8192>>14),f[z]=a(_+8192>>14),z=z+v*4|0}z=(R+1)*4|0,N=(R+1)*d*4|0}}function u(c,f,d,v,g,p){var _,E,x,m,y,A,k,C,R,P,M,N,z=0,b=0;for(P=0;P<v;P++){for(A=0,M=0;M<g;M++){for(k=p[A++],C=p[A++],R=z+k*4|0,_=E=x=m=0;C>0;C--)N=p[A++],y=c[R+3],m=m+N*y|0,x=x+N*c[R+2]*y|0,E=E+N*c[R+1]*y|0,_=_+N*c[R]*y|0,R=R+4|0;x=x/255|0,E=E/255|0,_=_/255|0,f[b+3]=i(m>>7),f[b+2]=i(x>>7),f[b+1]=i(E>>7),f[b]=i(_>>7),b=b+v*4|0}b=(P+1)*4|0,z=(P+1)*d*4|0}}function h(c,f,d,v,g,p){var _,E,x,m,y,A,k,C,R,P,M,N=0,z=0;for(R=0;R<v;R++){for(y=0,P=0;P<g;P++){for(A=p[y++],k=p[y++],C=N+A*4|0,_=E=x=m=0;k>0;k--)M=p[y++],m=m+M*c[C+3]|0,x=x+M*c[C+2]|0,E=E+M*c[C+1]|0,_=_+M*c[C]|0,C=C+4|0;_>>=7,E>>=7,x>>=7,m>>=7,m=a(m+8192>>14),m>0&&(_=_*255/m|0,E=E*255/m|0,x=x*255/m|0),f[z+3]=m,f[z+2]=a(x+8192>>14),f[z+1]=a(E+8192>>14),f[z]=a(_+8192>>14),z=z+v*4|0}z=(R+1)*4|0,N=(R+1)*d*4|0}}r.exports={convolveHor:s,convolveVert:l,convolveHorWithPre:u,convolveVertWithPre:h}},{}],3:[function(t,r,o){r.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(t,r,o){r.exports={name:"resize",fn:t("./resize"),wasm_fn:t("./resize_wasm"),wasm_src:t("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(t,r,o){var a=t("./resize_filter_gen"),i=t("./convolve"),s=i.convolveHor,l=i.convolveVert,u=i.convolveHorWithPre,h=i.convolveVertWithPre;function c(d,v,g){for(var p=3,_=v*g*4|0;p<_;){if(d[p]!==255)return!0;p=p+4|0}return!1}function f(d,v,g){for(var p=3,_=v*g*4|0;p<_;)d[p]=255,p=p+4|0}r.exports=function(d){var v=d.src,g=d.width,p=d.height,_=d.toWidth,E=d.toHeight,x=d.scaleX||d.toWidth/d.width,m=d.scaleY||d.toHeight/d.height,y=d.offsetX||0,A=d.offsetY||0,k=d.dest||new Uint8Array(_*E*4),C=typeof d.filter>"u"?"mks2013":d.filter,R=a(C,g,_,x,y),P=a(C,p,E,m,A),M=new Uint16Array(_*p*4);return c(v,g,p)?(u(v,M,g,p,_,R),h(M,k,p,_,E,P)):(s(v,M,g,p,_,R),l(M,k,p,_,E,P),f(k,_,E)),k}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(t,r,o){var a=t("./resize_filter_info"),i=14;function s(l){return Math.round(l*((1<<i)-1))}r.exports=function(l,u,h,c,f){var d=a.filter[l].fn,v=1/c,g=Math.min(1,c),p=a.filter[l].win/g,_,E,x,m,y,A,k,C,R,P,M,N,z,b,B,w,S,I=Math.floor((p+1)*2),T=new Int16Array((I+2)*h),F=0,O=!T.subarray||!T.set;for(_=0;_<h;_++){for(E=(_+.5)*v+f,x=Math.max(0,Math.floor(E-p)),m=Math.min(u-1,Math.ceil(E+p)),y=m-x+1,A=new Float32Array(y),k=new Int16Array(y),C=0,R=x,P=0;R<=m;R++,P++)M=d((R+.5-E)*g),C+=M,A[P]=M;for(N=0,P=0;P<A.length;P++)z=A[P]/C,N+=z,k[P]=s(z);for(k[h>>1]+=s(1-N),b=0;b<k.length&&k[b]===0;)b++;if(b<k.length){for(B=k.length-1;B>0&&k[B]===0;)B--;if(w=x+b,S=B-b+1,T[F++]=w,T[F++]=S,!O)T.set(k.subarray(b,B+1),F),F+=S;else for(P=b;P<=B;P++)T[F++]=k[P]}else T[F++]=0,T[F++]=0}return T}},{"./resize_filter_info":7}],7:[function(t,r,o){var a={box:{win:.5,fn:function(i){return i<0&&(i=-i),i<.5?1:0}},hamming:{win:1,fn:function(i){if(i<0&&(i=-i),i>=1)return 0;if(i<11920929e-14)return 1;var s=i*Math.PI;return Math.sin(s)/s*(.54+.46*Math.cos(s/1))}},lanczos2:{win:2,fn:function(i){if(i<0&&(i=-i),i>=2)return 0;if(i<11920929e-14)return 1;var s=i*Math.PI;return Math.sin(s)/s*Math.sin(s/2)/(s/2)}},lanczos3:{win:3,fn:function(i){if(i<0&&(i=-i),i>=3)return 0;if(i<11920929e-14)return 1;var s=i*Math.PI;return Math.sin(s)/s*Math.sin(s/3)/(s/3)}},mks2013:{win:2.5,fn:function(i){return i<0&&(i=-i),i>=2.5?0:i>=1.5?-.125*(i-2.5)*(i-2.5):i>=.5?.25*(4*i*i-11*i+7):1.0625-1.75*i*i}}};r.exports={filter:a,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(t,r,o){var a=t("./resize_filter_gen");function i(c,f,d){for(var v=3,g=f*d*4|0;v<g;){if(c[v]!==255)return!0;v=v+4|0}return!1}function s(c,f,d){for(var v=3,g=f*d*4|0;v<g;)c[v]=255,v=v+4|0}function l(c){return new Uint8Array(c.buffer,0,c.byteLength)}var u=!0;try{u=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function h(c,f,d){if(u){f.set(l(c),d);return}for(var v=d,g=0;g<c.length;g++){var p=c[g];f[v++]=p&255,f[v++]=p>>8&255}}r.exports=function(c){var f=c.src,d=c.width,v=c.height,g=c.toWidth,p=c.toHeight,_=c.scaleX||c.toWidth/c.width,E=c.scaleY||c.toHeight/c.height,x=c.offsetX||0,m=c.offsetY||0,y=c.dest||new Uint8Array(g*p*4),A=typeof c.filter>"u"?"mks2013":c.filter,k=a(A,d,g,_,x),C=a(A,v,p,E,m),R=0,P=Math.max(f.byteLength,y.byteLength),M=this.__align(R+P),N=v*g*4*2,z=this.__align(M+N),b=this.__align(z+k.byteLength),B=b+C.byteLength,w=this.__instance("resize",B),S=new Uint8Array(this.__memory.buffer),I=new Uint32Array(this.__memory.buffer),T=new Uint32Array(f.buffer);I.set(T),h(k,S,z),h(C,S,b);var F=w.exports.convolveHV||w.exports._convolveHV;i(f,d,v)?F(z,b,M,d,v,g,p,1):(F(z,b,M,d,v,g,p,0),s(y,g,p));var O=new Uint32Array(y.buffer);return O.set(new Uint32Array(this.__memory.buffer,0,p*g)),y}},{"./resize_filter_gen":6}],9:[function(t,r,o){r.exports={name:"unsharp_mask",fn:t("./unsharp_mask"),wasm_fn:t("./unsharp_mask_wasm"),wasm_src:t("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(t,r,o){var a=t("glur/mono16");function i(s,l,u){for(var h=l*u,c=new Uint16Array(h),f,d,v,g,p=0;p<h;p++)f=s[4*p],d=s[4*p+1],v=s[4*p+2],g=f>=d&&f>=v?f:d>=v&&d>=f?d:v,c[p]=g<<8;return c}r.exports=function(s,l,u,h,c,f){var d,v,g,p,_;if(!(h===0||c<.5)){c>2&&(c=2);var E=i(s,l,u),x=new Uint16Array(E);a(x,l,u,c);for(var m=h/100*4096+.5|0,y=f<<8,A=l*u,k=0;k<A;k++)d=E[k],p=d-x[k],Math.abs(p)>=y&&(v=d+(m*p+2048>>12),v=v>65280?65280:v,v=v<0?0:v,d=d!==0?d:1,g=(v<<12)/d|0,_=k*4,s[_]=s[_]*g+2048>>12,s[_+1]=s[_+1]*g+2048>>12,s[_+2]=s[_+2]*g+2048>>12)}}},{"glur/mono16":18}],11:[function(t,r,o){r.exports=function(a,i,s,l,u,h){if(!(l===0||u<.5)){u>2&&(u=2);var c=i*s,f=c*4,d=c*2,v=c*2,g=Math.max(i,s)*4,p=8*4,_=0,E=f,x=E+d,m=x+v,y=m+v,A=y+g,k=this.__instance("unsharp_mask",f+d+v*2+g+p,{exp:Math.exp}),C=new Uint32Array(a.buffer),R=new Uint32Array(this.__memory.buffer);R.set(C);var P=k.exports.hsv_v16||k.exports._hsv_v16;P(_,E,i,s),P=k.exports.blurMono16||k.exports._blurMono16,P(E,x,m,y,A,i,s,u),P=k.exports.unsharp||k.exports._unsharp,P(_,_,E,x,i,s,l,h),C.set(new Uint32Array(this.__memory.buffer,0,c))}}},{}],12:[function(t,r,o){r.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAE0B2AAAGAEf39/fwBgBn9/f39/fwBgCH9/f39/f39/AGAIf39/f39/f30AYAJ9fwBgAXwBfAIZAgNlbnYDZXhwAAYDZW52Bm1lbW9yeQIAAAMHBgAFAgQBAwYGAX8AQQALB4oBCBFfX3dhc21fY2FsbF9jdG9ycwABFl9fYnVpbGRfZ2F1c3NpYW5fY29lZnMAAg5fX2dhdXNzMTZfbGluZQADCmJsdXJNb25vMTYABAdoc3ZfdjE2AAUHdW5zaGFycAAGDF9fZHNvX2hhbmRsZQMAGF9fd2FzbV9hcHBseV9kYXRhX3JlbG9jcwABCsUMBgMAAQvWAQEHfCABRNuGukOCGvs/IAC7oyICRAAAAAAAAADAohAAIgW2jDgCFCABIAKaEAAiAyADoCIGtjgCECABRAAAAAAAAPA/IAOhIgQgBKIgAyACIAKgokQAAAAAAADwP6AgBaGjIgS2OAIAIAEgBSAEmqIiB7Y4AgwgASADIAJEAAAAAAAA8D+gIASioiIItjgCCCABIAMgAkQAAAAAAADwv6AgBKKiIgK2OAIEIAEgByAIoCAFRAAAAAAAAPA/IAahoCIDo7Y4AhwgASAEIAKgIAOjtjgCGAuGBQMGfwl8An0gAyoCDCEVIAMqAgghFiADKgIUuyERIAMqAhC7IRACQCAEQQFrIghBAEgiCQRAIAIhByAAIQYMAQsgAiAALwEAuCIPIAMqAhi7oiIMIBGiIg0gDCAQoiAPIAMqAgS7IhOiIhQgAyoCALsiEiAPoqCgoCIOtjgCACACQQRqIQcgAEECaiEGIAhFDQAgCEEBIAhBAUgbIgpBf3MhCwJ/IAQgCmtBAXFFBEAgDiENIAgMAQsgAiANIA4gEKIgFCASIAAvAQK4Ig+ioKCgIg22OAIEIAJBCGohByAAQQRqIQYgDiEMIARBAmsLIQIgC0EAIARrRg0AA0AgByAMIBGiIA0gEKIgDyAToiASIAYvAQC4Ig6ioKCgIgy2OAIAIAcgDSARoiAMIBCiIA4gE6IgEiAGLwECuCIPoqCgoCINtjgCBCAHQQhqIQcgBkEEaiEGIAJBAkohACACQQJrIQIgAA0ACwsCQCAJDQAgASAFIAhsQQF0aiIAAn8gBkECay8BACICuCINIBW7IhKiIA0gFrsiE6KgIA0gAyoCHLuiIgwgEKKgIAwgEaKgIg8gB0EEayIHKgIAu6AiDkQAAAAAAADwQWMgDkQAAAAAAAAAAGZxBEAgDqsMAQtBAAs7AQAgCEUNACAGQQRrIQZBACAFa0EBdCEBA0ACfyANIBKiIAJB//8DcbgiDSAToqAgDyIOIBCioCAMIBGioCIPIAdBBGsiByoCALugIgxEAAAAAAAA8EFjIAxEAAAAAAAAAABmcQRAIAyrDAELQQALIQMgBi8BACECIAAgAWoiACADOwEAIAZBAmshBiAIQQFKIQMgDiEMIAhBAWshCCADDQALCwvRAgIBfwd8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIglEAAAAAAAAAMCiEAAiDLaMOAIUIAQgCZoQACIKIAqgIg22OAIQIAREAAAAAAAA8D8gCqEiCyALoiAKIAkgCaCiRAAAAAAAAPA/oCAMoaMiC7Y4AgAgBCAMIAuaoiIOtjgCDCAEIAogCUQAAAAAAADwP6AgC6KiIg+2OAIIIAQgCiAJRAAAAAAAAPC/oCALoqIiCbY4AgQgBCAOIA+gIAxEAAAAAAAA8D8gDaGgIgqjtjgCHCAEIAsgCaAgCqO2OAIYIAYEQANAIAAgBSAIbEEBdGogAiAIQQF0aiADIAQgBSAGEAMgCEEBaiIIIAZHDQALCyAFRQ0AQQAhCANAIAIgBiAIbEEBdGogASAIQQF0aiADIAQgBiAFEAMgCEEBaiIIIAVHDQALCwtxAQN/IAIgA2wiBQRAA0AgASAAKAIAIgRBEHZB/wFxIgIgAiAEQQh2Qf8BcSIDIAMgBEH/AXEiBEkbIAIgA0sbIgYgBiAEIAIgBEsbIAMgBEsbQQh0OwEAIAFBAmohASAAQQRqIQAgBUEBayIFDQALCwuZAgIDfwF8IAQgBWwhBAJ/IAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6AiC5lEAAAAAAAA4EFjBEAgC6oMAQtBgICAgHgLIQUgBARAIAdBCHQhCUEAIQYDQCAJIAIgBkEBdCIHai8BACIBIAMgB2ovAQBrIgcgB0EfdSIIaiAIc00EQCAAIAZBAnQiCGoiCiAFIAdsQYAQakEMdSABaiIHQYD+AyAHQYD+A0gbIgdBACAHQQBKG0EMdCABQQEgARtuIgEgCi0AAGxBgBBqQQx2OgAAIAAgCEEBcmoiByABIActAABsQYAQakEMdjoAACAAIAhBAnJqIgcgASAHLQAAbEGAEGpBDHY6AAALIAZBAWoiBiAERw0ACwsL"},{}],13:[function(t,r,o){var a=100;function i(s,l){this.create=s,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=l||2e3}i.prototype.acquire=function(){var s=this,l;return this.available.length!==0?l=this.available.pop():(l=this.create(),l.id=this.lastId++,l.release=function(){return s.release(l)}),this.acquired[l.id]=l,l},i.prototype.release=function(s){var l=this;delete this.acquired[s.id],s.lastUsed=Date.now(),this.available.push(s),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return l.gc()},a))},i.prototype.gc=function(){var s=this,l=Date.now();this.available=this.available.filter(function(u){return l-u.lastUsed>s.idle?(u.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return s.gc()},a):this.timeoutId=0},r.exports=i},{}],14:[function(t,r,o){var a=2;r.exports=function(i,s,l,u,h,c){var f=l/i,d=u/s,v=(2*c+a+1)/h;if(v>.5)return[[l,u]];var g=Math.ceil(Math.log(Math.min(f,d))/Math.log(v));if(g<=1)return[[l,u]];for(var p=[],_=0;_<g;_++){var E=Math.round(Math.pow(Math.pow(i,g-_-1)*Math.pow(l,_+1),1/g)),x=Math.round(Math.pow(Math.pow(s,g-_-1)*Math.pow(u,_+1),1/g));p.push([E,x])}return p}},{}],15:[function(t,r,o){var a=1e-5;function i(l){var u=Math.round(l);return Math.abs(l-u)<a?u:Math.floor(l)}function s(l){var u=Math.round(l);return Math.abs(l-u)<a?u:Math.ceil(l)}r.exports=function(l){var u=l.toWidth/l.width,h=l.toHeight/l.height,c=i(l.srcTileSize*u)-2*l.destTileBorder,f=i(l.srcTileSize*h)-2*l.destTileBorder;if(c<1||f<1)throw new Error("Internal error in pica: target tile width/height is too small.");var d,v,g,p,_,E,x=[],m;for(p=0;p<l.toHeight;p+=f)for(g=0;g<l.toWidth;g+=c)d=g-l.destTileBorder,d<0&&(d=0),_=g+c+l.destTileBorder-d,d+_>=l.toWidth&&(_=l.toWidth-d),v=p-l.destTileBorder,v<0&&(v=0),E=p+f+l.destTileBorder-v,v+E>=l.toHeight&&(E=l.toHeight-v),m={toX:d,toY:v,toWidth:_,toHeight:E,toInnerX:g,toInnerY:p,toInnerWidth:c,toInnerHeight:f,offsetX:d/u-i(d/u),offsetY:v/h-i(v/h),scaleX:u,scaleY:h,x:i(d/u),y:i(v/h),width:s(_/u),height:s(E/h)},x.push(m);return x}},{}],16:[function(t,r,o){function a(i){return Object.prototype.toString.call(i)}r.exports.isCanvas=function(i){var s=a(i);return s==="[object HTMLCanvasElement]"||s==="[object OffscreenCanvas]"||s==="[object Canvas]"},r.exports.isImage=function(i){return a(i)==="[object HTMLImageElement]"},r.exports.isImageBitmap=function(i){return a(i)==="[object ImageBitmap]"},r.exports.limiter=function(i){var s=0,l=[];function u(){s<i&&l.length&&(s++,l.shift()())}return function(h){return new Promise(function(c,f){l.push(function(){h().then(function(d){c(d),s--,u()},function(d){f(d),s--,u()})}),u()})}},r.exports.cib_quality_name=function(i){switch(i){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},r.exports.cib_support=function(i){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var s=i(100,100);return createImageBitmap(s,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(l){var u=l.width===10;return l.close(),s=null,u})}).catch(function(){return!1})},r.exports.worker_offscreen_canvas_support=function(){return new Promise(function(i,s){if(typeof OffscreenCanvas>"u"){i(!1);return}function l(c){if(typeof createImageBitmap>"u"){c.postMessage(!1);return}Promise.resolve().then(function(){var f=new OffscreenCanvas(10,10),d=f.getContext("2d");return d.rect(0,0,1,1),createImageBitmap(f,0,0,1,1)}).then(function(){return c.postMessage(!0)},function(){return c.postMessage(!1)})}var u=btoa("(".concat(l.toString(),")(self);")),h=new Worker("data:text/javascript;base64,".concat(u));h.onmessage=function(c){return i(c.data)},h.onerror=s}).then(function(i){return i},function(){return!1})},r.exports.can_use_canvas=function(i){var s=!1;try{var l=i(2,1),u=l.getContext("2d"),h=u.createImageData(2,1);h.data[0]=12,h.data[1]=23,h.data[2]=34,h.data[3]=255,h.data[4]=45,h.data[5]=56,h.data[6]=67,h.data[7]=255,u.putImageData(h,0,0),h=null,h=u.getImageData(0,0,2,1),h.data[0]===12&&h.data[1]===23&&h.data[2]===34&&h.data[3]===255&&h.data[4]===45&&h.data[5]===56&&h.data[6]===67&&h.data[7]===255&&(s=!0)}catch{}return s},r.exports.cib_can_use_region=function(){return new Promise(function(i){if(typeof Image>"u"||typeof createImageBitmap>"u"){i(!1);return}var s=new Image;s.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",s.onload=function(){createImageBitmap(s,0,0,s.width,s.height).then(function(l){l.width===s.width&&l.height===s.height?i(!0):i(!1)},function(){return i(!1)})},s.onerror=function(){return i(!1)}})}},{}],17:[function(t,r,o){r.exports=function(){var a=t("./mathlib"),i;onmessage=function(s){var l=s.data.opts;if(!l.src&&l.srcBitmap){var u=new OffscreenCanvas(l.width,l.height),h=u.getContext("2d");h.drawImage(l.srcBitmap,0,0),l.src=h.getImageData(0,0,l.width,l.height).data,u.width=u.height=0,u=null,l.srcBitmap.close(),l.srcBitmap=null}i||(i=new a(s.data.features));var c=i.resizeAndUnsharp(l);postMessage({data:c},[c.buffer])}}},{"./mathlib":1}],18:[function(t,r,o){var a,i,s,l,u,h,c,f;function d(p){p<.5&&(p=.5);var _=Math.exp(.726*.726)/p,E=Math.exp(-_),x=Math.exp(-2*_),m=(1-E)*(1-E)/(1+2*_*E-x);return a=m,i=m*(_-1)*E,s=m*(_+1)*E,l=-m*x,u=2*E,h=-x,c=(a+i)/(1-u-h),f=(s+l)/(1-u-h),new Float32Array([a,i,s,l,u,h,c,f])}function v(p,_,E,x,m,y){var A,k,C,R,P,M,N,z,b,B,w,S,I,T;for(b=0;b<y;b++){for(M=b*m,N=b,z=0,A=p[M],P=A*x[6],R=P,w=x[0],S=x[1],I=x[4],T=x[5],B=0;B<m;B++)k=p[M],C=k*w+A*S+R*I+P*T,P=R,R=C,A=k,E[z]=R,z++,M++;for(M--,z--,N+=y*(m-1),A=p[M],P=A*x[7],R=P,k=A,w=x[2],S=x[3],B=m-1;B>=0;B--)C=k*w+A*S+R*I+P*T,P=R,R=C,A=k,k=p[M],_[N]=E[z]+R,M--,z--,N-=y}}function g(p,_,E,x){if(x){var m=new Uint16Array(p.length),y=new Float32Array(Math.max(_,E)),A=d(x);v(p,m,y,A,_,E),v(m,p,y,A,E,_)}}r.exports=g},{}],19:[function(t,r,o){var a=t("object-assign"),i=t("./lib/base64decode"),s=t("./lib/wa_detect"),l={js:!0,wasm:!0};function u(h){if(!(this instanceof u))return new u(h);var c=a({},l,h||{});if(this.options=c,this.__cache={},this.__init_promise=null,this.__modules=c.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}u.prototype.has_wasm=s,u.prototype.use=function(h){return this.__modules[h.name]=h,this.options.wasm&&this.has_wasm()&&h.wasm_fn?this[h.name]=h.wasm_fn:this[h.name]=h.fn,this},u.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var h=this;return this.__init_promise=Promise.all(Object.keys(h.__modules).map(function(c){var f=h.__modules[c];return!h.options.wasm||!h.has_wasm()||!f.wasm_fn||h.__wasm[c]?null:WebAssembly.compile(h.__base64decode(f.wasm_src)).then(function(d){h.__wasm[c]=d})})).then(function(){return h}),this.__init_promise},u.prototype.__base64decode=i,u.prototype.__reallocate=function(h){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(h/(64*1024))}),this.__memory;var c=this.__memory.buffer.byteLength;return c<h&&this.__memory.grow(Math.ceil((h-c)/(64*1024))),this.__memory},u.prototype.__instance=function(h,c,f){if(c&&this.__reallocate(c),!this.__wasm[h]){var d=this.__modules[h];this.__wasm[h]=new WebAssembly.Module(this.__base64decode(d.wasm_src))}if(!this.__cache[h]){var v={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[h]=new WebAssembly.Instance(this.__wasm[h],{env:a(v,f||{})})}return this.__cache[h]},u.prototype.__align=function(h,c){c=c||8;var f=h%c;return h+(f?c-f:0)},r.exports=u},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(t,r,o){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";r.exports=function(i){for(var s=i.replace(/[\r\n=]/g,""),l=s.length,u=new Uint8Array(l*3>>2),h=0,c=0,f=0;f<l;f++)f%4===0&&f&&(u[c++]=h>>16&255,u[c++]=h>>8&255,u[c++]=h&255),h=h<<6|a.indexOf(s.charAt(f));var d=l%4*6;return d===0?(u[c++]=h>>16&255,u[c++]=h>>8&255,u[c++]=h&255):d===18?(u[c++]=h>>10&255,u[c++]=h>>2&255):d===12&&(u[c++]=h>>4&255),u}},{}],21:[function(t,r,o){var a;r.exports=function(){if(typeof a<"u"||(a=!1,typeof WebAssembly>"u"))return a;try{var i=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),s=new WebAssembly.Module(i),l=new WebAssembly.Instance(s,{});return l.exports.test(4)!==0&&(a=!0),a}catch{}return a}},{}],22:[function(t,r,o){var a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function l(h){if(h==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(h)}function u(){try{if(!Object.assign)return!1;var h=new String("abc");if(h[5]="de",Object.getOwnPropertyNames(h)[0]==="5")return!1;for(var c={},f=0;f<10;f++)c["_"+String.fromCharCode(f)]=f;var d=Object.getOwnPropertyNames(c).map(function(g){return c[g]});if(d.join("")!=="0123456789")return!1;var v={};return"abcdefghijklmnopqrst".split("").forEach(function(g){v[g]=g}),Object.keys(Object.assign({},v)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}r.exports=u()?Object.assign:function(h,c){for(var f,d=l(h),v,g=1;g<arguments.length;g++){f=Object(arguments[g]);for(var p in f)i.call(f,p)&&(d[p]=f[p]);if(a){v=a(f);for(var _=0;_<v.length;_++)s.call(f,v[_])&&(d[v[_]]=f[v[_]])}}return d}},{}],23:[function(t,r,o){var a=arguments[3],i=arguments[4],s=arguments[5],l=JSON.stringify;r.exports=function(u,h){for(var c,f=Object.keys(s),d=0,v=f.length;d<v;d++){var g=f[d],p=s[g].exports;if(p===u||p&&p.default===u){c=g;break}}if(!c){c=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var _={},d=0,v=f.length;d<v;d++){var g=f[d];_[g]=g}i[c]=["function(require,module,exports){"+u+"(self); }",_]}var E=Math.floor(Math.pow(16,8)*Math.random()).toString(16),x={};x[c]=c,i[E]=["function(require,module,exports){var f = require("+l(c)+");(f.default ? f.default : f)(self);}",x];var m={};y(E);function y(M){m[M]=!0;for(var N in i[M][1]){var z=i[M][1][N];m[z]||y(z)}}var A="("+a+")({"+Object.keys(m).map(function(M){return l(M)+":["+i[M][0]+","+l(i[M][1])+"]"}).join(",")+"},{},["+l(E)+"])",k=window.URL||window.webkitURL||window.mozURL||window.msURL,C=new Blob([A],{type:"text/javascript"});if(h&&h.bare)return C;var R=k.createObjectURL(C),P=new Worker(R);return P.objectURL=R,P}},{}],"/index.js":[function(t,r,o){function a(w,S){return h(w)||u(w,S)||s(w,S)||i()}function i(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s(w,S){if(w){if(typeof w=="string")return l(w,S);var I=Object.prototype.toString.call(w).slice(8,-1);if(I==="Object"&&w.constructor&&(I=w.constructor.name),I==="Map"||I==="Set")return Array.from(w);if(I==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(I))return l(w,S)}}function l(w,S){(S==null||S>w.length)&&(S=w.length);for(var I=0,T=new Array(S);I<S;I++)T[I]=w[I];return T}function u(w,S){var I=w==null?null:typeof Symbol<"u"&&w[Symbol.iterator]||w["@@iterator"];if(I!=null){var T=[],F=!0,O=!1,D,U;try{for(I=I.call(w);!(F=(D=I.next()).done)&&(T.push(D.value),!(S&&T.length===S));F=!0);}catch(L){O=!0,U=L}finally{try{!F&&I.return!=null&&I.return()}finally{if(O)throw U}}return T}}function h(w){if(Array.isArray(w))return w}var c=t("object-assign"),f=t("webworkify"),d=t("./lib/mathlib"),v=t("./lib/pool"),g=t("./lib/utils"),p=t("./lib/worker"),_=t("./lib/stepper"),E=t("./lib/tiler"),x=t("./lib/mm_resize/resize_filter_info"),m={},y=!1;try{typeof navigator<"u"&&navigator.userAgent&&(y=navigator.userAgent.indexOf("Safari")>=0)}catch{}var A=1;typeof navigator<"u"&&(A=Math.min(navigator.hardwareConcurrency||1,4));var k={tile:1024,concurrency:A,features:["js","wasm","ww"],idle:2e3,createCanvas:function(w,S){var I=document.createElement("canvas");return I.width=w,I.height=S,I}},C={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},R=!1,P=!1,M=!1,N=!1,z=!1;function b(){return{value:f(p),destroy:function(){if(this.value.terminate(),typeof window<"u"){var w=window.URL||window.webkitURL||window.mozURL||window.msURL;w&&w.revokeObjectURL&&this.value.objectURL&&w.revokeObjectURL(this.value.objectURL)}}}}function B(w){if(!(this instanceof B))return new B(w);this.options=c({},k,w||{});var S="lk_".concat(this.options.concurrency);this.__limit=m[S]||g.limiter(this.options.concurrency),m[S]||(m[S]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}B.prototype.init=function(){var w=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),R=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?P=!0:this.debug("ImageBitmap does not support .close(), disabled"));var S=this.options.features.slice();if(S.indexOf("all")>=0&&(S=["cib","wasm","js","ww"]),this.__requested_features=S,this.__mathlib=new d(S),S.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var I=t("webworkify")(function(){});I.terminate(),this.features.ww=!0;var T="wp_".concat(JSON.stringify(this.options));m[T]?this.__workersPool=m[T]:(this.__workersPool=new v(b,this.options.idle),m[T]=this.__workersPool)}catch{}var F=this.__mathlib.init().then(function(L){c(w.features,L.features)}),O;P?O=g.cib_support(this.options.createCanvas).then(function(L){if(w.features.cib&&S.indexOf("cib")<0){w.debug("createImageBitmap() resize supported, but disabled by config");return}S.indexOf("cib")>=0&&(w.features.cib=L)}):O=Promise.resolve(!1),M=g.can_use_canvas(this.options.createCanvas);var D;P&&R&&S.indexOf("ww")!==-1?D=g.worker_offscreen_canvas_support():D=Promise.resolve(!1),D=D.then(function(L){N=L});var U=g.cib_can_use_region().then(function(L){z=L});return this.__initPromise=Promise.all([F,O,D,U]).then(function(){return w}),this.__initPromise},B.prototype.__invokeResize=function(w,S){var I=this;return S.__mathCache=S.__mathCache||{},Promise.resolve().then(function(){return I.features.ww?new Promise(function(T,F){var O=I.__workersPool.acquire();S.cancelToken&&S.cancelToken.catch(function(U){return F(U)}),O.value.onmessage=function(U){O.release(),U.data.err?F(U.data.err):T(U.data)};var D=[];w.src&&D.push(w.src.buffer),w.srcBitmap&&D.push(w.srcBitmap),O.value.postMessage({opts:w,features:I.__requested_features,preload:{wasm_nodule:I.__mathlib.__}},D)}):{data:I.__mathlib.resizeAndUnsharp(w,S.__mathCache)}})},B.prototype.__extractTileData=function(w,S,I,T,F){if(this.features.ww&&N&&(g.isCanvas(S)||z))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(T.srcImageBitmap||S,w.x,w.y,w.width,w.height).then(function(U){return F.srcBitmap=U,F});if(g.isCanvas(S))return T.srcCtx||(T.srcCtx=S.getContext("2d")),this.debug("Get tile pixel data"),F.src=T.srcCtx.getImageData(w.x,w.y,w.width,w.height).data,F;this.debug("Draw tile imageBitmap/image to temporary canvas");var O=this.options.createCanvas(w.width,w.height),D=O.getContext("2d");return D.globalCompositeOperation="copy",D.drawImage(T.srcImageBitmap||S,w.x,w.y,w.width,w.height,0,0,w.width,w.height),this.debug("Get tile pixel data"),F.src=D.getImageData(0,0,w.width,w.height).data,O.width=O.height=0,F},B.prototype.__landTileData=function(w,S,I){var T;if(this.debug("Convert raw rgba tile result to ImageData"),S.bitmap)return I.toCtx.drawImage(S.bitmap,w.toX,w.toY),null;if(R)T=new ImageData(new Uint8ClampedArray(S.data),w.toWidth,w.toHeight);else if(T=I.toCtx.createImageData(w.toWidth,w.toHeight),T.data.set)T.data.set(S.data);else for(var F=T.data.length-1;F>=0;F--)T.data[F]=S.data[F];return this.debug("Draw tile"),y?I.toCtx.putImageData(T,w.toX,w.toY,w.toInnerX-w.toX,w.toInnerY-w.toY,w.toInnerWidth+1e-5,w.toInnerHeight+1e-5):I.toCtx.putImageData(T,w.toX,w.toY,w.toInnerX-w.toX,w.toInnerY-w.toY,w.toInnerWidth,w.toInnerHeight),null},B.prototype.__tileAndResize=function(w,S,I){var T=this,F={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},O=function(D){return T.__limit(function(){if(I.canceled)return I.cancelToken;var U={width:D.width,height:D.height,toWidth:D.toWidth,toHeight:D.toHeight,scaleX:D.scaleX,scaleY:D.scaleY,offsetX:D.offsetX,offsetY:D.offsetY,filter:I.filter,unsharpAmount:I.unsharpAmount,unsharpRadius:I.unsharpRadius,unsharpThreshold:I.unsharpThreshold};return T.debug("Invoke resize math"),Promise.resolve(U).then(function(L){return T.__extractTileData(D,w,I,F,L)}).then(function(L){return T.debug("Invoke resize math"),T.__invokeResize(L,I)}).then(function(L){return I.canceled?I.cancelToken:(F.srcImageData=null,T.__landTileData(D,L,F))})})};return Promise.resolve().then(function(){if(F.toCtx=S.getContext("2d"),g.isCanvas(w))return null;if(g.isImageBitmap(w))return F.srcImageBitmap=w,F.isImageBitmapReused=!0,null;if(g.isImage(w))return P?(T.debug("Decode image via createImageBitmap"),createImageBitmap(w).then(function(D){F.srcImageBitmap=D}).catch(function(D){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(I.canceled)return I.cancelToken;T.debug("Calculate tiles");var D=E({width:I.width,height:I.height,srcTileSize:T.options.tile,toWidth:I.toWidth,toHeight:I.toHeight,destTileBorder:I.__destTileBorder}),U=D.map(function(Q){return O(Q)});function L(Q){Q.srcImageBitmap&&(Q.isImageBitmapReused||Q.srcImageBitmap.close(),Q.srcImageBitmap=null)}return T.debug("Process tiles"),Promise.all(U).then(function(){return T.debug("Finished!"),L(F),S},function(Q){throw L(F),Q})})},B.prototype.__processStages=function(w,S,I,T){var F=this;if(T.canceled)return T.cancelToken;var O=w.shift(),D=a(O,2),U=D[0],L=D[1],Q=w.length===0,G;Q||x.q2f.indexOf(T.filter)<0?G=T.filter:T.filter==="box"?G="box":G="hamming",T=c({},T,{toWidth:U,toHeight:L,filter:G});var j;return Q||(j=this.options.createCanvas(U,L)),this.__tileAndResize(S,Q?I:j,T).then(function(){return Q?I:(T.width=U,T.height=L,F.__processStages(w,j,I,T))}).then(function(V){return j&&(j.width=j.height=0),V})},B.prototype.__resizeViaCreateImageBitmap=function(w,S,I){var T=this,F=S.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(w,{resizeWidth:I.toWidth,resizeHeight:I.toHeight,resizeQuality:g.cib_quality_name(x.f2q[I.filter])}).then(function(O){if(I.canceled)return I.cancelToken;if(!I.unsharpAmount)return F.drawImage(O,0,0),O.close(),F=null,T.debug("Finished!"),S;T.debug("Unsharp result");var D=T.options.createCanvas(I.toWidth,I.toHeight),U=D.getContext("2d");U.drawImage(O,0,0),O.close();var L=U.getImageData(0,0,I.toWidth,I.toHeight);return T.__mathlib.unsharp_mask(L.data,I.toWidth,I.toHeight,I.unsharpAmount,I.unsharpRadius,I.unsharpThreshold),F.putImageData(L,0,0),D.width=D.height=0,L=U=D=F=null,T.debug("Finished!"),S})},B.prototype.resize=function(w,S,I){var T=this;this.debug("Start resize...");var F=c({},C);if(isNaN(I)?I&&(F=c(F,I)):F=c(F,{quality:I}),F.toWidth=S.width,F.toHeight=S.height,F.width=w.naturalWidth||w.width,F.height=w.naturalHeight||w.height,Object.prototype.hasOwnProperty.call(F,"quality")){if(F.quality<0||F.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(F.quality));F.filter=x.q2f[F.quality]}if(S.width===0||S.height===0)return Promise.reject(new Error("Invalid output size: ".concat(S.width,"x").concat(S.height)));F.unsharpRadius>2&&(F.unsharpRadius=2),F.canceled=!1,F.cancelToken&&(F.cancelToken=F.cancelToken.then(function(D){throw F.canceled=!0,D},function(D){throw F.canceled=!0,D}));var O=3;return F.__destTileBorder=Math.ceil(Math.max(O,2.5*F.unsharpRadius|0)),this.init().then(function(){if(F.canceled)return F.cancelToken;if(T.features.cib){if(x.q2f.indexOf(F.filter)>=0)return T.__resizeViaCreateImageBitmap(w,S,F);T.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!M){var D=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw D.code="ERR_GET_IMAGE_DATA",D}var U=_(F.width,F.height,F.toWidth,F.toHeight,T.options.tile,F.__destTileBorder);return T.__processStages(U,w,S,F)})},B.prototype.resizeBuffer=function(w){var S=this,I=c({},C,w);if(Object.prototype.hasOwnProperty.call(I,"quality")){if(I.quality<0||I.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(I.quality));I.filter=x.q2f[I.quality]}return this.init().then(function(){return S.__mathlib.resizeAndUnsharp(I)})},B.prototype.toBlob=function(w,S,I){return S=S||"image/png",new Promise(function(T){if(w.toBlob){w.toBlob(function(L){return T(L)},S,I);return}if(w.convertToBlob){T(w.convertToBlob({type:S,quality:I}));return}for(var F=atob(w.toDataURL(S,I).split(",")[1]),O=F.length,D=new Uint8Array(O),U=0;U<O;U++)D[U]=F.charCodeAt(U);T(new Blob([D],{type:S}))})},B.prototype.debug=function(){},r.exports=B},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})})(Cs);let Is=function(){var n=function(e){};(function(e,t){typeof H=="object"&&typeof de<"u"?t(H):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})})(this,function(e){var t={value:()=>{}};function r(){for(var l,u=0,h=arguments.length,c={};u<h;++u){if(!(l=arguments[u]+"")||l in c||/[\s.]/.test(l))throw new Error("illegal type: "+l);c[l]=[]}return new o(c)}function o(l){this._=l}function a(l,u){return l.trim().split(/^|\s+/).map(function(h){var c="",f=h.indexOf(".");if(f>=0&&(c=h.slice(f+1),h=h.slice(0,f)),h&&!u.hasOwnProperty(h))throw new Error("unknown type: "+h);return{type:h,name:c}})}function i(l,u){for(var h,c=0,f=l.length;c<f;++c)if((h=l[c]).name===u)return h.value}function s(l,u,h){for(var c=0,f=l.length;c<f;++c)if(l[c].name===u){l[c]=t,l=l.slice(0,c).concat(l.slice(c+1));break}return h!=null&&l.push({name:u,value:h}),l}o.prototype=r.prototype={constructor:o,on:function(l,u){var h,c=this._,f=a(l+"",c),d=-1,v=f.length;if(!(arguments.length<2)){if(u!=null&&typeof u!="function")throw new Error("invalid callback: "+u);for(;++d<v;)if(h=(l=f[d]).type)c[h]=s(c[h],l.name,u);else if(u==null)for(h in c)c[h]=s(c[h],l.name,null);return this}for(;++d<v;)if((h=(l=f[d]).type)&&(h=i(c[h],l.name)))return h},copy:function(){var l={},u=this._;for(var h in u)l[h]=u[h].slice();return new o(l)},call:function(l,u){if((h=arguments.length-2)>0)for(var h,c,f=new Array(h),d=0;d<h;++d)f[d]=arguments[d+2];if(!this._.hasOwnProperty(l))throw new Error("unknown type: "+l);for(d=0,h=(c=this._[l]).length;d<h;++d)c[d].value.apply(u,f)},apply:function(l,u,h){if(!this._.hasOwnProperty(l))throw new Error("unknown type: "+l);for(var c=this._[l],f=0,d=c.length;f<d;++f)c[f].value.apply(u,h)}},e.dispatch=r,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function t(h,c,f,d){if(isNaN(c)||isNaN(f))return h;var v,g,p,_,E,x,m,y,A,k=h._root,C={data:d},R=h._x0,P=h._y0,M=h._x1,N=h._y1;if(!k)return h._root=C,h;for(;k.length;)if((x=c>=(g=(R+M)/2))?R=g:M=g,(m=f>=(p=(P+N)/2))?P=p:N=p,v=k,!(k=k[y=m<<1|x]))return v[y]=C,h;if(_=+h._x.call(null,k.data),E=+h._y.call(null,k.data),c===_&&f===E)return C.next=k,v?v[y]=C:h._root=C,h;do v=v?v[y]=new Array(4):h._root=new Array(4),(x=c>=(g=(R+M)/2))?R=g:M=g,(m=f>=(p=(P+N)/2))?P=p:N=p;while((y=m<<1|x)==(A=(E>=p)<<1|_>=g));return v[A]=k,v[y]=C,h}function r(h,c,f,d,v){this.node=h,this.x0=c,this.y0=f,this.x1=d,this.y1=v}function o(h){return h[0]}function a(h){return h[1]}function i(h,c,f){var d=new s(c??o,f??a,NaN,NaN,NaN,NaN);return h==null?d:d.addAll(h)}function s(h,c,f,d,v,g){this._x=h,this._y=c,this._x0=f,this._y0=d,this._x1=v,this._y1=g,this._root=void 0}function l(h){for(var c={data:h.data},f=c;h=h.next;)f=f.next={data:h.data};return c}var u=i.prototype=s.prototype;u.copy=function(){var h,c,f=new s(this._x,this._y,this._x0,this._y0,this._x1,this._y1),d=this._root;if(!d)return f;if(!d.length)return f._root=l(d),f;for(h=[{source:d,target:f._root=new Array(4)}];d=h.pop();)for(var v=0;v<4;++v)(c=d.source[v])&&(c.length?h.push({source:c,target:d.target[v]=new Array(4)}):d.target[v]=l(c));return f},u.add=function(h){const c=+this._x.call(null,h),f=+this._y.call(null,h);return t(this.cover(c,f),c,f,h)},u.addAll=function(h){var c,f,d,v,g=h.length,p=new Array(g),_=new Array(g),E=1/0,x=1/0,m=-1/0,y=-1/0;for(f=0;f<g;++f)isNaN(d=+this._x.call(null,c=h[f]))||isNaN(v=+this._y.call(null,c))||(p[f]=d,_[f]=v,d<E&&(E=d),d>m&&(m=d),v<x&&(x=v),v>y&&(y=v));if(E>m||x>y)return this;for(this.cover(E,x).cover(m,y),f=0;f<g;++f)t(this,p[f],_[f],h[f]);return this},u.cover=function(h,c){if(isNaN(h=+h)||isNaN(c=+c))return this;var f=this._x0,d=this._y0,v=this._x1,g=this._y1;if(isNaN(f))v=(f=Math.floor(h))+1,g=(d=Math.floor(c))+1;else{for(var p,_,E=v-f||1,x=this._root;f>h||h>=v||d>c||c>=g;)switch(_=(c<d)<<1|h<f,(p=new Array(4))[_]=x,x=p,E*=2,_){case 0:v=f+E,g=d+E;break;case 1:f=v-E,g=d+E;break;case 2:v=f+E,d=g-E;break;case 3:f=v-E,d=g-E}this._root&&this._root.length&&(this._root=x)}return this._x0=f,this._y0=d,this._x1=v,this._y1=g,this},u.data=function(){var h=[];return this.visit(function(c){if(!c.length)do h.push(c.data);while(c=c.next)}),h},u.extent=function(h){return arguments.length?this.cover(+h[0][0],+h[0][1]).cover(+h[1][0],+h[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},u.find=function(h,c,f){var d,v,g,p,_,E,x,m=this._x0,y=this._y0,A=this._x1,k=this._y1,C=[],R=this._root;for(R&&C.push(new r(R,m,y,A,k)),f==null?f=1/0:(m=h-f,y=c-f,A=h+f,k=c+f,f*=f);E=C.pop();)if(!(!(R=E.node)||(v=E.x0)>A||(g=E.y0)>k||(p=E.x1)<m||(_=E.y1)<y))if(R.length){var P=(v+p)/2,M=(g+_)/2;C.push(new r(R[3],P,M,p,_),new r(R[2],v,M,P,_),new r(R[1],P,g,p,M),new r(R[0],v,g,P,M)),(x=(c>=M)<<1|h>=P)&&(E=C[C.length-1],C[C.length-1]=C[C.length-1-x],C[C.length-1-x]=E)}else{var N=h-+this._x.call(null,R.data),z=c-+this._y.call(null,R.data),b=N*N+z*z;if(b<f){var B=Math.sqrt(f=b);m=h-B,y=c-B,A=h+B,k=c+B,d=R.data}}return d},u.remove=function(h){if(isNaN(g=+this._x.call(null,h))||isNaN(p=+this._y.call(null,h)))return this;var c,f,d,v,g,p,_,E,x,m,y,A,k=this._root,C=this._x0,R=this._y0,P=this._x1,M=this._y1;if(!k)return this;if(k.length)for(;;){if((x=g>=(_=(C+P)/2))?C=_:P=_,(m=p>=(E=(R+M)/2))?R=E:M=E,c=k,!(k=k[y=m<<1|x]))return this;if(!k.length)break;(c[y+1&3]||c[y+2&3]||c[y+3&3])&&(f=c,A=y)}for(;k.data!==h;)if(d=k,!(k=k.next))return this;return(v=k.next)&&delete k.next,d?(v?d.next=v:delete d.next,this):c?(v?c[y]=v:delete c[y],(k=c[0]||c[1]||c[2]||c[3])&&k===(c[3]||c[2]||c[1]||c[0])&&!k.length&&(f?f[A]=k:this._root=k),this):(this._root=v,this)},u.removeAll=function(h){for(var c=0,f=h.length;c<f;++c)this.remove(h[c]);return this},u.root=function(){return this._root},u.size=function(){var h=0;return this.visit(function(c){if(!c.length)do++h;while(c=c.next)}),h},u.visit=function(h){var c,f,d,v,g,p,_=[],E=this._root;for(E&&_.push(new r(E,this._x0,this._y0,this._x1,this._y1));c=_.pop();)if(!h(E=c.node,d=c.x0,v=c.y0,g=c.x1,p=c.y1)&&E.length){var x=(d+g)/2,m=(v+p)/2;(f=E[3])&&_.push(new r(f,x,m,g,p)),(f=E[2])&&_.push(new r(f,d,m,x,p)),(f=E[1])&&_.push(new r(f,x,v,g,m)),(f=E[0])&&_.push(new r(f,d,v,x,m))}return this},u.visitAfter=function(h){var c,f=[],d=[];for(this._root&&f.push(new r(this._root,this._x0,this._y0,this._x1,this._y1));c=f.pop();){var v=c.node;if(v.length){var g,p=c.x0,_=c.y0,E=c.x1,x=c.y1,m=(p+E)/2,y=(_+x)/2;(g=v[0])&&f.push(new r(g,p,_,m,y)),(g=v[1])&&f.push(new r(g,m,_,E,y)),(g=v[2])&&f.push(new r(g,p,y,m,x)),(g=v[3])&&f.push(new r(g,m,y,E,x))}d.push(c)}for(;c=d.pop();)h(c.node,c.x0,c.y0,c.x1,c.y1);return this},u.x=function(h){return arguments.length?(this._x=h,this):this._x},u.y=function(h){return arguments.length?(this._y=h,this):this._y},e.quadtree=i,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){var t,r,o=0,a=0,i=0,s=0,l=0,u=0,h=typeof performance=="object"&&performance.now?performance:Date,c=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(m){setTimeout(m,17)};function f(){return l||(c(d),l=h.now()+u)}function d(){l=0}function v(){this._call=this._time=this._next=null}function g(m,y,A){var k=new v;return k.restart(m,y,A),k}function p(){f(),++o;for(var m,y=t;y;)(m=l-y._time)>=0&&y._call.call(void 0,m),y=y._next;--o}function _(){l=(s=h.now())+u,o=a=0;try{p()}finally{o=0,function(){for(var m,y,A=t,k=1/0;A;)A._call?(k>A._time&&(k=A._time),m=A,A=A._next):(y=A._next,A._next=null,A=m?m._next=y:t=y);r=m,x(k)}(),l=0}}function E(){var m=h.now(),y=m-s;y>1e3&&(u-=y,s=m)}function x(m){o||(a&&(a=clearTimeout(a)),m-l>24?(m<1/0&&(a=setTimeout(_,m-h.now()-u)),i&&(i=clearInterval(i))):(i||(s=h.now(),i=setInterval(E,1e3)),o=1,c(_)))}v.prototype=g.prototype={constructor:v,restart:function(m,y,A){if(typeof m!="function")throw new TypeError("callback is not a function");A=(A==null?f():+A)+(y==null?0:+y),this._next||r===this||(r?r._next=this:t=this,r=this),this._call=m,this._time=A,x()},stop:function(){this._call&&(this._call=null,this._time=1/0,x())}},e.interval=function(m,y,A){var k=new v,C=y;return y==null?(k.restart(m,y,A),k):(k._restart=k.restart,k.restart=function(R,P,M){P=+P,M=M==null?f():+M,k._restart(function N(z){z+=C,k._restart(N,C+=P,M),R(z)},P,M)},k.restart(m,y,A),k)},e.now=f,e.timeout=function(m,y,A){var k=new v;return y=y==null?0:+y,k.restart(C=>{k.stop(),m(C+y)},y,A),k},e.timer=g,e.timerFlush=p,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H,n(),n(),n()):typeof define=="function"&&define.amd?define(["exports","d3-quadtree","d3-dispatch","d3-timer"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{},e.d3,e.d3,e.d3)}(this,function(e,t,r,o){function a(g){return function(){return g}}function i(g){return 1e-6*(g()-.5)}function s(g){return g.x+g.vx}function l(g){return g.y+g.vy}function u(g){return g.index}function h(g,p){var _=g.get(p);if(!_)throw new Error("node not found: "+p);return _}const c=4294967296;function f(g){return g.x}function d(g){return g.y}var v=Math.PI*(3-Math.sqrt(5));e.forceCenter=function(g,p){var _,E=1;function x(){var m,y,A=_.length,k=0,C=0;for(m=0;m<A;++m)k+=(y=_[m]).x,C+=y.y;for(k=(k/A-g)*E,C=(C/A-p)*E,m=0;m<A;++m)(y=_[m]).x-=k,y.y-=C}return g==null&&(g=0),p==null&&(p=0),x.initialize=function(m){_=m},x.x=function(m){return arguments.length?(g=+m,x):g},x.y=function(m){return arguments.length?(p=+m,x):p},x.strength=function(m){return arguments.length?(E=+m,x):E},x},e.forceCollide=function(g){var p,_,E,x=1,m=1;function y(){for(var C,R,P,M,N,z,b,B=p.length,w=0;w<m;++w)for(R=t.quadtree(p,s,l).visitAfter(A),C=0;C<B;++C)P=p[C],z=_[P.index],b=z*z,M=P.x+P.vx,N=P.y+P.vy,R.visit(S);function S(I,T,F,O,D){var U=I.data,L=I.r,Q=z+L;if(!U)return T>M+Q||O<M-Q||F>N+Q||D<N-Q;if(U.index>P.index){var G=M-U.x-U.vx,j=N-U.y-U.vy,V=G*G+j*j;V<Q*Q&&(G===0&&(V+=(G=i(E))*G),j===0&&(V+=(j=i(E))*j),V=(Q-(V=Math.sqrt(V)))/V*x,P.vx+=(G*=V)*(Q=(L*=L)/(b+L)),P.vy+=(j*=V)*Q,U.vx-=G*(Q=1-Q),U.vy-=j*Q)}}}function A(C){if(C.data)return C.r=_[C.data.index];for(var R=C.r=0;R<4;++R)C[R]&&C[R].r>C.r&&(C.r=C[R].r)}function k(){if(p){var C,R,P=p.length;for(_=new Array(P),C=0;C<P;++C)R=p[C],_[R.index]=+g(R,C,p)}}return typeof g!="function"&&(g=a(g==null?1:+g)),y.initialize=function(C,R){p=C,E=R,k()},y.iterations=function(C){return arguments.length?(m=+C,y):m},y.strength=function(C){return arguments.length?(x=+C,y):x},y.radius=function(C){return arguments.length?(g=typeof C=="function"?C:a(+C),k(),y):g},y},e.forceLink=function(g){var p,_,E,x,m,y,A=u,k=function(b){return 1/Math.min(x[b.source.index],x[b.target.index])},C=a(30),R=1;function P(b){for(var B=0,w=g.length;B<R;++B)for(var S,I,T,F,O,D,U,L=0;L<w;++L)I=(S=g[L]).source,F=(T=S.target).x+T.vx-I.x-I.vx||i(y),O=T.y+T.vy-I.y-I.vy||i(y),F*=D=((D=Math.sqrt(F*F+O*O))-_[L])/D*b*p[L],O*=D,T.vx-=F*(U=m[L]),T.vy-=O*U,I.vx+=F*(U=1-U),I.vy+=O*U}function M(){if(E){var b,B,w=E.length,S=g.length,I=new Map(E.map((T,F)=>[A(T,F,E),T]));for(b=0,x=new Array(w);b<S;++b)(B=g[b]).index=b,typeof B.source!="object"&&(B.source=h(I,B.source)),typeof B.target!="object"&&(B.target=h(I,B.target)),x[B.source.index]=(x[B.source.index]||0)+1,x[B.target.index]=(x[B.target.index]||0)+1;for(b=0,m=new Array(S);b<S;++b)B=g[b],m[b]=x[B.source.index]/(x[B.source.index]+x[B.target.index]);p=new Array(S),N(),_=new Array(S),z()}}function N(){if(E)for(var b=0,B=g.length;b<B;++b)p[b]=+k(g[b],b,g)}function z(){if(E)for(var b=0,B=g.length;b<B;++b)_[b]=+C(g[b],b,g)}return g==null&&(g=[]),P.initialize=function(b,B){E=b,y=B,M()},P.links=function(b){return arguments.length?(g=b,M(),P):g},P.id=function(b){return arguments.length?(A=b,P):A},P.iterations=function(b){return arguments.length?(R=+b,P):R},P.strength=function(b){return arguments.length?(k=typeof b=="function"?b:a(+b),N(),P):k},P.distance=function(b){return arguments.length?(C=typeof b=="function"?b:a(+b),z(),P):C},P},e.forceManyBody=function(){var g,p,_,E,x,m=a(-30),y=1,A=1/0,k=.81;function C(N){var z,b=g.length,B=t.quadtree(g,f,d).visitAfter(P);for(E=N,z=0;z<b;++z)p=g[z],B.visit(M)}function R(){if(g){var N,z,b=g.length;for(x=new Array(b),N=0;N<b;++N)z=g[N],x[z.index]=+m(z,N,g)}}function P(N){var z,b,B,w,S,I=0,T=0;if(N.length){for(B=w=S=0;S<4;++S)(z=N[S])&&(b=Math.abs(z.value))&&(I+=z.value,T+=b,B+=b*z.x,w+=b*z.y);N.x=B/T,N.y=w/T}else{(z=N).x=z.data.x,z.y=z.data.y;do I+=x[z.data.index];while(z=z.next)}N.value=I}function M(N,z,b,B){if(!N.value)return!0;var w=N.x-p.x,S=N.y-p.y,I=B-z,T=w*w+S*S;if(I*I/k<T)return T<A&&(w===0&&(T+=(w=i(_))*w),S===0&&(T+=(S=i(_))*S),T<y&&(T=Math.sqrt(y*T)),p.vx+=w*N.value*E/T,p.vy+=S*N.value*E/T),!0;if(!(N.length||T>=A)){(N.data!==p||N.next)&&(w===0&&(T+=(w=i(_))*w),S===0&&(T+=(S=i(_))*S),T<y&&(T=Math.sqrt(y*T)));do N.data!==p&&(I=x[N.data.index]*E/T,p.vx+=w*I,p.vy+=S*I);while(N=N.next)}}return C.initialize=function(N,z){g=N,_=z,R()},C.strength=function(N){return arguments.length?(m=typeof N=="function"?N:a(+N),R(),C):m},C.distanceMin=function(N){return arguments.length?(y=N*N,C):Math.sqrt(y)},C.distanceMax=function(N){return arguments.length?(A=N*N,C):Math.sqrt(A)},C.theta=function(N){return arguments.length?(k=N*N,C):Math.sqrt(k)},C},e.forceRadial=function(g,p,_){var E,x,m,y=a(.1);function A(C){for(var R=0,P=E.length;R<P;++R){var M=E[R],N=M.x-p||1e-6,z=M.y-_||1e-6,b=Math.sqrt(N*N+z*z),B=(m[R]-b)*x[R]*C/b;M.vx+=N*B,M.vy+=z*B}}function k(){if(E){var C,R=E.length;for(x=new Array(R),m=new Array(R),C=0;C<R;++C)m[C]=+g(E[C],C,E),x[C]=isNaN(m[C])?0:+y(E[C],C,E)}}return typeof g!="function"&&(g=a(+g)),p==null&&(p=0),_==null&&(_=0),A.initialize=function(C){E=C,k()},A.strength=function(C){return arguments.length?(y=typeof C=="function"?C:a(+C),k(),A):y},A.radius=function(C){return arguments.length?(g=typeof C=="function"?C:a(+C),k(),A):g},A.x=function(C){return arguments.length?(p=+C,A):p},A.y=function(C){return arguments.length?(_=+C,A):_},A},e.forceSimulation=function(g){var p,_=1,E=.001,x=1-Math.pow(E,1/300),m=0,y=.6,A=new Map,k=o.timer(P),C=r.dispatch("tick","end"),R=function(){let b=1;return()=>(b=(1664525*b+1013904223)%c)/c}();function P(){M(),C.call("tick",p),_<E&&(k.stop(),C.call("end",p))}function M(b){var B,w,S=g.length;b===void 0&&(b=1);for(var I=0;I<b;++I)for(_+=(m-_)*x,A.forEach(function(T){T(_)}),B=0;B<S;++B)(w=g[B]).fx==null?w.x+=w.vx*=y:(w.x=w.fx,w.vx=0),w.fy==null?w.y+=w.vy*=y:(w.y=w.fy,w.vy=0);return p}function N(){for(var b,B=0,w=g.length;B<w;++B){if((b=g[B]).index=B,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var S=10*Math.sqrt(.5+B),I=B*v;b.x=S*Math.cos(I),b.y=S*Math.sin(I)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function z(b){return b.initialize&&b.initialize(g,R),b}return g==null&&(g=[]),N(),p={tick:M,restart:function(){return k.restart(P),p},stop:function(){return k.stop(),p},nodes:function(b){return arguments.length?(g=b,N(),A.forEach(z),p):g},alpha:function(b){return arguments.length?(_=+b,p):_},alphaMin:function(b){return arguments.length?(E=+b,p):E},alphaDecay:function(b){return arguments.length?(x=+b,p):+x},alphaTarget:function(b){return arguments.length?(m=+b,p):m},velocityDecay:function(b){return arguments.length?(y=1-b,p):1-y},randomSource:function(b){return arguments.length?(R=b,A.forEach(z),p):R},force:function(b,B){return arguments.length>1?(B==null?A.delete(b):A.set(b,z(B)),p):A.get(b)},find:function(b,B,w){var S,I,T,F,O,D=0,U=g.length;for(w==null?w=1/0:w*=w,D=0;D<U;++D)(T=(S=b-(F=g[D]).x)*S+(I=B-F.y)*I)<w&&(O=F,w=T);return O},on:function(b,B){return arguments.length>1?(C.on(b,B),p):C.on(b)}}},e.forceX=function(g){var p,_,E,x=a(.1);function m(A){for(var k,C=0,R=p.length;C<R;++C)(k=p[C]).vx+=(E[C]-k.x)*_[C]*A}function y(){if(p){var A,k=p.length;for(_=new Array(k),E=new Array(k),A=0;A<k;++A)_[A]=isNaN(E[A]=+g(p[A],A,p))?0:+x(p[A],A,p)}}return typeof g!="function"&&(g=a(g==null?0:+g)),m.initialize=function(A){p=A,y()},m.strength=function(A){return arguments.length?(x=typeof A=="function"?A:a(+A),y(),m):x},m.x=function(A){return arguments.length?(g=typeof A=="function"?A:a(+A),y(),m):g},m},e.forceY=function(g){var p,_,E,x=a(.1);function m(A){for(var k,C=0,R=p.length;C<R;++C)(k=p[C]).vy+=(E[C]-k.y)*_[C]*A}function y(){if(p){var A,k=p.length;for(_=new Array(k),E=new Array(k),A=0;A<k;++A)_[A]=isNaN(E[A]=+g(p[A],A,p))?0:+x(p[A],A,p)}}return typeof g!="function"&&(g=a(g==null?0:+g)),m.initialize=function(A){p=A,y()},m.strength=function(A){return arguments.length?(x=typeof A=="function"?A:a(+A),y(),m):x},m.y=function(A){return arguments.length?(g=typeof A=="function"?A:a(+A),y(),m):g},m},Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function t(u,h,c){if(isNaN(h))return u;var f,d,v,g,p,_,E=u._root,x={data:c},m=u._x0,y=u._x1;if(!E)return u._root=x,u;for(;E.length;)if((g=h>=(d=(m+y)/2))?m=d:y=d,f=E,!(E=E[p=+g]))return f[p]=x,u;if(h===(v=+u._x.call(null,E.data)))return x.next=E,f?f[p]=x:u._root=x,u;do f=f?f[p]=new Array(2):u._root=new Array(2),(g=h>=(d=(m+y)/2))?m=d:y=d;while((p=+g)==(_=+(v>=d)));return f[_]=E,f[p]=x,u}function r(u,h,c){this.node=u,this.x0=h,this.x1=c}function o(u){return u[0]}function a(u,h){var c=new i(h??o,NaN,NaN);return u==null?c:c.addAll(u)}function i(u,h,c){this._x=u,this._x0=h,this._x1=c,this._root=void 0}function s(u){for(var h={data:u.data},c=h;u=u.next;)c=c.next={data:u.data};return h}var l=a.prototype=i.prototype;l.copy=function(){var u,h,c=new i(this._x,this._x0,this._x1),f=this._root;if(!f)return c;if(!f.length)return c._root=s(f),c;for(u=[{source:f,target:c._root=new Array(2)}];f=u.pop();)for(var d=0;d<2;++d)(h=f.source[d])&&(h.length?u.push({source:h,target:f.target[d]=new Array(2)}):f.target[d]=s(h));return c},l.add=function(u){var h=+this._x.call(null,u);return t(this.cover(h),h,u)},l.addAll=function(u){var h,c,f=u.length,d=new Array(f),v=1/0,g=-1/0;for(h=0;h<f;++h)isNaN(c=+this._x.call(null,u[h]))||(d[h]=c,c<v&&(v=c),c>g&&(g=c));if(v>g)return this;for(this.cover(v).cover(g),h=0;h<f;++h)t(this,d[h],u[h]);return this},l.cover=function(u){if(isNaN(u=+u))return this;var h=this._x0,c=this._x1;if(isNaN(h))c=(h=Math.floor(u))+1;else{for(var f,d,v=c-h||1,g=this._root;h>u||u>=c;)switch(d=+(u<h),(f=new Array(2))[d]=g,g=f,v*=2,d){case 0:c=h+v;break;case 1:h=c-v}this._root&&this._root.length&&(this._root=g)}return this._x0=h,this._x1=c,this},l.data=function(){var u=[];return this.visit(function(h){if(!h.length)do u.push(h.data);while(h=h.next)}),u},l.extent=function(u){return arguments.length?this.cover(+u[0][0]).cover(+u[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]},l.find=function(u,h){var c,f,d,v,g,p=this._x0,_=this._x1,E=[],x=this._root;for(x&&E.push(new r(x,p,_)),h==null?h=1/0:(p=u-h,_=u+h);v=E.pop();)if(!(!(x=v.node)||(f=v.x0)>_||(d=v.x1)<p))if(x.length){var m=(f+d)/2;E.push(new r(x[1],m,d),new r(x[0],f,m)),(g=+(u>=m))&&(v=E[E.length-1],E[E.length-1]=E[E.length-1-g],E[E.length-1-g]=v)}else{var y=Math.abs(u-+this._x.call(null,x.data));y<h&&(h=y,p=u-y,_=u+y,c=x.data)}return c},l.remove=function(u){if(isNaN(v=+this._x.call(null,u)))return this;var h,c,f,d,v,g,p,_,E,x=this._root,m=this._x0,y=this._x1;if(!x)return this;if(x.length)for(;;){if((p=v>=(g=(m+y)/2))?m=g:y=g,h=x,!(x=x[_=+p]))return this;if(!x.length)break;h[_+1&1]&&(c=h,E=_)}for(;x.data!==u;)if(f=x,!(x=x.next))return this;return(d=x.next)&&delete x.next,f?(d?f.next=d:delete f.next,this):h?(d?h[_]=d:delete h[_],(x=h[0]||h[1])&&x===(h[1]||h[0])&&!x.length&&(c?c[E]=x:this._root=x),this):(this._root=d,this)},l.removeAll=function(u){for(var h=0,c=u.length;h<c;++h)this.remove(u[h]);return this},l.root=function(){return this._root},l.size=function(){var u=0;return this.visit(function(h){if(!h.length)do++u;while(h=h.next)}),u},l.visit=function(u){var h,c,f,d,v=[],g=this._root;for(g&&v.push(new r(g,this._x0,this._x1));h=v.pop();)if(!u(g=h.node,f=h.x0,d=h.x1)&&g.length){var p=(f+d)/2;(c=g[1])&&v.push(new r(c,p,d)),(c=g[0])&&v.push(new r(c,f,p))}return this},l.visitAfter=function(u){var h,c=[],f=[];for(this._root&&c.push(new r(this._root,this._x0,this._x1));h=c.pop();){var d=h.node;if(d.length){var v,g=h.x0,p=h.x1,_=(g+p)/2;(v=d[0])&&c.push(new r(v,g,_)),(v=d[1])&&c.push(new r(v,_,p))}f.push(h)}for(;h=f.pop();)u(h.node,h.x0,h.x1);return this},l.x=function(u){return arguments.length?(this._x=u,this):this._x},e.binarytree=a,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{})}(this,function(e){function t(c,f,d,v,g){if(isNaN(f)||isNaN(d)||isNaN(v))return c;var p,_,E,x,m,y,A,k,C,R,P,M,N=c._root,z={data:g},b=c._x0,B=c._y0,w=c._z0,S=c._x1,I=c._y1,T=c._z1;if(!N)return c._root=z,c;for(;N.length;)if((k=f>=(_=(b+S)/2))?b=_:S=_,(C=d>=(E=(B+I)/2))?B=E:I=E,(R=v>=(x=(w+T)/2))?w=x:T=x,p=N,!(N=N[P=R<<2|C<<1|k]))return p[P]=z,c;if(m=+c._x.call(null,N.data),y=+c._y.call(null,N.data),A=+c._z.call(null,N.data),f===m&&d===y&&v===A)return z.next=N,p?p[P]=z:c._root=z,c;do p=p?p[P]=new Array(8):c._root=new Array(8),(k=f>=(_=(b+S)/2))?b=_:S=_,(C=d>=(E=(B+I)/2))?B=E:I=E,(R=v>=(x=(w+T)/2))?w=x:T=x;while((P=R<<2|C<<1|k)==(M=(A>=x)<<2|(y>=E)<<1|m>=_));return p[M]=N,p[P]=z,c}function r(c,f,d,v,g,p,_){this.node=c,this.x0=f,this.y0=d,this.z0=v,this.x1=g,this.y1=p,this.z1=_}function o(c){return c[0]}function a(c){return c[1]}function i(c){return c[2]}function s(c,f,d,v){var g=new l(f??o,d??a,v??i,NaN,NaN,NaN,NaN,NaN,NaN);return c==null?g:g.addAll(c)}function l(c,f,d,v,g,p,_,E,x){this._x=c,this._y=f,this._z=d,this._x0=v,this._y0=g,this._z0=p,this._x1=_,this._y1=E,this._z1=x,this._root=void 0}function u(c){for(var f={data:c.data},d=f;c=c.next;)d=d.next={data:c.data};return f}var h=s.prototype=l.prototype;h.copy=function(){var c,f,d=new l(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),v=this._root;if(!v)return d;if(!v.length)return d._root=u(v),d;for(c=[{source:v,target:d._root=new Array(8)}];v=c.pop();)for(var g=0;g<8;++g)(f=v.source[g])&&(f.length?c.push({source:f,target:v.target[g]=new Array(8)}):v.target[g]=u(f));return d},h.add=function(c){var f=+this._x.call(null,c),d=+this._y.call(null,c),v=+this._z.call(null,c);return t(this.cover(f,d,v),f,d,v,c)},h.addAll=function(c){var f,d,v,g,p,_=c.length,E=new Array(_),x=new Array(_),m=new Array(_),y=1/0,A=1/0,k=1/0,C=-1/0,R=-1/0,P=-1/0;for(d=0;d<_;++d)isNaN(v=+this._x.call(null,f=c[d]))||isNaN(g=+this._y.call(null,f))||isNaN(p=+this._z.call(null,f))||(E[d]=v,x[d]=g,m[d]=p,v<y&&(y=v),v>C&&(C=v),g<A&&(A=g),g>R&&(R=g),p<k&&(k=p),p>P&&(P=p));if(y>C||A>R||k>P)return this;for(this.cover(y,A,k).cover(C,R,P),d=0;d<_;++d)t(this,E[d],x[d],m[d],c[d]);return this},h.cover=function(c,f,d){if(isNaN(c=+c)||isNaN(f=+f)||isNaN(d=+d))return this;var v=this._x0,g=this._y0,p=this._z0,_=this._x1,E=this._y1,x=this._z1;if(isNaN(v))_=(v=Math.floor(c))+1,E=(g=Math.floor(f))+1,x=(p=Math.floor(d))+1;else{for(var m,y,A=_-v||1,k=this._root;v>c||c>=_||g>f||f>=E||p>d||d>=x;)switch(y=(d<p)<<2|(f<g)<<1|c<v,(m=new Array(8))[y]=k,k=m,A*=2,y){case 0:_=v+A,E=g+A,x=p+A;break;case 1:v=_-A,E=g+A,x=p+A;break;case 2:_=v+A,g=E-A,x=p+A;break;case 3:v=_-A,g=E-A,x=p+A;break;case 4:_=v+A,E=g+A,p=x-A;break;case 5:v=_-A,E=g+A,p=x-A;break;case 6:_=v+A,g=E-A,p=x-A;break;case 7:v=_-A,g=E-A,p=x-A}this._root&&this._root.length&&(this._root=k)}return this._x0=v,this._y0=g,this._z0=p,this._x1=_,this._y1=E,this._z1=x,this},h.data=function(){var c=[];return this.visit(function(f){if(!f.length)do c.push(f.data);while(f=f.next)}),c},h.extent=function(c){return arguments.length?this.cover(+c[0][0],+c[0][1],+c[0][2]).cover(+c[1][0],+c[1][1],+c[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]},h.find=function(c,f,d,v){var g,p,_,E,x,m,y,A,k,C=this._x0,R=this._y0,P=this._z0,M=this._x1,N=this._y1,z=this._z1,b=[],B=this._root;for(B&&b.push(new r(B,C,R,P,M,N,z)),v==null?v=1/0:(C=c-v,R=f-v,P=d-v,M=c+v,N=f+v,z=d+v,v*=v);A=b.pop();)if(!(!(B=A.node)||(p=A.x0)>M||(_=A.y0)>N||(E=A.z0)>z||(x=A.x1)<C||(m=A.y1)<R||(y=A.z1)<P))if(B.length){var w=(p+x)/2,S=(_+m)/2,I=(E+y)/2;b.push(new r(B[7],w,S,I,x,m,y),new r(B[6],p,S,I,w,m,y),new r(B[5],w,_,I,x,S,y),new r(B[4],p,_,I,w,S,y),new r(B[3],w,S,E,x,m,I),new r(B[2],p,S,E,w,m,I),new r(B[1],w,_,E,x,S,I),new r(B[0],p,_,E,w,S,I)),(k=(d>=I)<<2|(f>=S)<<1|c>=w)&&(A=b[b.length-1],b[b.length-1]=b[b.length-1-k],b[b.length-1-k]=A)}else{var T=c-+this._x.call(null,B.data),F=f-+this._y.call(null,B.data),O=d-+this._z.call(null,B.data),D=T*T+F*F+O*O;if(D<v){var U=Math.sqrt(v=D);C=c-U,R=f-U,P=d-U,M=c+U,N=f+U,z=d+U,g=B.data}}return g},h.remove=function(c){if(isNaN(p=+this._x.call(null,c))||isNaN(_=+this._y.call(null,c))||isNaN(E=+this._z.call(null,c)))return this;var f,d,v,g,p,_,E,x,m,y,A,k,C,R,P,M=this._root,N=this._x0,z=this._y0,b=this._z0,B=this._x1,w=this._y1,S=this._z1;if(!M)return this;if(M.length)for(;;){if((A=p>=(x=(N+B)/2))?N=x:B=x,(k=_>=(m=(z+w)/2))?z=m:w=m,(C=E>=(y=(b+S)/2))?b=y:S=y,f=M,!(M=M[R=C<<2|k<<1|A]))return this;if(!M.length)break;(f[R+1&7]||f[R+2&7]||f[R+3&7]||f[R+4&7]||f[R+5&7]||f[R+6&7]||f[R+7&7])&&(d=f,P=R)}for(;M.data!==c;)if(v=M,!(M=M.next))return this;return(g=M.next)&&delete M.next,v?(g?v.next=g:delete v.next,this):f?(g?f[R]=g:delete f[R],(M=f[0]||f[1]||f[2]||f[3]||f[4]||f[5]||f[6]||f[7])&&M===(f[7]||f[6]||f[5]||f[4]||f[3]||f[2]||f[1]||f[0])&&!M.length&&(d?d[P]=M:this._root=M),this):(this._root=g,this)},h.removeAll=function(c){for(var f=0,d=c.length;f<d;++f)this.remove(c[f]);return this},h.root=function(){return this._root},h.size=function(){var c=0;return this.visit(function(f){if(!f.length)do++c;while(f=f.next)}),c},h.visit=function(c){var f,d,v,g,p,_,E,x,m=[],y=this._root;for(y&&m.push(new r(y,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));f=m.pop();)if(!c(y=f.node,v=f.x0,g=f.y0,p=f.z0,_=f.x1,E=f.y1,x=f.z1)&&y.length){var A=(v+_)/2,k=(g+E)/2,C=(p+x)/2;(d=y[7])&&m.push(new r(d,A,k,C,_,E,x)),(d=y[6])&&m.push(new r(d,v,k,C,A,E,x)),(d=y[5])&&m.push(new r(d,A,g,C,_,k,x)),(d=y[4])&&m.push(new r(d,v,g,C,A,k,x)),(d=y[3])&&m.push(new r(d,A,k,p,_,E,C)),(d=y[2])&&m.push(new r(d,v,k,p,A,E,C)),(d=y[1])&&m.push(new r(d,A,g,p,_,k,C)),(d=y[0])&&m.push(new r(d,v,g,p,A,k,C))}return this},h.visitAfter=function(c){var f,d=[],v=[];for(this._root&&d.push(new r(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));f=d.pop();){var g=f.node;if(g.length){var p,_=f.x0,E=f.y0,x=f.z0,m=f.x1,y=f.y1,A=f.z1,k=(_+m)/2,C=(E+y)/2,R=(x+A)/2;(p=g[0])&&d.push(new r(p,_,E,x,k,C,R)),(p=g[1])&&d.push(new r(p,k,E,x,m,C,R)),(p=g[2])&&d.push(new r(p,_,C,x,k,y,R)),(p=g[3])&&d.push(new r(p,k,C,x,m,y,R)),(p=g[4])&&d.push(new r(p,_,E,R,k,C,A)),(p=g[5])&&d.push(new r(p,k,E,R,m,C,A)),(p=g[6])&&d.push(new r(p,_,C,R,k,y,A)),(p=g[7])&&d.push(new r(p,k,C,R,m,y,A))}v.push(f)}for(;f=v.pop();)c(f.node,f.x0,f.y0,f.z0,f.x1,f.y1,f.z1);return this},h.x=function(c){return arguments.length?(this._x=c,this):this._x},h.y=function(c){return arguments.length?(this._y=c,this):this._y},h.z=function(c){return arguments.length?(this._z=c,this):this._z},e.octree=s,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){typeof H=="object"&&typeof de<"u"?t(H,n(),n(),n(),n(),n()):typeof define=="function"&&define.amd?define(["exports","d3-binarytree","d3-quadtree","d3-octree","d3-dispatch","d3-timer"],t):t((e=typeof globalThis<"u"?globalThis:e||self).d3=e.d3||{},e.d3,e.d3,e.d3,e.d3,e.d3)}(this,function(e,t,r,o,a,i){function s(m){return function(){return m}}function l(m){return 1e-6*(m()-.5)}function u(m){return m.x+m.vx}function h(m){return m.y+m.vy}function c(m){return m.z+m.vz}function f(m){return m.index}function d(m,y){var A=m.get(y);if(!A)throw new Error("node not found: "+y);return A}const v=4294967296;function g(m){return m.x}function p(m){return m.y}function _(m){return m.z}var E=Math.PI*(3-Math.sqrt(5)),x=20*Math.PI/(9+Math.sqrt(221));e.forceCenter=function(m,y,A){var k,C=1;function R(){var P,M,N=k.length,z=0,b=0,B=0;for(P=0;P<N;++P)z+=(M=k[P]).x||0,b+=M.y||0,B+=M.z||0;for(z=(z/N-m)*C,b=(b/N-y)*C,B=(B/N-A)*C,P=0;P<N;++P)M=k[P],z&&(M.x-=z),b&&(M.y-=b),B&&(M.z-=B)}return m==null&&(m=0),y==null&&(y=0),A==null&&(A=0),R.initialize=function(P){k=P},R.x=function(P){return arguments.length?(m=+P,R):m},R.y=function(P){return arguments.length?(y=+P,R):y},R.z=function(P){return arguments.length?(A=+P,R):A},R.strength=function(P){return arguments.length?(C=+P,R):C},R},e.forceCollide=function(m){var y,A,k,C,R=1,P=1;function M(){for(var b,B,w,S,I,T,F,O,D=y.length,U=0;U<P;++U)for(B=(A===1?t.binarytree(y,u):A===2?r.quadtree(y,u,h):A===3?o.octree(y,u,h,c):null).visitAfter(N),b=0;b<D;++b)w=y[b],F=k[w.index],O=F*F,S=w.x+w.vx,A>1&&(I=w.y+w.vy),A>2&&(T=w.z+w.vz),B.visit(L);function L(Q,G,j,V,q,ie,X){var J=[G,j,V,q,ie,X],Tt=J[0],Er=J[1],kr=J[2],Cr=J[A],Ir=J[A+1],Br=J[A+2],ee=Q.data,Ze=Q.r,W=F+Ze;if(!ee)return Tt>S+W||Cr<S-W||A>1&&(Er>I+W||Ir<I-W)||A>2&&(kr>T+W||Br<T-W);if(ee.index>w.index){var pe=S-ee.x-ee.vx,Ae=A>1?I-ee.y-ee.vy:0,ye=A>2?T-ee.z-ee.vz:0,te=pe*pe+Ae*Ae+ye*ye;te<W*W&&(pe===0&&(te+=(pe=l(C))*pe),A>1&&Ae===0&&(te+=(Ae=l(C))*Ae),A>2&&ye===0&&(te+=(ye=l(C))*ye),te=(W-(te=Math.sqrt(te)))/te*R,w.vx+=(pe*=te)*(W=(Ze*=Ze)/(O+Ze)),A>1&&(w.vy+=(Ae*=te)*W),A>2&&(w.vz+=(ye*=te)*W),ee.vx-=pe*(W=1-W),A>1&&(ee.vy-=Ae*W),A>2&&(ee.vz-=ye*W))}}}function N(b){if(b.data)return b.r=k[b.data.index];for(var B=b.r=0;B<Math.pow(2,A);++B)b[B]&&b[B].r>b.r&&(b.r=b[B].r)}function z(){if(y){var b,B,w=y.length;for(k=new Array(w),b=0;b<w;++b)B=y[b],k[B.index]=+m(B,b,y)}}return typeof m!="function"&&(m=s(m==null?1:+m)),M.initialize=function(b,...B){y=b,C=B.find(w=>typeof w=="function")||Math.random,A=B.find(w=>[1,2,3].includes(w))||2,z()},M.iterations=function(b){return arguments.length?(P=+b,M):P},M.strength=function(b){return arguments.length?(R=+b,M):R},M.radius=function(b){return arguments.length?(m=typeof b=="function"?b:s(+b),z(),M):m},M},e.forceLink=function(m){var y,A,k,C,R,P,M,N=f,z=function(F){return 1/Math.min(R[F.source.index],R[F.target.index])},b=s(30),B=1;function w(F){for(var O=0,D=m.length;O<B;++O)for(var U,L,Q,G,j,V=0,q=0,ie=0,X=0;V<D;++V)L=(U=m[V]).source,q=(Q=U.target).x+Q.vx-L.x-L.vx||l(M),C>1&&(ie=Q.y+Q.vy-L.y-L.vy||l(M)),C>2&&(X=Q.z+Q.vz-L.z-L.vz||l(M)),q*=G=((G=Math.sqrt(q*q+ie*ie+X*X))-A[V])/G*F*y[V],ie*=G,X*=G,Q.vx-=q*(j=P[V]),C>1&&(Q.vy-=ie*j),C>2&&(Q.vz-=X*j),L.vx+=q*(j=1-j),C>1&&(L.vy+=ie*j),C>2&&(L.vz+=X*j)}function S(){if(k){var F,O,D=k.length,U=m.length,L=new Map(k.map((Q,G)=>[N(Q,G,k),Q]));for(F=0,R=new Array(D);F<U;++F)(O=m[F]).index=F,typeof O.source!="object"&&(O.source=d(L,O.source)),typeof O.target!="object"&&(O.target=d(L,O.target)),R[O.source.index]=(R[O.source.index]||0)+1,R[O.target.index]=(R[O.target.index]||0)+1;for(F=0,P=new Array(U);F<U;++F)O=m[F],P[F]=R[O.source.index]/(R[O.source.index]+R[O.target.index]);y=new Array(U),I(),A=new Array(U),T()}}function I(){if(k)for(var F=0,O=m.length;F<O;++F)y[F]=+z(m[F],F,m)}function T(){if(k)for(var F=0,O=m.length;F<O;++F)A[F]=+b(m[F],F,m)}return m==null&&(m=[]),w.initialize=function(F,...O){k=F,M=O.find(D=>typeof D=="function")||Math.random,C=O.find(D=>[1,2,3].includes(D))||2,S()},w.links=function(F){return arguments.length?(m=F,S(),w):m},w.id=function(F){return arguments.length?(N=F,w):N},w.iterations=function(F){return arguments.length?(B=+F,w):B},w.strength=function(F){return arguments.length?(z=typeof F=="function"?F:s(+F),I(),w):z},w.distance=function(F){return arguments.length?(b=typeof F=="function"?F:s(+F),T(),w):b},w},e.forceManyBody=function(){var m,y,A,k,C,R,P=s(-30),M=1,N=1/0,z=.81;function b(I){var T,F=m.length,O=(y===1?t.binarytree(m,g):y===2?r.quadtree(m,g,p):y===3?o.octree(m,g,p,_):null).visitAfter(w);for(C=I,T=0;T<F;++T)A=m[T],O.visit(S)}function B(){if(m){var I,T,F=m.length;for(R=new Array(F),I=0;I<F;++I)T=m[I],R[T.index]=+P(T,I,m)}}function w(I){var T,F,O,D,U,L,Q=0,G=0,j=I.length;if(j){for(O=D=U=L=0;L<j;++L)(T=I[L])&&(F=Math.abs(T.value))&&(Q+=T.value,G+=F,O+=F*(T.x||0),D+=F*(T.y||0),U+=F*(T.z||0));Q*=Math.sqrt(4/j),I.x=O/G,y>1&&(I.y=D/G),y>2&&(I.z=U/G)}else{(T=I).x=T.data.x,y>1&&(T.y=T.data.y),y>2&&(T.z=T.data.z);do Q+=R[T.data.index];while(T=T.next)}I.value=Q}function S(I,T,F,O,D){if(!I.value)return!0;var U=[F,O,D][y-1],L=I.x-A.x,Q=y>1?I.y-A.y:0,G=y>2?I.z-A.z:0,j=U-T,V=L*L+Q*Q+G*G;if(j*j/z<V)return V<N&&(L===0&&(V+=(L=l(k))*L),y>1&&Q===0&&(V+=(Q=l(k))*Q),y>2&&G===0&&(V+=(G=l(k))*G),V<M&&(V=Math.sqrt(M*V)),A.vx+=L*I.value*C/V,y>1&&(A.vy+=Q*I.value*C/V),y>2&&(A.vz+=G*I.value*C/V)),!0;if(!(I.length||V>=N)){(I.data!==A||I.next)&&(L===0&&(V+=(L=l(k))*L),y>1&&Q===0&&(V+=(Q=l(k))*Q),y>2&&G===0&&(V+=(G=l(k))*G),V<M&&(V=Math.sqrt(M*V)));do I.data!==A&&(j=R[I.data.index]*C/V,A.vx+=L*j,y>1&&(A.vy+=Q*j),y>2&&(A.vz+=G*j));while(I=I.next)}}return b.initialize=function(I,...T){m=I,k=T.find(F=>typeof F=="function")||Math.random,y=T.find(F=>[1,2,3].includes(F))||2,B()},b.strength=function(I){return arguments.length?(P=typeof I=="function"?I:s(+I),B(),b):P},b.distanceMin=function(I){return arguments.length?(M=I*I,b):Math.sqrt(M)},b.distanceMax=function(I){return arguments.length?(N=I*I,b):Math.sqrt(N)},b.theta=function(I){return arguments.length?(z=I*I,b):Math.sqrt(z)},b},e.forceRadial=function(m,y,A,k){var C,R,P,M,N=s(.1);function z(B){for(var w=0,S=C.length;w<S;++w){var I=C[w],T=I.x-y||1e-6,F=(I.y||0)-A||1e-6,O=(I.z||0)-k||1e-6,D=Math.sqrt(T*T+F*F+O*O),U=(M[w]-D)*P[w]*B/D;I.vx+=T*U,R>1&&(I.vy+=F*U),R>2&&(I.vz+=O*U)}}function b(){if(C){var B,w=C.length;for(P=new Array(w),M=new Array(w),B=0;B<w;++B)M[B]=+m(C[B],B,C),P[B]=isNaN(M[B])?0:+N(C[B],B,C)}}return typeof m!="function"&&(m=s(+m)),y==null&&(y=0),A==null&&(A=0),k==null&&(k=0),z.initialize=function(B,...w){C=B,R=w.find(S=>[1,2,3].includes(S))||2,b()},z.strength=function(B){return arguments.length?(N=typeof B=="function"?B:s(+B),b(),z):N},z.radius=function(B){return arguments.length?(m=typeof B=="function"?B:s(+B),b(),z):m},z.x=function(B){return arguments.length?(y=+B,z):y},z.y=function(B){return arguments.length?(A=+B,z):A},z.z=function(B){return arguments.length?(k=+B,z):k},z},e.forceSimulation=function(m,y){y=y||2;var A,k=Math.min(3,Math.max(1,Math.round(y))),C=1,R=.001,P=1-Math.pow(R,1/300),M=0,N=.6,z=new Map,b=i.timer(S),B=a.dispatch("tick","end"),w=function(){let O=1;return()=>(O=(1664525*O+1013904223)%v)/v}();function S(){I(),B.call("tick",A),C<R&&(b.stop(),B.call("end",A))}function I(O){var D,U,L=m.length;O===void 0&&(O=1);for(var Q=0;Q<O;++Q)for(C+=(M-C)*P,z.forEach(function(G){G(C)}),D=0;D<L;++D)(U=m[D]).fx==null?U.x+=U.vx*=N:(U.x=U.fx,U.vx=0),k>1&&(U.fy==null?U.y+=U.vy*=N:(U.y=U.fy,U.vy=0)),k>2&&(U.fz==null?U.z+=U.vz*=N:(U.z=U.fz,U.vz=0));return A}function T(){for(var O,D=0,U=m.length;D<U;++D){if((O=m[D]).index=D,O.fx!=null&&(O.x=O.fx),O.fy!=null&&(O.y=O.fy),O.fz!=null&&(O.z=O.fz),isNaN(O.x)||k>1&&isNaN(O.y)||k>2&&isNaN(O.z)){var L=10*(k>2?Math.cbrt(.5+D):k>1?Math.sqrt(.5+D):D),Q=D*E,G=D*x;k===1?O.x=L:k===2?(O.x=L*Math.cos(Q),O.y=L*Math.sin(Q)):(O.x=L*Math.sin(Q)*Math.cos(G),O.y=L*Math.cos(Q),O.z=L*Math.sin(Q)*Math.sin(G))}(isNaN(O.vx)||k>1&&isNaN(O.vy)||k>2&&isNaN(O.vz))&&(O.vx=0,k>1&&(O.vy=0),k>2&&(O.vz=0))}}function F(O){return O.initialize&&O.initialize(m,w,k),O}return m==null&&(m=[]),T(),A={tick:I,restart:function(){return b.restart(S),A},stop:function(){return b.stop(),A},numDimensions:function(O){return arguments.length?(k=Math.min(3,Math.max(1,Math.round(O))),z.forEach(F),A):k},nodes:function(O){return arguments.length?(m=O,T(),z.forEach(F),A):m},alpha:function(O){return arguments.length?(C=+O,A):C},alphaMin:function(O){return arguments.length?(R=+O,A):R},alphaDecay:function(O){return arguments.length?(P=+O,A):+P},alphaTarget:function(O){return arguments.length?(M=+O,A):M},velocityDecay:function(O){return arguments.length?(N=1-O,A):1-N},randomSource:function(O){return arguments.length?(w=O,z.forEach(F),A):w},force:function(O,D){return arguments.length>1?(D==null?z.delete(O):z.set(O,F(D)),A):z.get(O)},find:function(){var O,D,U,L,Q,G,j=Array.prototype.slice.call(arguments),V=j.shift()||0,q=(k>1?j.shift():null)||0,ie=(k>2?j.shift():null)||0,X=j.shift()||1/0,J=0,Tt=m.length;for(X*=X,J=0;J<Tt;++J)(L=(O=V-(Q=m[J]).x)*O+(D=q-(Q.y||0))*D+(U=ie-(Q.z||0))*U)<X&&(G=Q,X=L);return G},on:function(O,D){return arguments.length>1?(B.on(O,D),A):B.on(O)}}},e.forceX=function(m){var y,A,k,C=s(.1);function R(M){for(var N,z=0,b=y.length;z<b;++z)(N=y[z]).vx+=(k[z]-N.x)*A[z]*M}function P(){if(y){var M,N=y.length;for(A=new Array(N),k=new Array(N),M=0;M<N;++M)A[M]=isNaN(k[M]=+m(y[M],M,y))?0:+C(y[M],M,y)}}return typeof m!="function"&&(m=s(m==null?0:+m)),R.initialize=function(M){y=M,P()},R.strength=function(M){return arguments.length?(C=typeof M=="function"?M:s(+M),P(),R):C},R.x=function(M){return arguments.length?(m=typeof M=="function"?M:s(+M),P(),R):m},R},e.forceY=function(m){var y,A,k,C=s(.1);function R(M){for(var N,z=0,b=y.length;z<b;++z)(N=y[z]).vy+=(k[z]-N.y)*A[z]*M}function P(){if(y){var M,N=y.length;for(A=new Array(N),k=new Array(N),M=0;M<N;++M)A[M]=isNaN(k[M]=+m(y[M],M,y))?0:+C(y[M],M,y)}}return typeof m!="function"&&(m=s(m==null?0:+m)),R.initialize=function(M){y=M,P()},R.strength=function(M){return arguments.length?(C=typeof M=="function"?M:s(+M),P(),R):C},R.y=function(M){return arguments.length?(m=typeof M=="function"?M:s(+M),P(),R):m},R},e.forceZ=function(m){var y,A,k,C=s(.1);function R(M){for(var N,z=0,b=y.length;z<b;++z)(N=y[z]).vz+=(k[z]-N.z)*A[z]*M}function P(){if(y){var M,N=y.length;for(A=new Array(N),k=new Array(N),M=0;M<N;++M)A[M]=isNaN(k[M]=+m(y[M],M,y))?0:+C(y[M],M,y)}}return typeof m!="function"&&(m=s(m==null?0:+m)),R.initialize=function(M){y=M,P()},R.strength=function(M){return arguments.length?(C=typeof M=="function"?M:s(+M),P(),R):C},R.z=function(M){return arguments.length?(m=typeof M=="function"?M:s(+M),P(),R):m},R},Object.defineProperty(e,"__esModule",{value:!0})}),this._handleSetAttribute=(e,t)=>{let r=e.split("."),o=this;for(let a=0;a<r.length;a++)o=o==null?void 0:o[r[a]];o==null||o(t)},self.onmessage=function(e){let t=!1;if(e.data.type=="pause")this.simulation.stop();else if(e.data.type=="resume")this.simulation.restart();else if(e.data.type=="setAttribute")this._handleSetAttribute(e.data.attributeName,e.data.value);else if(e.data.type=="start"){let r=e.data.positions,o=e.data.edges;e.data.use2D&&(t=!0);let a=[],i=[];for(let s=0;s<r.length/3;s++){let l=r[s*3+0]*10,u=r[s*3+1]*10,h=r[s*3+2]*10,c=0;a.push({x:l,y:u,z:h,vz:c,ID:s})}for(let s=0;s<o.length/2;s++){let l=o[s*2],u=o[s*2+1],h={source:l,target:u};i.push(h)}this.repulsiveforce=d3.forceManyBody(),this.attractiveforce=d3.forceLink(i),this.centralForce=d3.forceCenter(),this.simulation=d3.forceSimulation(a).numDimensions(t?2:3).force("charge",this.repulsiveforce).force("link",this.attractiveforce).force("center",centralForce).force("gravity",this.gravityForce).velocityDecay(.05).on("tick",async()=>{for(let s=0;s<a.length;s++){const l=a[s];r[s*3+0]=l.x/10,r[s*3+1]=l.y/10,t?r[s*3+2]=0:r[s*3+2]=l.z/10}self.postMessage({type:"update",positions:r})}).on("end",()=>{self.postMessage({type:"stop"})})}}},Bs=Is.toString(),Ms=URL.createObjectURL(new Blob([`(${Bs})()`],{type:"text/javascript"}));class Rs{constructor({network:e=null,onUpdate:t=null,onStop:r=null,onStart:o=null,use2D:a=!1}){this._network=e,this._onUpdate=t,this._onStop=r,this._onStart=o,this._use2D=a,this._layoutWorker=null}start(){var e;return this._layoutWorker||(this._layoutWorker=new Worker(Ms),this._layoutWorker.onmessage=t=>{var r,o;t.data.type=="update"?(r=this._onUpdate)==null||r.call(this,t.data):t.data.type=="stop"?((o=this._onStop)==null||o.call(this,t.data),this._layoutRunning=!1):t.data.type=="getAttribute"?this._handleReturnAttribute(t.data):console.log("Layout received Unknown msg: ",t)},this._layoutRunning=!0,(e=this._onStart)==null||e.call(this),this._layoutWorker.postMessage({type:"start",positions:this._network.positions,edges:this._network.indexedEdges,use2D:this._use2D})),this}restart(){return this.stop(),this.start(),this}stop(){var e;return this._layoutRunning&&((e=this._onStop)==null||e.call(this)),this._layoutWorker.terminate(),this._layoutRunning=!1,delete this._layoutWorker,this._layoutWorker=null,this}resume(){var e;return this.start(),this._layoutRunning||((e=this._onStart)==null||e.call(this)),this._layoutWorker.postMessage({type:"resume"}),this._layoutRunning=!0,this}pause(){var e;return this._layoutWorker.postMessage({type:"pause"}),this._layoutRunning=!1,(e=this._onStop)==null||e.call(this),this}onUpdate(e){return this._onUpdate=e,this}onStop(e){return this._onStop=e,this}onStart(e){return this._onStart=e,this}isRunning(){return this._layoutRunning}cleanup(){this.stop()}async _handleGetAttribute(){}setAttribute(e,t){return this._layoutWorker.postMessage({type:"setAttribute",attributeName:e,value:t}),this}groups(e){return this.setAttribute("groups",e)}alpha(e){return this.setAttribute("alpha",e)}alphaDecay(e){return this.setAttribute("alphaDecay",e)}alphaTarget(e){return this.setAttribute("alphaTarget",e)}velocityDecay(e){return this.setAttribute("velocityDecay",e)}}let zn=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
 
uniform float globalSizeScale;
uniform float globalSizeBase;
uniform float globalWidthScale;
uniform float globalWidthBase;

uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 fromVertex;
attribute vec3 toVertex;
attribute vec2 vertexType;
// 0,1:  0.0, 1.0, // source, top
// 0,0:  0.0, 0.0, // source, bottom
// 1,1:  1.0, 1.0, // target, top
// 1,0:  1.0, 0.0, // target, bottom

attribute vec4 fromColor;
attribute vec4 toColor;
attribute float fromSize;
attribute float toSize;
attribute vec4 encodedIndex;

varying vec4 vColor;
varying vec3 vOffset;
varying vec4 vEncodedIndex;


//varying float vZComponent;

void main(void){
	vColor = (fromColor)*vertexType.x + (toColor)*(1.0-vertexType.x);
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	float updatedFromSize = globalSizeScale*fromSize+globalSizeBase;
	float updatedToSize = globalSizeScale*toSize+globalSizeBase;

	float width = globalWidthBase+globalWidthScale*((updatedFromSize)*vertexType.x + (updatedToSize)*(1.0-vertexType.x));
	vEncodedIndex = encodedIndex;
	//vZComponent = viewVertex.z;


	vec3 vertexCenter = fromVertex.xyz*vertexType.x + toVertex.xyz*(1.0-vertexType.x);
	vec3 destinationVertexCenter = fromVertex.xyz*(1.0-vertexType.x) + toVertex.xyz*vertexType.x;
	
	vec3 displacement = (viewMatrix*vec4((destinationVertexCenter-vertexCenter),0.0)).xyz;
	vec3 perpendicularVector = normalize(vec3(-displacement.y, displacement.x, 0.0));
	vec3 offset = width*(vertexType.x-0.5)*(vertexType.y-0.5)*4.0*1.5*perpendicularVector;
	
	vec4 viewVertex = viewMatrix * vec4(vertexCenter.xyz,1.0)+vec4(offset,0.0);
	float displacementLength = length(displacement);
	vOffset = vec3(vertexType.x,updatedToSize/displacementLength*1.5,updatedFromSize/displacementLength*1.5);
	

	vec4 temp_pos = projectionMatrix*viewVertex;
	// vec4 eye_vec = vec4(0.0,0.0,0.0,0);
	// float dist = length(eye_vec);
	// vec4 lookat = eye_vec - temp_pos;
	// vec4 dir = temp_pos - eye_vec;
	// vec4 center = normalize(-eye_vec);
	// vec4 proj = dot(temp_pos, normalize(-lookat)) * normalize(-lookat);
	// vec4 c = temp_pos - proj;
	// float magnitude = 1.0-acos(dot(normalize(-eye_vec), normalize(temp_pos)));

	// c = length(c) * magnitude * normalize(c);
	// vec4 dir2 = normalize(c-lookat);
	// temp_pos.xy = (dir2).xy;
	// temp_pos.z = 0.0;
	// temp_pos.w = 1.0;


	gl_Position = temp_pos;
	
}
`,Nn=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
 
uniform float globalSizeScale;
uniform float globalSizeBase;
uniform float globalWidthScale;
uniform float globalWidthBase;

uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 fromVertex;
attribute vec3 toVertex;
attribute vec2 vertexType;
// 0,1:  0.0, 1.0, // source, top
// 0,0:  0.0, 0.0, // source, bottom
// 1,1:  1.0, 1.0, // target, top
// 1,0:  1.0, 0.0, // target, bottom

attribute vec4 fromColor;
attribute vec4 toColor;
attribute float fromSize;
attribute float toSize;
attribute vec4 encodedIndex;

varying vec4 vColor;
varying vec3 vOffset;
varying vec4 vEncodedIndex;


vec2 hyperbolicNormFactor(vec2 vertex, float scaling){
	vec2 pos = vertex.xy;
	float r = length(pos.xy);
	// //polar
	// vec2 normFactor = (r+scaling)*vec2(1.0,1.0);
	// catersian
	vec2 normFactor = sqrt(vertex.xy*vertex.xy+scaling*scaling);
	return normFactor;
}

//varying float vZComponent;

void main(void){
	vColor = (fromColor)*vertexType.x + (toColor)*(1.0-vertexType.x);
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	float updatedFromSize = globalSizeScale*fromSize+globalSizeBase;
	float updatedToSize = globalSizeScale*toSize+globalSizeBase;

	float width = globalWidthBase+globalWidthScale*((updatedFromSize)*vertexType.x + (updatedToSize)*(1.0-vertexType.x));
	vEncodedIndex = encodedIndex;
	//vZComponent = viewVertex.z;

	float scaling = -viewMatrix[3][2];
	
	vec4 fromVertexView = viewMatrix * vec4(fromVertex.xyz,1.0);
	vec4 toVertexView = viewMatrix * vec4(toVertex.xyz,1.0);

	vec2 normFactorFrom = hyperbolicNormFactor(fromVertexView.xy, scaling);
	vec2 normFactorTo = hyperbolicNormFactor(toVertexView.xy, scaling);
	
	vec3 vertexCenter = fromVertexView.xyz*vertexType.x + toVertexView.xyz*(1.0-vertexType.x);
	vec3 destinationVertexCenter = fromVertexView.xyz*(1.0-vertexType.x) + toVertexView.xyz*vertexType.x;

	vec2 normFactorCenter = hyperbolicNormFactor(vertexCenter.xy, scaling);
	vec2 normFactorDestinationCenter = hyperbolicNormFactor(destinationVertexCenter.xy, scaling);

	fromVertexView.xy = fromVertexView.xy/normFactorFrom/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	toVertexView.xy = toVertexView.xy/normFactorTo/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	vertexCenter.xy = vertexCenter.xy/normFactorCenter/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	destinationVertexCenter.xy = destinationVertexCenter.xy/normFactorDestinationCenter/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);

	vec3 displacement = vec4((destinationVertexCenter-vertexCenter),0.0).xyz;
	vec3 perpendicularVector = normalize(vec3(-displacement.y, displacement.x, 0.0));
	vec3 offset = width*(vertexType.x-0.5)*(vertexType.y-0.5)*4.0*1.0*perpendicularVector/length(normFactorCenter)*scaling;
	
	vec4 viewVertex = vec4(vertexCenter.xyz,1.0)+vec4(offset,0.0);
	float displacementLength = length(displacement);
	// vOffset = vec3(vertexType.x,updatedToSize/displacementLength*1.0,updatedFromSize/displacementLength*1.0);
	vOffset = vec3(0.0,0.0,0.0);
	viewVertex.zw = vec2(0.0,1.0);
	vec4 temp_pos = projectionMatrix*viewVertex;
	gl_Position = temp_pos;
}
`,Fs=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vEncodedIndex;
varying vec4 vColor;
varying vec3 vOffset;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	if(vOffset.x<vOffset.y || vOffset.x>(1.0-vOffset.z)){
		discard;
	}

	// gl_FragColor = vec4(vOffset.x,vOffset.x,0,1.0);//vec4(vColor.xyz,globalOpacity*vColor.w);
	gl_FragColor = vColor;
}
`,Ts=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vEncodedIndex;
varying vec4 vColor;
varying vec3 vOffset;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){

	if(vOffset.x<vOffset.y*1.1 || vOffset.x>(1.0-vOffset.z*1.1) || (vEncodedIndex.x+vEncodedIndex.y+vEncodedIndex.z+vEncodedIndex.w)<=0.0){
		discard;
	}
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	gl_FragColor = vEncodedIndex;
	
}
`,Ss=`
uniform mat4 projectionViewMatrix;
uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 vertex;
attribute vec4 color;


varying vec4 vColor;
varying vec4 vEncodedIndex;

//varying float vZComponent;

void main(void){
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	//vZComponent = viewVertex.z;
	gl_Position =   projectionViewMatrix * vec4(vertex,1.0);
}
`,Ps=`
uniform mat4 projectionViewMatrix;
uniform float globalOpacityScale;
uniform float globalOpacityBase;

attribute vec3 vertex;
attribute vec4 color;


varying vec4 vColor;
varying vec4 vEncodedIndex;

//varying float vZComponent;

void main(void){
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	//vZComponent = viewVertex.z;

	vec4 temp_pos = projectionViewMatrix * vec4(vertex,1.0);
	vec4 eye_vec = vec4(0.0,0.0,1.0,0);
	float dist = length(eye_vec);
	vec4 lookat = eye_vec - temp_pos;
	vec4 dir = temp_pos - eye_vec;
	vec4 center = normalize(-eye_vec);
	vec4 proj = dot(temp_pos, normalize(-lookat)) * normalize(-lookat);
	vec4 c = temp_pos - proj;
	float magnitude = 1.0-acos(dot(normalize(-eye_vec), normalize(temp_pos)));

	c = length(c) * magnitude * normalize(c);
	vec4 dir2 = normalize(c-lookat);
	temp_pos.xy = (dir2).xy;
	temp_pos.z = 0.0;
	temp_pos.w = 1.0;
	gl_Position = temp_pos;
}
`,zs=`
#ifdef GL_ES
	precision highp float;
#endif
//uniform vec2 nearFar;
varying vec4 vColor;
//varying float vZComponent;
//gl_DepthRange.near)/gl_DepthRange.diff
void main(){
	//float w = (-vZComponent-nearFar[0])/(nearFar[1]-nearFar[0]);
	gl_FragColor = vColor;
	// gl_FragColor = vec4(vEncodedIndex.x/10,0,0,1.0);
}

`,Dt=`
// uniform mat4 projectionMatrix;
// uniform mat4 viewMatrix;
// uniform mat3 normalMatrix;


// attribute vec4 vertex;
// attribute vec3 normal;
// attribute vec3 position;
// attribute vec3 color;
// attribute float size;
// attribute float Opacity;

// varying vec3 vNormal;
// varying vec3 vEye;

// varying vec3 vColor;
// varying float vSize;
// varying float vOpacity;

// void main(void){
// 	vec4 viewVertex = viewMatrix * (vertex*vec4(vec3(size),1.0) + vec4(position,0.0));
// 	vNormal = normalMatrix * normal;
// 	vEye = -vec3(viewVertex);
// 	vOpacity = Opacity;
// 	vColor = color;
// 	gl_Position =   projectionMatrix * viewVertex;
// }

uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

uniform float globalOpacityScale;
uniform float globalSizeScale;
uniform float globalOutlineWidthScale;

uniform float globalOpacityBase;
uniform float globalSizeBase;
uniform float globalOutlineWidthBase;

attribute vec2 vertex;
// attribute vec3 normal;
attribute vec3 position;
attribute vec4 color;
attribute float size;
attribute float outlineWidth;
attribute vec4 outlineColor;
attribute vec4 encodedIndex;

varying vec3 vNormal;
varying vec3 vEye;
varying vec4 vColor;
varying vec2 vOffset;
varying float vSize;
varying vec4 vEncodedIndex;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;

void main(void){
	float BoxCorrection = 1.5;
	vec2 offset = vertex;
	float updatedSize = globalSizeScale*size+globalSizeBase;
	float updatedOutlineWidth = globalOutlineWidthScale*outlineWidth+globalOutlineWidthBase;
	float fullSize = updatedSize + updatedOutlineWidth;
	// vec4 viewCenters = viewMatrix*vec4(position,1);
	// vec3 viewCenters = position;
	// fragCenter = viewCenters
	// float scalingFactor = 1.0 / abs(centers.x)*0.001;
	// offset*=scalingFactor;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));

	// viewCenters.xy += offset*updatedSize*CameraRight_worldspace;
	
	vec4 viewCenters = viewMatrix*vec4(position+BoxCorrection*fullSize*(cameraRight*offset.x + cameraUp*offset.y),1.0);
	vNormal = vec3(0.0,0.0,1.0); //normalMatrix * normal;
	vEye = -vec3(offset,0.0);
	vEncodedIndex = encodedIndex;
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	vOutlineColor.w = clamp(globalOpacityBase+globalOpacityScale*vOutlineColor.w,0.0,1.0);
	vOffset = vertex;
	vSize = updatedSize;
	vOutlineThreshold = updatedOutlineWidth/fullSize;

	vOutlineColor = outlineColor;
	vPosition = projectionMatrix * viewCenters;

	// vec4 temp_pos = vPosition;
	// vec4 eye_vec = vec4(0.0,0.0,0.0,0);
	// float dist = length(eye_vec);
	// vec4 lookat = eye_vec - temp_pos;
	// vec4 dir = temp_pos - eye_vec;
	// vec4 center = normalize(-eye_vec);
	// vec4 proj = dot(temp_pos, normalize(-lookat)) * normalize(-lookat);
	// vec4 c = temp_pos - proj;
	// float magnitude = 1.0-acos(dot(normalize(-eye_vec), normalize(temp_pos)));

	// c = length(c) * magnitude * normalize(c);
	// vec4 dir2 = normalize(c-lookat);
	// vPosition.xy = (dir2).xy;
	// vPosition.z = 0.0;
	// vPosition.w = 1.0;
	gl_Position = vPosition;
}
`,Ut=`
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

uniform float globalOpacityScale;
uniform float globalSizeScale;
uniform float globalOutlineWidthScale;

uniform float globalOpacityBase;
uniform float globalSizeBase;
uniform float globalOutlineWidthBase;

attribute vec2 vertex;
// attribute vec3 normal;
attribute vec3 position;
attribute vec4 color;
attribute float size;
attribute float outlineWidth;
attribute vec4 outlineColor;
attribute vec4 encodedIndex;

varying vec3 vNormal;
varying vec3 vEye;
varying vec4 vColor;
varying vec2 vOffset;
varying float vSize;
varying vec4 vEncodedIndex;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;

vec2 hyperbolicNormFactor(vec2 vertex, float scaling){
	vec2 pos = vertex.xy;
	float r = length(pos.xy);
	// //polar
	// vec2 normFactor = (r+scaling)*vec2(1.0,1.0);
	// catersian
	vec2 normFactor = sqrt(vertex.xy*vertex.xy+scaling*scaling);
	return normFactor;
}

void main(void){
	float BoxCorrection = 1.5;
	vec2 offset = vertex;
	float updatedSize = globalSizeScale*size+globalSizeBase;
	float updatedOutlineWidth = globalOutlineWidthScale*outlineWidth+globalOutlineWidthBase;
	float fullSize = updatedSize + updatedOutlineWidth;
	// vec4 viewCenters = viewMatrix*vec4(position,1);
	// vec3 viewCenters = position;
	// fragCenter = viewCenters
	// float scalingFactor = 1.0 / abs(centers.x)*0.001;
	// offset*=scalingFactor;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));

	// viewCenters.xy += offset*updatedSize*CameraRight_worldspace;
	


	// temp_pos.z = 0.0;
	// temp_pos.w = 1.0;



	vec4 viewCenters = viewMatrix*vec4(position.xyz,1.0);
	float scaling = -viewMatrix[3][2];
	vec4 temp_pos = viewCenters;
	
	vec2 normFactor = hyperbolicNormFactor(viewCenters.xy, scaling);
	// catersian
	// vec2 normFactor = sqrt(temp_pos.xy*temp_pos.xy+scaling*scaling);
	temp_pos.xy = temp_pos.xy/normFactor;

	viewCenters.xy = temp_pos.xy/vec2(projectionMatrix[0][0],projectionMatrix[1][1]);
	viewCenters.xy+=BoxCorrection*fullSize*offset.xy/length(normFactor)*scaling;
	

	vNormal = vec3(0.0,0.0,1.0); //normalMatrix * normal;
	vEye = -vec3(offset,0.0);
	vEncodedIndex = encodedIndex;
	vColor = color;
	vColor.w = clamp(globalOpacityBase+globalOpacityScale*vColor.w,0.0,1.0);
	vOutlineColor.w = clamp(globalOpacityBase+globalOpacityScale*vOutlineColor.w,0.0,1.0);
	vOffset = vertex;
	vSize = updatedSize;
	vOutlineThreshold = updatedOutlineWidth/fullSize;

	vOutlineColor = outlineColor;
	vPosition = projectionMatrix * viewCenters;

	gl_Position = vPosition;
}
`,Ns=`// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;



void main(){
	// const vec3 lightDirection = vec3(0.577350269,0.577350269,0.577350269);
	// const float ambientFactor = 0.6;
	
	// vec3 normal = normalize(vNormal);
	// vec3 eye = normalize(vEye);
	
	// //Ambient+Diffuse
	// float cosTheta = max(dot(lightDirection,normal),0.0);
	// vec3 newColor = vColor*(ambientFactor+cosTheta);
	
	// //Specular
	// vec3 reflection = reflect(-lightDirection, normal);
	// float eyeDotReflection = max(dot(eye, reflection), 0.0);
	// newColor +=  vec3(0.5)* pow(eyeDotReflection, 60.0);
	
	// gl_FragColor = vec4(newColor,vOpacity);
	// gl_FragColor = vec4(eye,Opacity);
	//gl_FragData[0] = vec4(newColor,Opacity);

// Renaming variables passed from the Vertex Shader

	// vec3 cameraPos;
	// vec3 cameraNormal;

	// float lensqr = dot(vOffset, vOffset);

	// if(lensqr > 1.0)
	// 		discard;
		
	// cameraNormal = vec3(vOffset, sqrt(1.0 - lensqr));
	// cameraPos = (cameraNormal * size) + cameraSpherePos;

	// float len = length(point);
	// // VTK Fake Spheres
	// float radius = 1.;
	// if(len > radius)
	// 		discard;
	// vec3 normalizedPoint = normalize(vec3(point.xy, sqrt(1. - len)));
	// vec3 direction = normalize(vec3(1., 1., 1.));
	// float df2 = max(0, dot(direction, normalizedPoint));
	// float sf2 = pow(df2, 90);
	// fragOutput0 = vec4(max((df2+0.3) * color, sf2 * vec3(1)), 1);

	// fragOutput1 = vec4(vertexVC.xyz, 1.0);
	// fragOutput2 = vec4(normalVCVSOutput, 1.0);
	
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
		discard;
	

	vec3 normalizedPoint = normalize(vec3(vOffset.xy, sqrt(1. - lensqr)));
	const vec3 lightDirection = vec3(0.577350269,0.577350269,0.577350269);
	const float ambientFactor = 0.6;
	
	vec3 normal = normalizedPoint;
	vec3 eye = normalize(vEye);
	
	//Ambient+Diffuse
	float cosTheta = max(dot(lightDirection,normal),0.0);
	vec3 newColor = vColor.xyz*(ambientFactor+cosTheta);
	
	//Specular
	vec3 reflection = reflect(-lightDirection, normal);
	float eyeDotReflection = max(dot(eye, reflection), 0.0);
	newColor +=  vec3(0.5)* pow(eyeDotReflection, 60.0);
	
	
	
	if(lensqr < 1.0-vOutlineThreshold){
		// gl_FragColor = vec4(vColor,vOpacity)
		gl_FragColor = vec4(newColor,vColor.w);;
	}else{
		gl_FragColor = vec4(vOutlineColor.xyz,vOutlineColor.w);
	}
	// gl_FragDepthEXT = 0.5; 
}
`,Os=`
// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;

void main(){
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
			discard;
	
	gl_FragColor = vEncodedIndex;
}
`,Ds=`
// #ifdef GL_ES
// 	precision highp float;
// #endif

precision mediump float;
varying vec4 vColor;
varying vec4 vEncodedIndex;
varying vec3 vNormal;
varying vec3 vEye;
varying float vSize;
varying vec2 vOffset;
varying float vOutlineThreshold;
varying vec4 vOutlineColor;
varying vec4 vPosition;



void main(){
	
	float lensqr = dot(vOffset, vOffset);

	if(lensqr > 1.0)
			discard;
	
	if(lensqr < 1.0-vOutlineThreshold){
		// gl_FragColor = vec4(vColor,vOpacity)
		gl_FragColor = vColor;
	}else{
		gl_FragColor = vOutlineColor;
	}
	// gl_FragDepthEXT = 0.5; 
}
`;var ut={},Et={},Ye={};Object.defineProperty(Ye,"__esModule",{value:!0});var Us=function(){function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}();function Ls(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var On=Ye.LinkedList=function(){function n(){Ls(this,n),this.length=0,this.first=null,this.last=null}return Us(n,[{key:"forEach",value:function(e,t){for(var r=this.first,o=this.length,a=0;a<o;a++)e.call(t,r,a),r=r.next}},{key:"at",value:function(e){if(!(e>=0&&e<this.length))return null;for(var t=this.first;e--;)t=t.next;return t}},{key:"randomNode",value:function(){var e=Math.floor(Math.random()*this.length);return this.at(e)}},{key:"toArray",value:function(){for(var e=[],t=this.first,r=this.length;r--;)e.push(t.data||t),t=t.next;return e}}]),n}();On.prototype.each=On.prototype.forEach;Object.defineProperty(Et,"__esModule",{value:!0});Et.CircularLinkedList=void 0;var Qs=function(){function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),_r=Ye;function Gs(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function js(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n}function Vs(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var Dn=Et.CircularLinkedList=function(n){Vs(e,n);function e(){return Gs(this,e),js(this,Object.getPrototypeOf(e).apply(this,arguments))}return Qs(e,[{key:"append",value:function(t){this.first===null?(t.prev=t,t.next=t,this.first=t,this.last=t):(t.prev=this.last,t.next=this.first,this.first.prev=t,this.last.next=t,this.last=t),this.length++}},{key:"prepend",value:function(t){if(this.first===null){this.append(t);return}else t.prev=this.last,t.next=this.first,this.first.prev=t,this.last.next=t,this.first=t;this.length++}},{key:"insertAfter",value:function(t,r){r.prev=t,r.next=t.next,t.next.prev=r,t.next=r,r.prev===this.last&&(this.last=r),this.length++}},{key:"insertBefore",value:function(t,r){r.prev=t.prev,r.next=t,t.prev.next=r,t.prev=r,r.next===this.first&&(this.first=r),this.length++}},{key:"remove",value:function(t){this.length>1?(t.prev.next=t.next,t.next.prev=t.prev,t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)):(this.first=null,this.last=null),t.prev=null,t.next=null,this.length--}},{key:"withData",value:function(t){for(var r=this.first,o=this.last,a=Math.ceil(this.length/2);a--;){if(r.data===t)return r;if(o.data===t)return o;r=r.next,o=o.prev}return null}}]),e}(_r.LinkedList);Dn.fromArray=function(n,e){for(var t=new Dn,r=n.length;r--;)t.prepend(e?new _r.LinkedList.Node(n[r]):n[r]);return t};var Pe={},fe={};Object.defineProperty(fe,"__esModule",{value:!0});fe.PRECISION=1e-6;var ze={},Ne={},Un;function Re(){if(Un)return Ne;Un=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.Matrix=void 0;var n=function(){function a(i,s){for(var l=0;l<s.length;l++){var u=s[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,s,l){return s&&a(i.prototype,s),l&&a(i,l),i}}(),e=fe,t=ve();function r(a,i){if(!(a instanceof i))throw new TypeError("Cannot call a class as a function")}var o=Ne.Matrix=function(){function a(i){r(this,a),this.setElements(i)}return n(a,[{key:"e",value:function(i,s){return i<1||i>this.elements.length||s<1||s>this.elements[0].length?null:this.elements[i-1][s-1]}},{key:"row",value:function(i){return i>this.elements.length?null:new t.Vector(this.elements[i-1])}},{key:"col",value:function(i){if(this.elements.length===0||i>this.elements[0].length)return null;for(var s=[],l=this.elements.length,u=0;u<l;u++)s.push(this.elements[u][i-1]);return new t.Vector(s)}},{key:"dimensions",value:function(){var i=this.elements.length===0?0:this.elements[0].length;return{rows:this.elements.length,cols:i}}},{key:"rows",value:function(){return this.elements.length}},{key:"cols",value:function(){return this.elements.length===0?0:this.elements[0].length}},{key:"eql",value:function(i){var s=i.elements||i;if((!s[0]||typeof s[0][0]>"u")&&(s=new a(s).elements),this.elements.length===0||s.length===0)return this.elements.length===s.length;if(this.elements.length!==s.length||this.elements[0].length!==s[0].length)return!1;for(var l=this.elements.length,u=this.elements[0].length,h;l--;)for(h=u;h--;)if(Math.abs(this.elements[l][h]-s[l][h])>e.PRECISION)return!1;return!0}},{key:"dup",value:function(){return new a(this.elements)}},{key:"map",value:function(i,s){if(this.elements.length===0)return new a([]);for(var l=[],u=this.elements.length,h=this.elements[0].length,c;u--;)for(c=h,l[u]=[];c--;)l[u][c]=i.call(s,this.elements[u][c],u+1,c+1);return new a(l)}},{key:"isSameSizeAs",value:function(i){var s=i.elements||i;return typeof s[0][0]>"u"&&(s=new a(s).elements),this.elements.length===0?s.length===0:this.elements.length===s.length&&this.elements[0].length===s[0].length}},{key:"add",value:function(i){if(this.elements.length===0)return this.map(function(l){return l});var s=i.elements||i;return typeof s[0][0]>"u"&&(s=new a(s).elements),this.isSameSizeAs(s)?this.map(function(l,u,h){return l+s[u-1][h-1]}):null}},{key:"subtract",value:function(i){if(this.elements.length===0)return this.map(function(l){return l});var s=i.elements||i;return typeof s[0][0]>"u"&&(s=new a(s).elements),this.isSameSizeAs(s)?this.map(function(l,u,h){return l-s[u-1][h-1]}):null}},{key:"canMultiplyFromLeft",value:function(i){if(this.elements.length===0)return!1;var s=i.elements||i;return typeof s[0][0]>"u"&&(s=new a(s).elements),this.elements[0].length===s.length}},{key:"multiply",value:function(i){if(this.elements.length===0)return null;if(!i.elements)return this.map(function(p){return p*i});var s=!!i.modulus,g=i.elements||i;if(typeof g[0][0]>"u"&&(g=new a(g).elements),!this.canMultiplyFromLeft(g))return null;for(var l=this.elements.length,u=g[0].length,h,c=this.elements[0].length,f,d=[],v;l--;)for(h=u,d[l]=[];h--;){for(f=c,v=0;f--;)v+=this.elements[l][f]*g[f][h];d[l][h]=v}var g=new a(d);return s?g.col(1):g}},{key:"minor",value:function(i,s,l,u){if(this.elements.length===0)return null;for(var h=[],c=l,f,d,v,g=this.elements.length,p=this.elements[0].length;c--;)for(f=l-c-1,h[f]=[],d=u;d--;)v=u-d-1,h[f][v]=this.elements[(i+f-1)%g][(s+v-1)%p];return new a(h)}},{key:"transpose",value:function(){if(this.elements.length===0)return new a([]);for(var i=this.elements.length,h,s=this.elements[0].length,l,u=[],h=s;h--;)for(l=i,u[h]=[];l--;)u[h][l]=this.elements[l][h];return new a(u)}},{key:"isSquare",value:function(){var i=this.elements.length===0?0:this.elements[0].length;return this.elements.length===i}},{key:"max",value:function(){if(this.elements.length===0)return null;for(var i=0,s=this.elements.length,l=this.elements[0].length,u;s--;)for(u=l;u--;)Math.abs(this.elements[s][u])>Math.abs(i)&&(i=this.elements[s][u]);return i}},{key:"indexOf",value:function(i){if(this.elements.length===0)return null;var s=this.elements.length,l,u=this.elements[0].length,h;for(l=0;l<s;l++)for(h=0;h<u;h++)if(this.elements[l][h]===i)return{i:l+1,j:h+1};return null}},{key:"diagonal",value:function(){if(!this.isSquare)return null;for(var i=[],s=this.elements.length,l=0;l<s;l++)i.push(this.elements[l][l]);return new t.Vector(i)}},{key:"toRightTriangular",value:function(){if(this.elements.length===0)return new a([]);var i=this.dup(),s,l=this.elements.length,u,h,c=this.elements[0].length,f;for(u=0;u<l;u++){if(i.elements[u][u]===0){for(h=u+1;h<l;h++)if(i.elements[h][u]!==0){for(s=[],f=0;f<c;f++)s.push(i.elements[u][f]+i.elements[h][f]);i.elements[u]=s;break}}if(i.elements[u][u]!==0)for(h=u+1;h<l;h++){var d=i.elements[h][u]/i.elements[u][u];for(s=[],f=0;f<c;f++)s.push(f<=u?0:i.elements[h][f]-i.elements[u][f]*d);i.elements[h]=s}}return i}},{key:"determinant",value:function(){if(this.elements.length===0)return 1;if(!this.isSquare())return null;for(var i=this.toRightTriangular(),s=i.elements[0][0],l=i.elements.length,u=1;u<l;u++)s=s*i.elements[u][u];return s}},{key:"isSingular",value:function(){return this.isSquare()&&this.determinant()===0}},{key:"trace",value:function(){if(this.elements.length===0)return 0;if(!this.isSquare())return null;for(var i=this.elements[0][0],s=this.elements.length,l=1;l<s;l++)i+=this.elements[l][l];return i}},{key:"rank",value:function(){if(this.elements.length===0)return 0;for(var i=this.toRightTriangular(),s=0,l=this.elements.length,u=this.elements[0].length,h;l--;)for(h=u;h--;)if(Math.abs(i.elements[l][h])>e.PRECISION){s++;break}return s}},{key:"augment",value:function(i){if(this.elements.length===0)return this.dup();var s=i.elements||i;typeof s[0][0]>"u"&&(s=new a(s).elements);var l=this.dup(),u=l.elements[0].length,h=l.elements.length,c=s[0].length,f;if(h!==s.length)return null;for(;h--;)for(f=c;f--;)l.elements[h][u+f]=s[h][f];return l}},{key:"inverse",value:function(){if(this.elements.length===0||!this.isSquare()||this.isSingular())return null;for(var i=this.elements.length,s=i,l,u=this.augment(a.I(i)).toRightTriangular(),h=u.elements[0].length,c,f,d,v=[],g;s--;){for(f=[],v[s]=[],d=u.elements[s][s],c=0;c<h;c++)g=u.elements[s][c]/d,f.push(g),c>=i&&v[s].push(g);for(u.elements[s]=f,l=s;l--;){for(f=[],c=0;c<h;c++)f.push(u.elements[l][c]-u.elements[s][c]*u.elements[l][s]);u.elements[l]=f}}return new a(v)}},{key:"round",value:function(){return this.map(function(i){return Math.round(i)})}},{key:"snapTo",value:function(i){return this.map(function(s){return Math.abs(s-i)<=e.PRECISION?i:s})}},{key:"inspect",value:function(){var i=[],s=this.elements.length;if(s===0)return"[]";for(var l=0;l<s;l++)i.push(new t.Vector(this.elements[l]).inspect());return i.join(`
`)}},{key:"setElements",value:function(i){var s,l,u=i.elements||i;if(u[0]&&typeof u[0][0]<"u"){for(s=u.length,this.elements=[];s--;)for(l=u[s].length,this.elements[s]=[];l--;)this.elements[s][l]=u[s][l];return this}var h=u.length;for(this.elements=[],s=0;s<h;s++)this.elements.push([u[s]]);return this}},{key:"flatten",value:function(){var i=[];if(this.elements.length==0)return[];for(var s=0;s<this.elements[0].length;s++)for(var l=0;l<this.elements.length;l++)i.push(this.elements[l][s]);return i}},{key:"ensure4x4",value:function(){if(this.elements.length==4&&this.elements[0].length==4)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(var i=0;i<this.elements.length;i++)for(var s=this.elements[i].length;s<4;s++)i==s?this.elements[i].push(1):this.elements[i].push(0);for(var i=this.elements.length;i<4;i++)i==0?this.elements.push([1,0,0,0]):i==1?this.elements.push([0,1,0,0]):i==2?this.elements.push([0,0,1,0]):i==3&&this.elements.push([0,0,0,1]);return this}},{key:"make3x3",value:function(){return this.elements.length!=4||this.elements[0].length!=4?null:new a([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])}}]),a}();return o.I=function(a){for(var i=[],s=a,l;s--;)for(l=a,i[s]=[];l--;)i[s][l]=s===l?1:0;return new o(i)},o.Diagonal=function(a){for(var i=a.length,s=o.I(i);i--;)s.elements[i][i]=a[i];return s},o.Rotation=function(a,i){if(!i)return new o([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var s=i.dup();if(s.elements.length!==3)return null;var l=s.modulus(),u=s.elements[0]/l,h=s.elements[1]/l,c=s.elements[2]/l,f=Math.sin(a),d=Math.cos(a),v=1-d;return new o([[v*u*u+d,v*u*h-f*c,v*u*c+f*h],[v*u*h+f*c,v*h*h+d,v*h*c-f*u],[v*u*c-f*h,v*h*c+f*u,v*c*c+d]])},o.RotationX=function(a){var i=Math.cos(a),s=Math.sin(a);return new o([[1,0,0],[0,i,-s],[0,s,i]])},o.RotationY=function(a){var i=Math.cos(a),s=Math.sin(a);return new o([[i,0,s],[0,1,0],[-s,0,i]])},o.RotationZ=function(a){var i=Math.cos(a),s=Math.sin(a);return new o([[i,-s,0],[s,i,0],[0,0,1]])},o.Random=function(a,i){return o.Zero(a,i).map(function(){return Math.random()})},o.Translation=function(a){if(a.elements.length==2){var i=o.I(3);return i.elements[2][0]=a.elements[0],i.elements[2][1]=a.elements[1],i}if(a.elements.length==3){var i=o.I(4);return i.elements[0][3]=a.elements[0],i.elements[1][3]=a.elements[1],i.elements[2][3]=a.elements[2],i}throw"Invalid length for Translation"},o.Zero=function(a,i){for(var s=[],l=a,u;l--;)for(u=i,s[l]=[];u--;)s[l][u]=0;return new o(s)},o.prototype.toUpperTriangular=o.prototype.toRightTriangular,o.prototype.det=o.prototype.determinant,o.prototype.tr=o.prototype.trace,o.prototype.rk=o.prototype.rank,o.prototype.inv=o.prototype.inverse,o.prototype.x=o.prototype.multiply,Ne}var Ln;function ve(){if(Ln)return ze;Ln=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.Vector=void 0;var n=function(){function a(i,s){for(var l=0;l<s.length;l++){var u=s[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}return function(i,s,l){return s&&a(i.prototype,s),l&&a(i,l),i}}(),e=Re(),t=fe;function r(a,i){if(!(a instanceof i))throw new TypeError("Cannot call a class as a function")}var o=ze.Vector=function(){function a(i){r(this,a),this.setElements(i)}return n(a,[{key:"e",value:function(i){return i<1||i>this.elements.length?null:this.elements[i-1]}},{key:"dimensions",value:function(){return this.elements.length}},{key:"modulus",value:function(){return Math.sqrt(this.dot(this))}},{key:"eql",value:function(i){var s=this.elements.length,l=i.elements||i;if(s!==l.length)return!1;for(;s--;)if(Math.abs(this.elements[s]-l[s])>t.PRECISION)return!1;return!0}},{key:"dup",value:function(){return new a(this.elements)}},{key:"map",value:function(i,s){var l=[];return this.each(function(u,h){l.push(i.call(s,u,h))}),new a(l)}},{key:"forEach",value:function(i,s){for(var l=this.elements.length,u=0;u<l;u++)i.call(s,this.elements[u],u+1)}},{key:"toUnitVector",value:function(){var i=this.modulus();return i===0?this.dup():this.map(function(s){return s/i})}},{key:"angleFrom",value:function(i){var s=i.elements||i,l=this.elements.length;if(l!==s.length)return null;var u=0,h=0,c=0;if(this.each(function(d,v){u+=d*s[v-1],h+=d*d,c+=s[v-1]*s[v-1]}),h=Math.sqrt(h),c=Math.sqrt(c),h*c===0)return null;var f=u/(h*c);return f<-1&&(f=-1),f>1&&(f=1),Math.acos(f)}},{key:"isParallelTo",value:function(i){var s=this.angleFrom(i);return s===null?null:s<=t.PRECISION}},{key:"isAntiparallelTo",value:function(i){var s=this.angleFrom(i);return s===null?null:Math.abs(s-Math.PI)<=t.PRECISION}},{key:"isPerpendicularTo",value:function(i){var s=this.dot(i);return s===null?null:Math.abs(s)<=t.PRECISION}},{key:"add",value:function(i){var s=i.elements||i;return this.elements.length!==s.length?null:this.map(function(l,u){return l+s[u-1]})}},{key:"subtract",value:function(i){var s=i.elements||i;return this.elements.length!==s.length?null:this.map(function(l,u){return l-s[u-1]})}},{key:"multiply",value:function(i){return this.map(function(s){return s*i})}},{key:"dot",value:function(i){var s=i.elements||i,l=0,u=this.elements.length;if(u!==s.length)return null;for(;u--;)l+=this.elements[u]*s[u];return l}},{key:"cross",value:function(i){var s=i.elements||i;if(this.elements.length!==3||s.length!==3)return null;var l=this.elements;return new a([l[1]*s[2]-l[2]*s[1],l[2]*s[0]-l[0]*s[2],l[0]*s[1]-l[1]*s[0]])}},{key:"max",value:function(){for(var i=0,s=this.elements.length;s--;)Math.abs(this.elements[s])>Math.abs(i)&&(i=this.elements[s]);return i}},{key:"indexOf",value:function(i){for(var s=null,l=this.elements.length,u=0;u<l;u++)s===null&&this.elements[u]===i&&(s=u+1);return s}},{key:"toDiagonalMatrix",value:function(){return e.Matrix.Diagonal(this.elements)}},{key:"round",value:function(){return this.map(function(i){return Math.round(i)})}},{key:"snapTo",value:function(i){return this.map(function(s){return Math.abs(s-i)<=t.PRECISION?i:s})}},{key:"distanceFrom",value:function(i){if(i.anchor||i.start&&i.end)return i.distanceFrom(this);var s=i.elements||i;if(s.length!==this.elements.length)return null;var l=0,u;return this.each(function(h,c){u=h-s[c-1],l+=u*u}),Math.sqrt(l)}},{key:"liesOn",value:function(i){return i.contains(this)}},{key:"liesIn",value:function(i){return i.contains(this)}},{key:"rotate",value:function(i,s){var l,u=null,h,c,f;switch(i.determinant&&(u=i.elements),this.elements.length){case 2:return l=s.elements||s,l.length!==2?null:(u||(u=e.Matrix.Rotation(i).elements),h=this.elements[0]-l[0],c=this.elements[1]-l[1],new a([l[0]+u[0][0]*h+u[0][1]*c,l[1]+u[1][0]*h+u[1][1]*c]));case 3:{if(!s.direction)return null;var d=s.pointClosestTo(this).elements;return u||(u=e.Matrix.Rotation(i,s.direction).elements),h=this.elements[0]-d[0],c=this.elements[1]-d[1],f=this.elements[2]-d[2],new a([d[0]+u[0][0]*h+u[0][1]*c+u[0][2]*f,d[1]+u[1][0]*h+u[1][1]*c+u[1][2]*f,d[2]+u[2][0]*h+u[2][1]*c+u[2][2]*f])}default:return null}}},{key:"reflectionIn",value:function(i){if(i.anchor){var s=this.elements.slice(),l=i.pointClosestTo(s).elements;return new a([l[0]+(l[0]-s[0]),l[1]+(l[1]-s[1]),l[2]+(l[2]-(s[2]||0))])}else{var u=i.elements||i;return this.elements.length!==u.length?null:this.map(function(h,c){return u[c-1]+(u[c-1]-h)})}}},{key:"to3D",value:function(){var i=this.dup();switch(i.elements.length){case 3:break;case 2:{i.elements.push(0);break}default:return null}return i}},{key:"inspect",value:function(){return"["+this.elements.join(", ")+"]"}},{key:"setElements",value:function(i){return this.elements=(i.elements||i).slice(),this}},{key:"flatten",value:function(){return this.elements}}]),a}();return o.Random=function(a){for(var i=[];a--;)i.push(Math.random());return new o(i)},o.Zero=function(a){for(var i=[];a--;)i.push(0);return new o(i)},o.prototype.x=o.prototype.multiply,o.prototype.each=o.prototype.forEach,o.i=new o([1,0,0]),o.j=new o([0,1,0]),o.k=new o([0,0,1]),ze}var Oe={},Qn;function kt(){if(Qn)return Oe;Qn=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.Plane=void 0;var n=function(){function s(l,u){for(var h=0;h<u.length;h++){var c=u[h];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(l,c.key,c)}}return function(l,u,h){return u&&s(l.prototype,u),h&&s(l,h),l}}(),e=fe,t=Re(),r=ve(),o=Ct();function a(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}var i=Oe.Plane=function(){function s(l,u,h){a(this,s),this.setVectors(l,u,h)}return n(s,[{key:"eql",value:function(l){return this.contains(l.anchor)&&this.isParallelTo(l)}},{key:"dup",value:function(){return new s(this.anchor,this.normal)}},{key:"translate",value:function(l){var u=l.elements||l;return new s([this.anchor.elements[0]+u[0],this.anchor.elements[1]+u[1],this.anchor.elements[2]+(u[2]||0)],this.normal)}},{key:"isParallelTo",value:function(l){var u;return l.normal?(u=this.normal.angleFrom(l.normal),Math.abs(u)<=e.PRECISION||Math.abs(Math.PI-u)<=e.PRECISION):l.direction?this.normal.isPerpendicularTo(l.direction):null}},{key:"isPerpendicularTo",value:function(l){var u=this.normal.angleFrom(l.normal);return Math.abs(Math.PI/2-u)<=e.PRECISION}},{key:"distanceFrom",value:function(l){if(this.intersects(l)||this.contains(l))return 0;if(l.anchor){var u=this.anchor.elements,h=l.anchor.elements,c=this.normal.elements;return Math.abs((u[0]-h[0])*c[0]+(u[1]-h[1])*c[1]+(u[2]-h[2])*c[2])}else{var f=l.elements||l,u=this.anchor.elements,c=this.normal.elements;return Math.abs((u[0]-f[0])*c[0]+(u[1]-f[1])*c[1]+(u[2]-(f[2]||0))*c[2])}}},{key:"contains",value:function(l){if(l.normal)return null;if(l.direction)return this.contains(l.anchor)&&this.contains(l.anchor.add(l.direction));var u=l.elements||l,h=this.anchor.elements,c=this.normal.elements,f=Math.abs(c[0]*(h[0]-u[0])+c[1]*(h[1]-u[1])+c[2]*(h[2]-(u[2]||0)));return f<=e.PRECISION}},{key:"intersects",value:function(l){return typeof l.direction>"u"&&typeof l.normal>"u"?null:!this.isParallelTo(l)}},{key:"intersectionWith",value:function(l){if(!this.intersects(l))return null;if(l.direction){var u=l.anchor.elements,h=l.direction.elements,c=this.anchor.elements,f=this.normal.elements,d=(f[0]*(c[0]-u[0])+f[1]*(c[1]-u[1])+f[2]*(c[2]-u[2]))/(f[0]*h[0]+f[1]*h[1]+f[2]*h[2]);return new r.Vector([u[0]+h[0]*d,u[1]+h[1]*d,u[2]+h[2]*d])}else if(l.normal){for(var v=this.normal.cross(l.normal).toUnitVector(),f=this.normal.elements,u=this.anchor.elements,g=l.normal.elements,p=l.anchor.elements,_=t.Matrix.Zero(2,2),E=0;_.isSingular();)E++,_=new t.Matrix([[f[E%3],f[(E+1)%3]],[g[E%3],g[(E+1)%3]]]);for(var x=_.inverse().elements,m=f[0]*u[0]+f[1]*u[1]+f[2]*u[2],y=g[0]*p[0]+g[1]*p[1]+g[2]*p[2],A=[x[0][0]*m+x[0][1]*y,x[1][0]*m+x[1][1]*y],k=[],C=1;C<=3;C++)k.push(E===C?0:A[(C+(5-E)%3)%3]);return new o.Line(k,v)}}},{key:"pointClosestTo",value:function(l){var u=l.elements||l,h=this.anchor.elements,c=this.normal.elements,f=(h[0]-u[0])*c[0]+(h[1]-u[1])*c[1]+(h[2]-(u[2]||0))*c[2];return new r.Vector([u[0]+c[0]*f,u[1]+c[1]*f,(u[2]||0)+c[2]*f])}},{key:"rotate",value:function(l,u){var h=l.determinant?l.elements:t.Matrix.Rotation(l,u.direction).elements,c=u.pointClosestTo(this.anchor).elements,f=this.anchor.elements,d=this.normal.elements,v=c[0],g=c[1],p=c[2],_=f[0],E=f[1],x=f[2],m=_-v,y=E-g,A=x-p;return new s([v+h[0][0]*m+h[0][1]*y+h[0][2]*A,g+h[1][0]*m+h[1][1]*y+h[1][2]*A,p+h[2][0]*m+h[2][1]*y+h[2][2]*A],[h[0][0]*d[0]+h[0][1]*d[1]+h[0][2]*d[2],h[1][0]*d[0]+h[1][1]*d[1]+h[1][2]*d[2],h[2][0]*d[0]+h[2][1]*d[1]+h[2][2]*d[2]])}},{key:"reflectionIn",value:function(l){if(l.normal){var u=this.anchor.elements,h=this.normal.elements,c=u[0],f=u[1],d=u[2],v=h[0],g=h[1],p=h[2],_=this.anchor.reflectionIn(l).elements,E=c+v,x=f+g,m=d+p,y=l.pointClosestTo([E,x,m]).elements,A=[y[0]+(y[0]-E)-_[0],y[1]+(y[1]-x)-_[1],y[2]+(y[2]-m)-_[2]];return new s(_,A)}else{if(l.direction)return this.rotate(Math.PI,l);var k=l.elements||l;return new s(this.anchor.reflectionIn([k[0],k[1],k[2]||0]),this.normal)}}},{key:"setVectors",value:function(l,u,h){if(l=new r.Vector(l),l=l.to3D(),l===null||(u=new r.Vector(u),u=u.to3D(),u===null))return null;if(typeof h>"u")h=null;else if(h=new r.Vector(h),h=h.to3D(),h===null)return null;var c=l.elements[0],f=l.elements[1],d=l.elements[2],v=u.elements[0],g=u.elements[1],p=u.elements[2],_,E;if(h!==null){var x=h.elements[0],m=h.elements[1],y=h.elements[2];if(_=new r.Vector([(g-f)*(y-d)-(p-d)*(m-f),(p-d)*(x-c)-(v-c)*(y-d),(v-c)*(m-f)-(g-f)*(x-c)]),E=_.modulus(),E===0)return null;_=new r.Vector([_.elements[0]/E,_.elements[1]/E,_.elements[2]/E])}else{if(E=Math.sqrt(v*v+g*g+p*p),E===0)return null;_=new r.Vector([u.elements[0]/E,u.elements[1]/E,u.elements[2]/E])}return this.anchor=l,this.normal=_,this}}]),s}();return i.XY=new i(r.Vector.Zero(3),r.Vector.k),i.YZ=new i(r.Vector.Zero(3),r.Vector.i),i.ZX=new i(r.Vector.Zero(3),r.Vector.j),i.YX=i.XY,i.ZY=i.YZ,i.XZ=i.ZX,i.fromPoints=function(s){var l=s.length,u=[],h,c,f,d,v,g,p,_,E,x,m=r.Vector.Zero(3);for(h=0;h<l;h++){if(c=new r.Vector(s[h]).to3D(),c===null)return null;if(u.push(c),f=u.length,f>2){if(v=u[f-1].elements,g=u[f-2].elements,p=u[f-3].elements,d=new r.Vector([(v[1]-g[1])*(p[2]-g[2])-(v[2]-g[2])*(p[1]-g[1]),(v[2]-g[2])*(p[0]-g[0])-(v[0]-g[0])*(p[2]-g[2]),(v[0]-g[0])*(p[1]-g[1])-(v[1]-g[1])*(p[0]-g[0])]).toUnitVector(),f>3&&(E=d.angleFrom(x),E!==null&&!(Math.abs(E)<=e.PRECISION||Math.abs(E-Math.PI)<=e.PRECISION)))return null;m=m.add(d),x=d}}return v=u[1].elements,g=u[0].elements,p=u[f-1].elements,_=u[f-2].elements,m=m.add(new r.Vector([(v[1]-g[1])*(p[2]-g[2])-(v[2]-g[2])*(p[1]-g[1]),(v[2]-g[2])*(p[0]-g[0])-(v[0]-g[0])*(p[2]-g[2]),(v[0]-g[0])*(p[1]-g[1])-(v[1]-g[1])*(p[0]-g[0])]).toUnitVector()).add(new r.Vector([(g[1]-p[1])*(_[2]-p[2])-(g[2]-p[2])*(_[1]-p[1]),(g[2]-p[2])*(_[0]-p[0])-(g[0]-p[0])*(_[2]-p[2]),(g[0]-p[0])*(_[1]-p[1])-(g[1]-p[1])*(_[0]-p[0])]).toUnitVector()),new i(u[0],m)},Oe}var Gn;function Ct(){if(Gn)return Pe;Gn=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Line=void 0;var n=function(){function s(l,u){for(var h=0;h<u.length;h++){var c=u[h];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(l,c.key,c)}}return function(l,u,h){return u&&s(l.prototype,u),h&&s(l,h),l}}(),e=fe,t=ve(),r=Re(),o=kt();function a(s,l){if(!(s instanceof l))throw new TypeError("Cannot call a class as a function")}var i=Pe.Line=function(){function s(l,u){a(this,s),this.setVectors(l,u)}return n(s,[{key:"eql",value:function(l){return this.isParallelTo(l)&&this.contains(l.anchor)}},{key:"dup",value:function(){return new s(this.anchor,this.direction)}},{key:"translate",value:function(l){var u=l.elements||l;return new s([this.anchor.elements[0]+u[0],this.anchor.elements[1]+u[1],this.anchor.elements[2]+(u[2]||0)],this.direction)}},{key:"isParallelTo",value:function(l){if(l.normal||l.start&&l.end)return l.isParallelTo(this);var u=this.direction.angleFrom(l.direction);return Math.abs(u)<=e.PRECISION||Math.abs(u-Math.PI)<=e.PRECISION}},{key:"distanceFrom",value:function(l){if(l.normal||l.start&&l.end)return l.distanceFrom(this);if(l.direction){if(this.isParallelTo(l))return this.distanceFrom(l.anchor);var u=this.direction.cross(l.direction).toUnitVector().elements,h=this.anchor.elements,c=l.anchor.elements;return Math.abs((h[0]-c[0])*u[0]+(h[1]-c[1])*u[1]+(h[2]-c[2])*u[2])}else{var f=l.elements||l,h=this.anchor.elements,d=this.direction.elements,v=f[0]-h[0],g=f[1]-h[1],p=(f[2]||0)-h[2],_=Math.sqrt(v*v+g*g+p*p);if(_===0)return 0;var E=(v*d[0]+g*d[1]+p*d[2])/_,x=1-E*E;return Math.abs(_*Math.sqrt(x<0?0:x))}}},{key:"contains",value:function(l){if(l.start&&l.end)return this.contains(l.start)&&this.contains(l.end);var u=this.distanceFrom(l);return u!==null&&u<=e.PRECISION}},{key:"positionOf",value:function(l){if(!this.contains(l))return null;var u=l.elements||l,h=this.anchor.elements,c=this.direction.elements;return(u[0]-h[0])*c[0]+(u[1]-h[1])*c[1]+((u[2]||0)-h[2])*c[2]}},{key:"liesIn",value:function(l){return l.contains(this)}},{key:"intersects",value:function(l){return l.normal?l.intersects(this):!this.isParallelTo(l)&&this.distanceFrom(l)<=e.PRECISION}},{key:"intersectionWith",value:function(l){if(l.normal||l.start&&l.end)return l.intersectionWith(this);if(!this.intersects(l))return null;var u=this.anchor.elements,h=this.direction.elements,c=l.anchor.elements,f=l.direction.elements,d=h[0],v=h[1],g=h[2],p=f[0],_=f[1],E=f[2],x=u[0]-c[0],m=u[1]-c[1],y=u[2]-c[2],A=-d*x-v*m-g*y,k=p*x+_*m+E*y,C=d*d+v*v+g*g,R=p*p+_*_+E*E,P=d*p+v*_+g*E,M=(A*R/C+P*k)/(R-P*P);return new t.Vector([u[0]+M*d,u[1]+M*v,u[2]+M*g])}},{key:"pointClosestTo",value:function(l){if(l.start&&l.end){var u=l.pointClosestTo(this);return u===null?null:this.pointClosestTo(u)}else if(l.direction){if(this.intersects(l))return this.intersectionWith(l);if(this.isParallelTo(l))return null;var h=this.direction.elements,c=l.direction.elements,f=h[0],d=h[1],v=h[2],g=c[0],p=c[1],_=c[2],E=v*g-f*_,x=f*p-d*g,m=d*_-v*p,y=[E*_-x*p,x*g-m*_,m*p-E*g],u=new o.Plane(l.anchor,y);return u.intersectionWith(this)}else{var u=l.elements||l;if(this.contains(u))return new t.Vector(u);var A=this.anchor.elements,h=this.direction.elements,f=h[0],d=h[1],v=h[2],k=A[0],C=A[1],R=A[2],E=f*(u[1]-C)-d*(u[0]-k),x=d*((u[2]||0)-R)-v*(u[1]-C),m=v*(u[0]-k)-f*((u[2]||0)-R),P=new t.Vector([d*E-v*m,v*x-f*E,f*m-d*x]),M=this.distanceFrom(u)/P.modulus();return new t.Vector([u[0]+P.elements[0]*M,u[1]+P.elements[1]*M,(u[2]||0)+P.elements[2]*M])}}},{key:"rotate",value:function(l,u){typeof u.direction>"u"&&(u=new s(u.to3D(),t.Vector.k));var h=r.Matrix.Rotation(l,u.direction).elements,c=u.pointClosestTo(this.anchor).elements,f=this.anchor.elements,d=this.direction.elements,v=c[0],g=c[1],p=c[2],_=f[0],E=f[1],x=f[2],m=_-v,y=E-g,A=x-p;return new s([v+h[0][0]*m+h[0][1]*y+h[0][2]*A,g+h[1][0]*m+h[1][1]*y+h[1][2]*A,p+h[2][0]*m+h[2][1]*y+h[2][2]*A],[h[0][0]*d[0]+h[0][1]*d[1]+h[0][2]*d[2],h[1][0]*d[0]+h[1][1]*d[1]+h[1][2]*d[2],h[2][0]*d[0]+h[2][1]*d[1]+h[2][2]*d[2]])}},{key:"reverse",value:function(){return new s(this.anchor,this.direction.x(-1))}},{key:"reflectionIn",value:function(l){if(l.normal){var u=this.anchor.elements,h=this.direction.elements,c=u[0],f=u[1],d=u[2],v=h[0],g=h[1],p=h[2],_=this.anchor.reflectionIn(l).elements,E=c+v,x=f+g,m=d+p,y=l.pointClosestTo([E,x,m]).elements,A=[y[0]+(y[0]-E)-_[0],y[1]+(y[1]-x)-_[1],y[2]+(y[2]-m)-_[2]];return new s(_,A)}else{if(l.direction)return this.rotate(Math.PI,l);var k=l.elements||l;return new s(this.anchor.reflectionIn([k[0],k[1],k[2]||0]),this.direction)}}},{key:"setVectors",value:function(l,u){if(l=new t.Vector(l),u=new t.Vector(u),l.elements.length===2&&l.elements.push(0),u.elements.length===2&&u.elements.push(0),l.elements.length>3||u.elements.length>3)return null;var h=u.modulus();return h===0?null:(this.anchor=l,this.direction=new t.Vector([u.elements[0]/h,u.elements[1]/h,u.elements[2]/h]),this)}}]),s}();return i.X=new i(t.Vector.Zero(3),t.Vector.i),i.Y=new i(t.Vector.Zero(3),t.Vector.j),i.Z=new i(t.Vector.Zero(3),t.Vector.k),Pe}var It={};Object.defineProperty(It,"__esModule",{value:!0});It.LineSegment=void 0;var Ws=function(){function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),De=ve(),Hs=kt(),qs=Ct();function Ys(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}It.LineSegment=function(){function n(e,t){Ys(this,n),this.setPoints(e,t)}return Ws(n,[{key:"eql",value:function(e){return this.start.eql(e.start)&&this.end.eql(e.end)||this.start.eql(e.end)&&this.end.eql(e.start)}},{key:"dup",value:function(){return new n(this.start,this.end)}},{key:"length",value:function(){var e=this.start.elements,t=this.end.elements,r=t[0]-e[0],o=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(r*r+o*o+a*a)}},{key:"toVector",value:function(){var e=this.start.elements,t=this.end.elements;return new De.Vector([t[0]-e[0],t[1]-e[1],t[2]-e[2]])}},{key:"midpoint",value:function(){var e=this.start.elements,t=this.end.elements;return new De.Vector([(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2])}},{key:"bisectingPlane",value:function(){return new Hs.Plane(this.midpoint(),this.toVector())}},{key:"translate",value:function(e){var t=e.elements||e,r=this.start.elements,o=this.end.elements;return new n([r[0]+t[0],r[1]+t[1],r[2]+(t[2]||0)],[o[0]+t[0],o[1]+t[1],o[2]+(t[2]||0)])}},{key:"isParallelTo",value:function(e){return this.line.isParallelTo(e)}},{key:"distanceFrom",value:function(e){var t=this.pointClosestTo(e);return t===null?null:t.distanceFrom(e)}},{key:"contains",value:function(e){if(e.start&&e.end)return this.contains(e.start)&&this.contains(e.end);var t=(e.elements||e).slice();if(t.length===2&&t.push(0),this.start.eql(t))return!0;var r=this.start.elements,o=new De.Vector([r[0]-t[0],r[1]-t[1],r[2]-(t[2]||0)]),a=this.toVector();return o.isAntiparallelTo(a)&&o.modulus()<=a.modulus()}},{key:"intersects",value:function(e){return this.intersectionWith(e)!==null}},{key:"intersectionWith",value:function(e){if(!this.line.intersects(e))return null;var t=this.line.intersectionWith(e);return this.contains(t)?t:null}},{key:"pointClosestTo",value:function(e){if(e.normal){var t=this.line.intersectionWith(e);return t===null?null:this.pointClosestTo(t)}else{var r=this.line.pointClosestTo(e);return r===null?null:this.contains(r)?r:(this.line.positionOf(r)<0?this.start:this.end).dup()}}},{key:"setPoints",value:function(e,t){return e=new De.Vector(e).to3D(),t=new De.Vector(t).to3D(),e===null||t===null?null:(this.line=new qs.Line(e,t.subtract(e)),this.start=e,this.end=t,this)}}]),n}();var hn={};Object.defineProperty(hn,"__esModule",{value:!0});function Xs(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}hn.LinkedListNode=function n(e){Xs(this,n),this.prev=null,this.next=null,this.data=e};var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.Polygon=void 0;var Zs=function(){function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),le=Ye,jn=fe,Ks=Re(),Ue=ve(),Lt=kt(),$s=Ct();function Js(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}Bt.Polygon=function(){function n(e,t){Js(this,n),this.setVertices(e,t)}return Zs(n,[{key:"v",value:function(e){return this.vertices.at(e-1).data}},{key:"nodeFor",value:function(e){return this.vertices.withData(e)}},{key:"dup",value:function(){return new n(this.vertices,this.plane)}},{key:"translate",value:function(e){var t=e.elements||e;return this.vertices.each(function(r){var o=r.data.elements;r.data.setElements([o[0]+t[0],o[1]+t[1],o[2]+(t[2]||0)])}),this.plane=this.plane.translate(e),this.updateTrianglePlanes(function(r){return r.translate(e)}),this}},{key:"rotate",value:function(e,t){var r=Ks.Matrix.Rotation(e,t.direction);return this.vertices.each(function(o){o.data.setElements(o.data.rotate(r,t).elements)}),this.plane=this.plane.rotate(r,t),this.updateTrianglePlanes(function(o){return o.rotate(r,t)}),this}},{key:"scale",value:function(e,t){var r=t.elements||t;this.vertices.each(function(a){var i=a.data.elements;a.data.setElements([r[0]+e*(i[0]-r[0]),r[1]+e*(i[1]-r[1]),(r[2]||0)+e*(i[2]-(r[2]||0))])});var o=this.vertices.first.data;return this.plane.anchor.setElements(o),this.updateTrianglePlanes(function(a){return new Lt.Plane(o,a.normal)}),this}},{key:"updateTrianglePlanes",value:function(e){var t;if(this.cached.triangles!==null)for(t=this.cached.triangles.length;t--;)this.cached.triangles[t].plane=e(this.cached.triangles[t].plane);if(this.cached.surfaceIntegralElements!==null)for(t=this.cached.surfaceIntegralElements.length;t--;)this.cached.surfaceIntegralElements[t].plane=e(this.cached.surfaceIntegralElements[t].plane)}},{key:"isTriangle",value:function(){return this.vertices.length===3}},{key:"trianglesForSurfaceIntegral",value:function(){if(this.cached.surfaceIntegralElements!==null)return this.cached.surfaceIntegralElements;var e=[],t=this.vertices.first.data,r=this.plane;return this.vertices.each(function(o,a){if(!(a<2)){var i=[t,o.prev.data,o.data];e.push(new n(i,Lt.Plane.fromPoints(i)||r))}}),this.setCache("surfaceIntegralElements",e)}},{key:"area",value:function(){if(this.isTriangle()){var e=this.vertices.first,t=e.next,r=t.next;return e=e.data.elements,t=t.data.elements,r=r.data.elements,.5*new Ue.Vector([(e[1]-t[1])*(r[2]-t[2])-(e[2]-t[2])*(r[1]-t[1]),(e[2]-t[2])*(r[0]-t[0])-(e[0]-t[0])*(r[2]-t[2]),(e[0]-t[0])*(r[1]-t[1])-(e[1]-t[1])*(r[0]-t[0])]).modulus()}else{for(var o=this.trianglesForSurfaceIntegral(),a=0,i=o.length;i--;)a+=o[i].area()*o[i].plane.normal.dot(this.plane.normal);return a}}},{key:"centroid",value:function(){if(this.isTriangle()){var e=this.v(1).elements,t=this.v(2).elements,r=this.v(3).elements;return new Ue.Vector([(e[0]+t[0]+r[0])/3,(e[1]+t[1]+r[1])/3,(e[2]+t[2]+r[2])/3])}else{for(var e,o=0,a=Ue.Vector.Zero(3),i,r,s=this.trianglesForSurfaceIntegral(),l=s.length;l--;)e=s[l].area()*s[l].plane.normal.dot(this.plane.normal),o+=e,i=a.elements,r=s[l].centroid().elements,a.setElements([i[0]+r[0]*e,i[1]+r[1]*e,i[2]+r[2]*e]);return a.x(1/o)}}},{key:"projectionOn",value:function(e){var t=[];return this.vertices.each(function(r){t.push(e.pointClosestTo(r.data))}),new n(t)}},{key:"removeVertex",value:function(e){if(!this.isTriangle()){var t=this.nodeFor(e);if(t===null)return null;this.clearCache();var r=t.prev,o=t.next,a=r.data.isConvex(this),i=o.data.isConvex(this);return t.data.isConvex(this)?this.convexVertices.remove(this.convexVertices.withData(t.data)):this.reflexVertices.remove(this.reflexVertices.withData(t.data)),this.vertices.remove(t),a!==r.data.isConvex(this)&&(a?(this.convexVertices.remove(this.convexVertices.withData(r.data)),this.reflexVertices.append(new le.LinkedList.Node(r.data))):(this.reflexVertices.remove(this.reflexVertices.withData(r.data)),this.convexVertices.append(new le.LinkedList.Node(r.data)))),i!==o.data.isConvex(this)&&(i?(this.convexVertices.remove(this.convexVertices.withData(o.data)),this.reflexVertices.append(new le.LinkedList.Node(o.data))):(this.reflexVertices.remove(this.reflexVertices.withData(o.data)),this.convexVertices.append(new le.LinkedList.Node(o.data)))),this}}},{key:"contains",value:function(e){return this.containsByWindingNumber(e)}},{key:"containsByWindingNumber",value:function(e){var t=e.elements||e;if(!this.plane.contains(t)||this.hasEdgeContaining(t))return!1;var r,o,a,i,s=0,l,u=0,h=this;return this.vertices.each(function(c){r=c.data.elements,o=c.next.data.elements,a=new Ue.Vector([r[0]-t[0],r[1]-t[1],r[2]-(t[2]||0)]),i=new Ue.Vector([o[0]-t[0],o[1]-t[1],o[2]-(t[2]||0)]),l=a.angleFrom(i),!(l===null||l===0)&&(s+=(a.cross(i).isParallelTo(h.plane.normal)?1:-1)*l,s>=2*Math.PI-jn.PRECISION&&(u++,s-=2*Math.PI),s<=-2*Math.PI+jn.PRECISION&&(u--,s+=2*Math.PI))}),u!==0}},{key:"hasEdgeContaining",value:function(e){var t=e.elements||e,r=!1;return this.vertices.each(function(o){$s.Line.Segment.create(o.data,o.next.data).contains(t)&&(r=!0)}),r}},{key:"toTriangles",value:function(){return this.cached.triangles!==null?this.cached.triangles:this.setCache("triangles",this.triangulateByEarClipping())}},{key:"triangulateByEarClipping",value:function(){for(var e=this.dup(),t=[],r,o,a,i;!e.isTriangle();){for(r=!1;!r;)r=!0,o=e.convexVertices.randomNode(),a=e.vertices.withData(o.data),i=new n([a.data,a.next.data,a.prev.data],this.plane),e.reflexVertices.each(function(s){s.data!==a.prev.data&&s.data!==a.next.data&&(i.contains(s.data)||i.hasEdgeContaining(s.data))&&(r=!1)});t.push(i),e.removeVertex(a.data)}return t.push(new n(e.vertices,this.plane)),t}},{key:"setVertices",value:function(e,t){var r=e.toArray?e.toArray():e;if(this.plane=t&&t.normal?t.dup():Lt.Plane.fromPoints(r),this.plane===null)return null;this.vertices=new le.LinkedList.Circular;for(var o=r.length,a;o--;)a=r[o].isConvex?r[o]:new n.Vertex(r[o]),this.vertices.prepend(new le.LinkedList.Node(a));return this.clearCache(),this.populateVertexTypeLists(),this}},{key:"populateVertexTypeLists",value:function(){this.convexVertices=new le.LinkedList.Circular,this.reflexVertices=new le.LinkedList.Circular;var e=this;this.vertices.each(function(t){e[t.data.type(e)+"Vertices"].append(new le.LinkedList.Node(t.data))})}},{key:"copyVertices",value:function(){this.clearCache(),this.vertices.each(function(e){e.data=new n.Vertex(e.data)}),this.populateVertexTypeLists()}},{key:"clearCache",value:function(){this.cached={triangles:null,surfaceIntegralElements:null}}},{key:"setCache",value:function(e,t){return this.cached[e]=t,t}},{key:"inspect",value:function(){var e=[];return this.vertices.each(function(t){e.push(t.data.inspect())}),e.join(" -> ")}}]),n}();var Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.Vertex=void 0;var el=function(){function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),tl=ve(),Vn=fe;function nl(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Wn(n,e){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:n}function rl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(n,e):n.__proto__=e)}var Hn=Mt.Vertex=function(n){rl(e,n);function e(t){nl(this,e);var r=Wn(this,Object.getPrototypeOf(e).call(this,t));if(r.setElements(t),r.elements.length===2&&r.elements.push(0),r.elements.length!==3){var o;return o=null,Wn(r,o)}return r}return el(e,[{key:"isConvex",value:function(t){var r=t.nodeFor(this);if(r===null)return null;var o=r.prev.data,a=r.next.data,i=a.subtract(this),s=o.subtract(this),l=i.angleFrom(s);return l<=Vn.PRECISION?!0:Math.abs(l-Math.PI)<=Vn.PRECISION?!1:i.cross(s).dot(t.plane.normal)>0}},{key:"isReflex",value:function(t){var r=this.isConvex(t);return r===null?null:!r}},{key:"type",value:function(t){var r=this.isConvex(t);return r===null?null:r?"convex":"reflex"}}]),e}(tl.Vector);Hn.convert=function(n){for(var e=n.toArray?n.toArray():n,t=[],r=e.length,o=0;o<r;o++)t.push(new Hn(e[o]));return t};var ke={};Object.defineProperty(ke,"__esModule",{value:!0});ke.mht=il;ke.makeLookAt=ol;ke.makeOrtho=al;ke.makePerspective=sl;ke.makeFrustum=wr;var Qt=ve(),pt=Re();function il(n){var e="";if(n.length==16)for(var t=0;t<4;t++)e+="<span style='font-family: monospace'>["+n[t*4+0].toFixed(4)+","+n[t*4+1].toFixed(4)+","+n[t*4+2].toFixed(4)+","+n[t*4+3].toFixed(4)+"]</span><br>";else if(n.length==9)for(var t=0;t<3;t++)e+="<span style='font-family: monospace'>["+n[t*3+0].toFixed(4)+","+n[t*3+1].toFixed(4)+","+n[t*3+2].toFixed(4)+"]</font><br>";else return n.toString();return e}function ol(n,e,t,r,o,a,i,s,l){var u=new Qt.Vector([n,e,t]),h=new Qt.Vector([r,o,a]),c=new Qt.Vector([i,s,l]),f=u.subtract(h).toUnitVector(),d=c.cross(f).toUnitVector(),v=f.cross(d).toUnitVector(),g=new pt.Matrix([[d.e(1),d.e(2),d.e(3),0],[v.e(1),v.e(2),v.e(3),0],[f.e(1),f.e(2),f.e(3),0],[0,0,0,1]]),p=new pt.Matrix([[1,0,0,-n],[0,1,0,-e],[0,0,1,-t],[0,0,0,1]]);return g.x(p)}function al(n,e,t,r,o,a){var i=-(e+n)/(e-n),s=-(r+t)/(r-t),l=-(a+o)/(a-o);return new pt.Matrix([[2/(e-n),0,0,i],[0,2/(r-t),0,s],[0,0,-2/(a-o),l],[0,0,0,1]])}function sl(n,e,t,r){var o=t*Math.tan(n*Math.PI/360),a=-o,i=a*e,s=o*e;return wr(i,s,a,o,t,r)}function wr(n,e,t,r,o,a){var i=2*o/(e-n),s=2*o/(r-t),l=(e+n)/(e-n),u=(r+t)/(r-t),h=-(a+o)/(a-o),c=-2*a*o/(a-o);return new pt.Matrix([[i,0,l,0],[0,s,u,0],[0,0,h,c],[0,0,-1,0]])}(function(n){Object.defineProperty(n,"__esModule",{value:!0});var e=Et;Object.defineProperty(n,"CircularLinkedList",{enumerable:!0,get:function(){return e.CircularLinkedList}});var t=Ct();Object.defineProperty(n,"Line",{enumerable:!0,get:function(){return t.Line}});var r=It;Object.defineProperty(n,"LineSegment",{enumerable:!0,get:function(){return r.LineSegment}});var o=Ye;Object.defineProperty(n,"LinkedList",{enumerable:!0,get:function(){return o.LinkedList}});var a=hn;Object.defineProperty(n,"LinkedListNode",{enumerable:!0,get:function(){return a.LinkedListNode}});var i=Re();Object.defineProperty(n,"Matrix",{enumerable:!0,get:function(){return i.Matrix}});var s=kt();Object.defineProperty(n,"Plane",{enumerable:!0,get:function(){return s.Plane}});var l=Bt;Object.defineProperty(n,"Polygon",{enumerable:!0,get:function(){return l.Polygon}});var u=ve();Object.defineProperty(n,"Vector",{enumerable:!0,get:function(){return u.Vector}});var h=Mt;Object.defineProperty(n,"Vertex",{enumerable:!0,get:function(){return h.Vertex}});var c=ke;Object.defineProperty(n,"mht",{enumerable:!0,get:function(){return c.mht}}),Object.defineProperty(n,"makeLookAt",{enumerable:!0,get:function(){return c.makeLookAt}}),Object.defineProperty(n,"makePerspective",{enumerable:!0,get:function(){return c.makePerspective}}),Object.defineProperty(n,"makeFrustum",{enumerable:!0,get:function(){return c.makeFrustum}}),Object.defineProperty(n,"makeOrtho",{enumerable:!0,get:function(){return c.makeOrtho}});var f=fe;Object.defineProperty(n,"PRECISION",{enumerable:!0,get:function(){return f.PRECISION}})})(ut);function Rt(n){for(var e=n.length/6|0,t=new Array(e),r=0;r<e;)t[r]="#"+n.slice(r*6,++r*6);return t}function Ft(n){var e=n.length;return function(t){return n[Math.max(0,Math.min(e-1,Math.floor(t*e)))]}}Ft(Rt("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725"));Ft(Rt("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf"));var ll=Ft(Rt("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4"));Ft(Rt("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));let ul=`precision highp float; 

uniform sampler2D input_tex;
uniform sampler2D lut_tex;  
uniform float diverging;  
varying vec2 tex_coord;     
void main(){
	float val = texture2D( input_tex, tex_coord ).r+0.5*diverging;
	vec4 color = texture2D( lut_tex, vec2(val, 0.5) );
	gl_FragColor = vec4(color.rgb,1.0);
}
`,hl=`

attribute vec2 vertex;   
attribute vec2 texCoord; 
uniform mat4 uMVMatrix;  
uniform mat4 uPMatrix;   
varying vec2 tex_coord;  
void main(){
	tex_coord = texCoord; 
	gl_Position = uPMatrix * uMVMatrix * vec4( vertex, 0.0, 1.0 ); 
}

`,cl=`precision highp float;

varying vec2 quad_coord; 
varying float v_kernel_weight; 
uniform float kernel_weightScale; 
void main(void) { 
	float len = length( quad_coord ); 
	float nrm = v_kernel_weight * kernel_weightScale * 0.3989422804014327 * exp( -0.5*25.0*len*len ); 
	// gl_FragColor = vec4(1,1,1,1.0);//vec4(nrm,nrm,nrm, nrm );	
	gl_FragColor = vec4(nrm,nrm,nrm, nrm );
	// gl_FragColor = vec4(1,1,1, 1.0 ); 
}

`,fl=`

attribute vec3 position;
attribute float kernel_weight;

attribute vec2 offset;
// attribute vec3 normal;

uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

uniform mat4 uMVMatrix; 
uniform mat4 uPMatrix; 
uniform float bandwidthScale; 
uniform vec2 bandwidth; 
varying vec2 quad_coord; 
varying float v_kernel_weight; 

void main(void) { 
	// vec4 viewCenters = viewMatrix*vec4(position,1.0);
	// vec2 pos = (viewCenters).xy; 
	// quad_coord = offset.xy;  
	// pos += bandwidthScale * bandwidth * quad_coord; 
	// gl_Position = uPMatrix * uMVMatrix * vec4( pos, 0.0, 1.0); 
	


	float BoxCorrection = 1.5;
	float fullSize = bandwidthScale * 5.5;
	vec3 cameraRight = normalize(vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]));
	vec3 cameraUp = normalize(vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]));
	// vec4 viewCenters = viewMatrix*vec4(position+BoxCorrection*fullSize*(cameraRight*offset.x + cameraUp*offset.y),1.0);
	vec4 viewCenters = viewMatrix*vec4(position,1.0);
	viewCenters.xy += bandwidthScale * bandwidth * offset.xy;
	quad_coord = offset.xy; 
	v_kernel_weight = kernel_weight;
	gl_Position = projectionMatrix * viewCenters;
} 
`;function At(n,e,t){let r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.log(n.getShaderInfoLog(r)),null)}function dl(n){let e=At(n,cl,n.FRAGMENT_SHADER),t=At(n,fl,n.VERTEX_SHADER),r=n.createProgram();return n.attachShader(r,t),n.attachShader(r,e),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS)||alert("Could not initialise shaders"),n.useProgram(r),r.vertexPositionAttribute=n.getAttribLocation(r,"position"),r.vertexKernelWeightAttribute=n.getAttribLocation(r,"kernel_weight"),r.vertexOffsetAttribute=n.getAttribLocation(r,"offset"),r.pMatrixUniform=n.getUniformLocation(r,"uPMatrix"),r.mvMatrixUniform=n.getUniformLocation(r,"uMVMatrix"),r.projectionMatrixUniform=n.getUniformLocation(r,"projectionMatrix"),r.viewMatrixUniform=n.getUniformLocation(r,"viewMatrix"),r.bandwidthUniform=n.getUniformLocation(r,"bandwidth"),r.bandwidthScaleUniform=n.getUniformLocation(r,"bandwidthScale"),r.kernel_weightScaleUniform=n.getUniformLocation(r,"kernel_weightScale"),r}function gl(n){let e=At(n,ul,n.FRAGMENT_SHADER),t=At(n,hl,n.VERTEX_SHADER),r=n.createProgram();return n.attachShader(r,t),n.attachShader(r,e),n.linkProgram(r),n.getProgramParameter(r,n.LINK_STATUS)||alert("Could not initialise shaders"),n.useProgram(r),r.vertexAttribute=n.getAttribLocation(r,"vertex"),r.texCoordAttribute=n.getAttribLocation(r,"texCoord"),r.pMatrixUniform=n.getUniformLocation(r,"uPMatrix"),r.mvMatrixUniform=n.getUniformLocation(r,"uMVMatrix"),r.input_texUniform=n.getUniformLocation(r,"input_tex"),r.lut_texUniform=n.getUniformLocation(r,"lut_tex"),r.divergingUniform=n.getUniformLocation(r,"diverging"),r}function ue(n){console.log(n)}class ml{constructor(e,t,r,o=.1){this.gl=e,this.FBO,this.lutShader,this.shaderProgram,this.mvMatrix,this.pMatrix,this.qualityScale=o,this._divergingColormap=!1,this.bandwidth=[5.5,5.5],this.bandwidthScale=5,this.kernel_weightScale=.5,this.triangleVertexPositionBuffer,this.squareVertexPositionBuffer,this.PANEL_TEX_COORDS=[0,0,1,0,0,1,1,0,1,1,0,1],this.PANEL_TEX_POS=[0,0,1,0,0,1,1,0,1,1,0,1],this.QUAD_POS_BUFFER,this.QUAD_COORD_BUFFER,this.LUT_TEX,this.DATA=null,this.kernel_weights=null,this.resize(t,r),this.shaderProgram=dl(this.gl),this.lutShader=gl(this.gl),this.initBuffers(),this.setColormap()}loadIdentity(){this.mvMatrix=ut.Matrix.I(4)}multMatrix(e){this.mvMatrix=this.mvMatrix.x(e)}mvScale(e){this.mvMatrix.elements[0][0]*=e[0],this.mvMatrix.elements[0][1]*=e[0],this.mvMatrix.elements[0][2]*=e[0],this.mvMatrix.elements[0][3]*=e[0],this.mvMatrix.elements[1][0]*=e[1],this.mvMatrix.elements[1][1]*=e[1],this.mvMatrix.elements[1][2]*=e[1],this.mvMatrix.elements[1][3]*=e[1],this.mvMatrix.elements[2][0]*=e[2],this.mvMatrix.elements[2][1]*=e[2],this.mvMatrix.elements[2][2]*=e[2],this.mvMatrix.elements[2][3]*=e[2]}mvTranslate(e){var t=ut.Matrix.Translation($V([e[0],e[1],e[2]])).ensure4x4();this.multMatrix(t)}perspective(e,t,r,o){this.pMatrix=makePerspective(e,t,r,o)}ortho(e,t,r,o){this.pMatrix=ut.makeOrtho(e,t,r,o,-1,1)}setMatrixUniforms(e){this.gl.uniformMatrix4fv(e.pMatrixUniform,!1,new Float32Array(this.pMatrix.flatten())),this.gl.uniformMatrix4fv(e.mvMatrixUniform,!1,new Float32Array(this.mvMatrix.flatten()))}initBuffers(){let e=this.gl;this.triangleVertexPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.triangleVertexPositionBuffer);var t=[0,1,0,-1,-1,0,1,-1,0];e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.triangleVertexPositionBuffer.itemSize=3,this.triangleVertexPositionBuffer.numItems=3,this.squareVertexPositionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.squareVertexPositionBuffer),t=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this.squareVertexPositionBuffer.itemSize=3,this.squareVertexPositionBuffer.numItems=4,this.QUAD_POS_BUFFER=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.QUAD_POS_BUFFER),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.PANEL_TEX_POS),e.STATIC_DRAW),this.QUAD_POS_BUFFER.itemSize=2,this.QUAD_POS_BUFFER.numItems=6,this.QUAD_COORD_BUFFER=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.QUAD_COORD_BUFFER),e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.PANEL_TEX_COORDS),e.STATIC_DRAW),this.QUAD_COORD_BUFFER.itemSize=2,this.QUAD_COORD_BUFFER.numItems=6,this.nodesGeometry=br(e,!1,!1)}drawScene(e,t){let r=this.width,o=this.height,a=this.gl,i=a.getExtension("ANGLE_instanced_arrays"),s=a.getParameter(a.FRAMEBUFFER_BINDING),l=a.getParameter(a.VIEWPORT);a.viewport(0,0,r*this.qualityScale,o*this.qualityScale),this.ortho(0,r,o,0),this.loadIdentity(),this.projectionMatrix=e,this.viewMatrix=t,a.bindFramebuffer(a.FRAMEBUFFER,this.FBO.id),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE),a.useProgram(this.shaderProgram),this.setMatrixUniforms(this.shaderProgram),a.uniform1f(this.shaderProgram.bandwidthScaleUniform,this.bandwidthScale),a.uniformMatrix4fv(this.shaderProgram.viewMatrixUniform,!1,this.viewMatrix),a.uniformMatrix4fv(this.shaderProgram.projectionMatrixUniform,!1,this.projectionMatrix),a.uniform2f(this.shaderProgram.bandwidthUniform,this.bandwidth[0],this.bandwidth[1]),a.uniform1f(this.shaderProgram.kernel_weightScaleUniform,this.kernel_weightScale),a.enableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),a.enableVertexAttribArray(this.shaderProgram.vertexKernelWeightAttribute),a.enableVertexAttribArray(this.shaderProgram.vertexOffsetAttribute),a.bindBuffer(a.ARRAY_BUFFER,this.nodesGeometry.vertexObject),a.vertexAttribPointer(this.shaderProgram.vertexOffsetAttribute,3,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(this.shaderProgram.vertexOffsetAttribute,0),a.bindBuffer(a.ARRAY_BUFFER,this.kernelWeightsBuffer),a.vertexAttribPointer(this.shaderProgram.vertexKernelWeightAttribute,1,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(this.shaderProgram.vertexKernelWeightAttribute,1),a.bindBuffer(a.ARRAY_BUFFER,this.positionsBuffer),a.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,this.positionsBuffer.itemSize,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(this.shaderProgram.vertexPositionAttribute,1),this.nodesGeometry.indexObject?i.drawElementsInstancedANGLE(a.TRIANGLES,this.nodesGeometry.numIndices,this.nodesGeometry.indexType,0,this.positionsBuffer.numItems):i.drawArraysInstancedANGLE(a.TRIANGLE_STRIP,0,this.nodesGeometry.numIndices,this.positionsBuffer.numItems),i.vertexAttribDivisorANGLE(this.shaderProgram.vertexPositionAttribute,0),i.vertexAttribDivisorANGLE(this.shaderProgram.vertexKernelWeightAttribute,0),a.bindFramebuffer(a.FRAMEBUFFER,s),a.disableVertexAttribArray(this.shaderProgram.vertexPositionAttribute),a.disableVertexAttribArray(this.shaderProgram.vertexKernelWeightAttribute),a.disableVertexAttribArray(this.shaderProgram.vertexOffsetAttribute),a.disable(a.BLEND),a.viewport(l[0],l[1],l[2],l[3]),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.FBO.tex),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this.LUT_TEX),a.useProgram(this.lutShader),a.enableVertexAttribArray(this.lutShader.vertexAttribute),a.enableVertexAttribArray(this.lutShader.texCoordAttribute),a.uniform1i(this.lutShader.input_texUniform,0),a.uniform1i(this.lutShader.lut_texUniform,1),a.uniform1f(this.lutShader.divergingUniform,+this._divergingColormap),this.ortho(0,1,0,1),this.loadIdentity(),this.setMatrixUniforms(this.lutShader),a.bindBuffer(a.ARRAY_BUFFER,this.QUAD_POS_BUFFER),a.vertexAttribPointer(this.lutShader.vertexAttribute,this.QUAD_POS_BUFFER.itemSize,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.QUAD_COORD_BUFFER),a.vertexAttribPointer(this.lutShader.texCoordAttribute,this.QUAD_COORD_BUFFER.itemSize,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLES,0,this.QUAD_POS_BUFFER.numItems),a.disableVertexAttribArray(this.lutShader.vertexAttribute),a.disableVertexAttribArray(this.lutShader.texCoordAttribute)}resize(e,t,r=!1){(this.width!==e||this.height!==t||r)&&(e>0&&(this.width=e),t>0&&(this.height=t),this.deleteFBO(),this.create_FBO())}create_FBO(){let e=this.width*this.qualityScale,t=this.height*this.qualityScale,r=this.gl;try{var o=r.getExtension("OES_texture_float"),a=r.getExtension("OES_texture_float_linear")}catch{var o=!1,a=!1}let i={};i.id=r.createFramebuffer(),i.tex=r.createTexture(),r.bindTexture(r.TEXTURE_2D,i.tex),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o&&a?(ue("[ OK ] Floating point textures (OES_texture_float) is supported"),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.FLOAT,null)):(ue("[FAIL] Floating point textures (OES_texture_float) is <B>NOT</B> supported, falling back to 8 bit blending. OES_texture_float is supported in Chrome dev version."),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null)),r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,i.id),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i.tex,0);let s=r.checkFramebufferStatus(r.FRAMEBUFFER);s==r.FRAMEBUFFER_COMPLETE?ue("[ OK ] Framebuffer Initialization"):s==r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?ue("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_ATTACHMENT <br/>               Not all framebuffer attachment points are framebuffer attachment complete."):s==r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?ue("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_DIMENSIONS <br/>               Not all attached images have the same width and height. "):s==r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?ue("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT <br/> No images are attached to the framebuffer. "):s==r.FRAMEBUFFER_INCOMPLETE_UNSUPPORTED?ue("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_INCOMPLETE_UNSUPPORTED <br/> The combination of internal formats of the attached images violates an implementation-dependent set of restrictions."):s==r.FRAMEBUFFER_UNSUPPORTED?ue("[FAIL] Framebuffer Creation FAIL GL_FRAMEBUFFER_UNSUPPORTED <br/>             The combination of internal formats of the attached images violates an implementation-dependent set of restrictions."):ue("[FAIL] Framebuffer Creation FAIL Unknown Error"),r.bindFramebuffer(r.FRAMEBUFFER,null),this.FBO=i}deleteFBO(){if(this.FBO){let e=this.gl;e.deleteFramebuffer(this.FBO.id),e.deleteTexture(this.FBO.tex)}}setBandwidth(e){this.bandwidthScale=e}setKernelWeightScale(e){this.kernel_weightScale=e}setColormap(e,t=0){self=this;let r=this.gl,o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),t<=0&&(t=1024),e||(e=ll);var a=new Uint8Array(t*4);for(let i=0;i<t;i++){let s=i/(t-1),l=ft(e(s));a[i*4+0]=l.r,a[i*4+1]=l.g,a[i*4+2]=l.b,a[i*4+3]=.1}r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,1,0,r.RGBA,r.UNSIGNED_BYTE,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),this.LUT_TEX=o}setData(e){this.DATA=e,this.updateTheDatabuffer()}setWeights(e){this.kernel_weights=e,this.updateTheKernelWeightsBuffer()}update_span(){for(let e=0;e<this.DATA.length;e+=1)this.DATA[e][0],this.DATA[e][1]}updateTheDatabuffer(){let e=this.gl;this.positionsBuffer||(this.positionsBuffer=e.createBuffer(),this.positionsBuffer.itemSize=3),e.bindBuffer(e.ARRAY_BUFFER,this.positionsBuffer),e.bufferData(e.ARRAY_BUFFER,this.DATA,e.DYNAMIC_DRAW),this.positionsBuffer.numItems=this.DATA.length/3,this.update_span()}updateTheKernelWeightsBuffer(){let e=this.gl;this.kernelWeightsBuffer||(this.kernelWeightsBuffer=e.createBuffer(),this.kernelWeightsBuffer.itemSize=1),e.bindBuffer(e.ARRAY_BUFFER,this.kernelWeightsBuffer),e.bufferData(e.ARRAY_BUFFER,this.kernel_weights,e.DYNAMIC_DRAW),this.kernelWeightsBuffer.numItems=this.kernel_weights.length}qualityScale(e){return e===void 0?this.quality_scale:(this.quality_scale!=e&&(this.quality_scale=e,this.resize(0,0,!0)),this)}divergingColormap(e){return e===void 0?this._divergingColormap:(this._divergingColormap!=e&&(this._divergingColormap=e,console.log("DIVERGING COLORMAP",e)),this)}cleanup(){let e=this.gl;e.deleteBuffer(this.positionsBuffer),e.deleteBuffer(this.kernelWeightsBuffer),e.deleteTexture(this.LUT_TEX),e.deleteProgram(this.program),e.deleteFramebuffer(this.framebuffer),e.deleteRenderbuffer(this.renderbuffer),e.deleteTexture(this.texture),e.deleteVertexArray(this.vao),this.positionsBuffer=null,this.kernelWeightsBuffer=null,this.LUT_TEX=null,this.program=null,this.framebuffer=null,this.renderbuffer=null,this.texture=null,this.vao=null,this.DATA=null,this.kernel_weights=null,this.BUFFER_LIST=null,this.gl=null}}function vl(n,e=t=>t.key){var t=[];return Kt(n,"",!0,r=>t.push(r),e),t.join("")}function Kt(n,e,t,r,o){if(n){r(`${e}${t?"└── ":"├── "}${o(n)}
`);const a=e+(t?"    ":"│   ");n.left&&Kt(n.left,a,!1,r,o),n.right&&Kt(n.right,a,!0,r,o)}}function $t(n){if(n===null)return!0;var e=yt(n.left),t=yt(n.right);return!!(Math.abs(e-t)<=1&&$t(n.left)&&$t(n.right))}function yt(n){return n?1+Math.max(yt(n.left),yt(n.right)):0}function Jt(n,e,t,r,o){const a=o-r;if(a>0){const i=r+Math.floor(a/2),s=e[i],l=t[i],u={key:s,data:l,parent:n};return u.left=Jt(u,e,t,r,i),u.right=Jt(u,e,t,i+1,o),u}return null}function en(n){if(n===null)return 0;const e=en(n.left),t=en(n.right);return n.balanceFactor=e-t,Math.max(e,t)+1}function tn(n,e,t,r,o){if(t>=r)return;const a=n[t+r>>1];let i=t-1,s=r+1;for(;;){do i++;while(o(n[i],a)<0);do s--;while(o(n[s],a)>0);if(i>=s)break;let l=n[i];n[i]=n[s],n[s]=l,l=e[i],e[i]=e[s],e[s]=l}tn(n,e,t,s,o),tn(n,e,s+1,r,o)}function pl(n,e){return n>e?1:n<e?-1:0}function nt(n){var e=n.right;return n.right=e.left,e.left&&(e.left.parent=n),e.parent=n.parent,e.parent&&(e.parent.left===n?e.parent.left=e:e.parent.right=e),n.parent=e,e.left=n,n.balanceFactor+=1,e.balanceFactor<0&&(n.balanceFactor-=e.balanceFactor),e.balanceFactor+=1,n.balanceFactor>0&&(e.balanceFactor+=n.balanceFactor),e}function rt(n){var e=n.left;return n.left=e.right,n.left&&(n.left.parent=n),e.parent=n.parent,e.parent&&(e.parent.left===n?e.parent.left=e:e.parent.right=e),n.parent=e,e.right=n,n.balanceFactor-=1,e.balanceFactor>0&&(n.balanceFactor-=e.balanceFactor),e.balanceFactor-=1,n.balanceFactor<0&&(e.balanceFactor+=n.balanceFactor),e}class bt{constructor(e,t=!1){this._comparator=e||pl,this._root=null,this._size=0,this._noDuplicates=!!t}destroy(){return this.clear()}clear(){return this._root=null,this._size=0,this}get size(){return this._size}contains(e){if(this._root)for(var t=this._root,r=this._comparator;t;){var o=r(e,t.key);if(o===0)return!0;o<0?t=t.left:t=t.right}return!1}next(e){var t=e;if(t)if(t.right)for(t=t.right;t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t}prev(e){var t=e;if(t)if(t.left)for(t=t.left;t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t}forEach(e){for(var t=this._root,r=[],o=!1,a=0;!o;)t?(r.push(t),t=t.left):r.length>0?(t=r.pop(),e(t,a++),t=t.right):o=!0;return this}range(e,t,r,o){const a=[],i=this._comparator;let s=this._root,l;for(;a.length!==0||s;)if(s)a.push(s),s=s.left;else{if(s=a.pop(),l=i(s.key,t),l>0)break;if(i(s.key,e)>=0&&r.call(o,s))return this;s=s.right}return this}keys(){for(var e=this._root,t=[],r=[],o=!1;!o;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.key),e=e.right):o=!0;return r}values(){for(var e=this._root,t=[],r=[],o=!1;!o;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.data),e=e.right):o=!0;return r}at(e){for(var t=this._root,r=[],o=!1,a=0;!o;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),a===e)return t;a++,t=t.right}else o=!0;return null}minNode(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e}maxNode(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e}min(){var e=this._root;if(!e)return null;for(;e.left;)e=e.left;return e.key}max(){var e=this._root;if(!e)return null;for(;e.right;)e=e.right;return e.key}isEmpty(){return!this._root}pop(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t}popMax(){var e=this._root,t=null;if(e){for(;e.right;)e=e.right;t={key:e.key,data:e.data},this.remove(e.key)}return t}find(e){for(var t=this._root,r=t,o,a=this._comparator;r;){if(o=a(e,r.key),o===0)return r;o<0?r=r.left:r=r.right}return null}insert(e,t){if(!this._root)return this._root={parent:null,left:null,right:null,balanceFactor:0,key:e,data:t},this._size++,this._root;var r=this._comparator,o=this._root,a=null,i=0;if(this._noDuplicates)for(;o;){if(i=r(e,o.key),a=o,i===0)return null;i<0?o=o.left:o=o.right}else for(;o;)i=r(e,o.key),a=o,i<=0?o=o.left:o=o.right;var s={left:null,right:null,balanceFactor:0,parent:a,key:e,data:t},l;for(i<=0?a.left=s:a.right=s;a&&(i=r(a.key,e),i<0?a.balanceFactor-=1:a.balanceFactor+=1,a.balanceFactor!==0);){if(a.balanceFactor<-1){a.right.balanceFactor===1&&rt(a.right),l=nt(a),a===this._root&&(this._root=l);break}else if(a.balanceFactor>1){a.left.balanceFactor===-1&&nt(a.left),l=rt(a),a===this._root&&(this._root=l);break}a=a.parent}return this._size++,s}remove(e){if(!this._root)return null;for(var t=this._root,r=this._comparator,o=0;t&&(o=r(e,t.key),o!==0);)o<0?t=t.left:t=t.right;if(!t)return null;var a=t.key,i,s;if(t.left){for(i=t.left;i.left||i.right;){for(;i.right;)i=i.right;t.key=i.key,t.data=i.data,i.left&&(t=i,i=i.left)}t.key=i.key,t.data=i.data,t=i}if(t.right){for(s=t.right;s.left||s.right;){for(;s.left;)s=s.left;t.key=s.key,t.data=s.data,s.right&&(t=s,s=s.right)}t.key=s.key,t.data=s.data,t=s}for(var l=t.parent,u=t,h;l&&(l.left===u?l.balanceFactor-=1:l.balanceFactor+=1,l.balanceFactor<-1?(l.right.balanceFactor===1&&rt(l.right),h=nt(l),l===this._root&&(this._root=h),l=h):l.balanceFactor>1&&(l.left.balanceFactor===-1&&nt(l.left),h=rt(l),l===this._root&&(this._root=h),l=h),!(l.balanceFactor===-1||l.balanceFactor===1));)u=l,l=l.parent;return t.parent&&(t.parent.left===t?t.parent.left=null:t.parent.right=null),t===this._root&&(this._root=null),this._size--,a}load(e=[],t=[],r){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const o=e.length;return r&&tn(e,t,0,o-1,this._comparator),this._root=Jt(null,e,t,0,o),en(this._root),this._size=o,this}isBalanced(){return $t(this._root)}toString(e){return vl(this._root,e)}}bt.default=bt;class Al{constructor(e=!0){this.map=new Map,this.ascending=e,this.ascending?this.tree=new bt((t,r)=>t.key===r.key?0:t.value===r.value?t.key<r.key?-1:1:t.value-r.value):this.tree=new bt((t,r)=>t.key===r.key?0:t.value===r.value?t.key<r.key?-1:1:r.value-t.value)}set(e,t){if(this.map.has(e)){const r=this.map.get(e);this.tree.remove({key:e,value:r})}this.map.set(e,t),this.tree.insert({key:e,value:t})}delete(e){if(this.map.has(e)){const t=this.map.get(e);this.map.delete(e),this.tree.remove({key:e,value:t})}}get(e){return this.map.get(e)}getSortedKeys(){return this.tree.keys().map(e=>e.key)}getSortedPairs(){return this.tree.keys().map(e=>[e.key,e.value])}}let yl=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function bl(n,e=250){let t=!1;return(...r)=>{t||(n(...r),t=!0,setTimeout(()=>{t=!1},e))}}class _l{constructor({element:e=null,elementID:t=null,density:r=!1,nodes:o={},edges:a=[],use2D:i=!1,orthographic:s=!1,hyperbolic:l=!1,fastEdges:u=!1,tracking:h=!0,fieldOfView:c=70,forceSupersample:f=!1,autoStartLayout:d=!0,autoCleanup:v=!0,webglOptions:g={}}){if(this.element=null,e==null?this.element=document.getElementById(t):this.element=e,this.element.innerHTML="",getComputedStyle(this.element).position==="static"&&(this.container.style.position="relative"),this.canvasElement=document.createElement("canvas"),this.canvasElement.style.position="absolute",this.canvasElement.style.width="100%",this.canvasElement.style.height="100%",this.canvasElement.style.display="block",this.canvasElement.style.boxSizing="border-box",this.element.appendChild(this.canvasElement),this.svgLayer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgLayer.style.position="absolute",this.svgLayer.style.width="100%",this.svgLayer.style.height="100%",this.svgLayer.style.display="block",this.svgLayer.style.boxSizing="border-box",this.svgLayer.style.pointerEvents="none",this.element.appendChild(this.svgLayer),this.overlay=document.createElement("div"),this.overlay.style.position="absolute",this.overlay.style.width="100%",this.overlay.style.height="100%",this.overlay.style.display="block",this.overlay.style.boxSizing="border-box",this.overlay.style.pointerEvents="none",this.element.appendChild(this.overlay),this.network=new Es(o,a),this._autoCleanup=v,this._hasCleanup=!1,this.rotationMatrix=Se(),this.translatePosition=lt(),this.lastTranslatePosition=lt(),this.targetTranslatePosition=lt(),this.lastPanX=0,this.lastPanY=0,this.panX=0,this.panY=0,this._fieldOfView=c,this.targetPanX=0,this.targetPanY=0,this.translateTime=0,this.translateDuration=0,this.mouseDown=!1,this.lastMouseX=null,this.lastMouseY=null,this.redrawingFromMouseWheelEvent=!1,this.fastEdges=u,this.animate=!1,this.useShadedNodes=!1,this.forceSupersample=f,this.cameraDistance=500,this.interacting=!1,this.rotateLinearX=0,this.rotateLinearY=0,this.saveResolutionRatio=1,this.pickingResolutionRatio=.25,this._trackingMaxPixels=2e4,this._trackingBufferEnabled=h,this._trackingBuffer=null,this._trackingBufferTexture=null,this._trackingBufferPixels=null,this._attributeTrackers={},this._trackingNodeDataMinimumUpdateInterval=200,this._trackingNodeMinimumUpdateInterval=1e3/30,this._updateTrackerNodesDataThrottle=bl(()=>{this._updateTrackerNodesData()},this._trackingNodeDataMinimumUpdateInterval),this._lastCanvasDimensions=[this.canvasElement.clientWidth,this.canvasElement.clientHeight],this._zoomFactor=1,this._semanticZoomExponent=.25,this._nodesGlobalOpacityScale=1,this._nodesGlobalOpacityBase=0,this._nodesGlobalSizeScale=1,this._nodesGlobalSizeBase=0,this._edgesGlobalOpacityScale=1,this._edgesGlobalOpacityBase=0,this._edgesGlobalWidthScale=.25,this._edgesGlobalWidthBase=0,this._nodesGlobalOutlineWidthScale=1,this._nodesGlobalOutlineWidthBase=0,this._edgesColorsFromNodes=!0,this._edgesWidthFromNodes=!0,this._backgroundColor=[.5,.5,.5,1],this._use2D=i||l,this._orthographic=s||i,this._hyperbolic=l,this._autoStartLayout=d,this.useAdditiveBlending=!1,this._pickeableEdges=new Set,this.scheduler=new ks(this,{throttle:!1}),this._webglOptions=g,this._use2D)for(let p=0;p<this.network.positions.length;p++)this.network.positions[p*3+2]=0;this._edgeIndicesUpdate=!0,Nt(this.rotationMatrix),this.gl=ds(this.canvasElement,this._webglOptions),r&&(this.densityMap=new ml(this.gl,this.canvasElement.clientWidth,this.canvasElement.clientHeight),this.densityMap.setBandwidth(10),this.densityMap.setKernelWeightScale(.01),this.densityPlot=!0),this._centerNodes=[],this._centerNodesTransition=null,this.onNodeClickCallback=null,this.onNodeDoubleClickCallback=null,this.onNodeHoverStartCallback=null,this.onNodeHoverMoveCallback=null,this.onNodeHoverEndCallback=null,this.onEdgeClickCallback=null,this.onEdgeDoubleClickCallback=null,this.onEdgeHoverStartCallback=null,this.onEdgeHoverMoveCallback=null,this.onEdgeHoverEndCallback=null,this.onZoomCallback=null,this.onRotationCallback=null,this.onResizeCallback=null,this.onLayoutStartCallback=null,this.onLayoutStopCallback=null,this.onDrawCallback=null,this.onReadyCallback=null,this.isReady=!1,this._onresizeEvent=p=>{for(let _ of p)this._willResizeEvent(_)},this.resizeObserver=new ResizeObserver(this._onresizeEvent),this.resizeObserver.observe(this.canvasElement),this._initialize()}_initialize(){var e;this._setupDensity(),this._setupShaders(),this._buildNodesGeometry(),this._buildPickingBuffers(),this._buildTrackingBuffers(),this._buildEdgesGeometry(),this._willResizeEvent(0),this._setupCamera(),this._setupEvents(),this._setupLayout(),this.scheduler.start(),(e=this.onReadyCallback)==null||e.call(this,this),this.onReadyCallback=null,this.isReady=!0}_setupLayout(){this._layoutLastUpdate=null,this._alpha=.001,this.newPositions=this.network.positions.slice(0);let e=o=>{this.newPositions=o.positions,this._layoutLastUpdate||(this._layoutLastUpdate=performance.now());let a=performance.now()-this._layoutLastUpdate;a<200?a=200:a>2500&&(a=2500),this._alpha=1/a;let i={name:"1.1.positionInterpolator",callback:(s,l)=>{let u=0;const h=this._alpha,c=this.network.positions.length,f=this.newPositions,d=this.network.positions;for(let v=0;v<c;v++){const g=f[v]-d[v];d[v]+=h*g*s,u=Math.max(Math.abs(g),u)}this._updateCenterNodesPosition(),this._updateCameraInterpolation(!0),u<1&&this.scheduler.unschedule("1.1.positionInterpolator")},delay:0,repeat:!0,synchronized:!0,immediateUpdates:!1,redraw:!0,updateNodesGeometry:!0,updateEdgesGeometry:!0};this.scheduler.schedule({name:"1.0.positionChange",callback:(s,l)=>{this.scheduler.schedule(i)},delay:0,repeat:!1,synchronized:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})},t=()=>{var o;(o=this.onLayoutStopCallback)==null||o.call(this)},r=()=>{var o;this._layoutLastUpdate=null,(o=this.onLayoutStartCallback)==null||o.call(this)};this.layoutWorker=new Rs({network:this.network,onUpdate:e,onStop:t,onStart:r,use2D:this._use2D}),this._autoStartLayout&&this.layoutWorker.start()}_setupDensity(){if(this.densityMap){this.densityWeights=new Float32Array(this.network.nodeCount);let e=1;for(let t=0;t<this.network.nodeCount;t++){let r=this.network.nodes[t].edges.length;this.densityWeights[t]=r,e=Math.max(e,r)}for(let t=0;t<this.network.nodeCount;t++)this.densityWeights[t]/=e}}pauseLayout(){return this.layoutWorker.pause(),this}resumeLayout(){return this.layoutWorker.resume(),this}_callEventFromPickID(e,t,r){var i,s,l,u,h,c,f,d,v,g;let o=null,a=!0;if(e>=0){if(e<this.network.nodeCount)a=!0,o=this.network.index2Node[e];else if(e>=this.network.nodeCount){let p=e-this.network.nodeCount;if(p<this.network.indexedEdges.length/2){let _={source:this.network.index2Node[this.network.indexedEdges[2*p]],target:this.network.index2Node[this.network.indexedEdges[2*p+1]],index:p};a=!1,o=_}}}if(o)switch(t){case"click":{a?(i=this.onNodeClickCallback)==null||i.call(this,o,r):(s=this.onEdgeClickCallback)==null||s.call(this,o,r);break}case"doubleClick":{a?(l=this.onNodeDoubleClickCallback)==null||l.call(this,o,r):(u=this.onEdgeDoubleClickCallback)==null||u.call(this,o,r);break}case"hoverStart":{a?(h=this.onNodeHoverStartCallback)==null||h.call(this,o,r):(c=this.onEdgeHoverStartCallback)==null||c.call(this,o,r);break}case"hoverMove":{a?(f=this.onNodeHoverMoveCallback)==null||f.call(this,o,r):(d=this.onEdgeHoverMoveCallback)==null||d.call(this,o,r);break}case"hoverEnd":{a?(v=this.onNodeHoverEndCallback)==null||v.call(this,o,r):(g=this.onEdgeHoverEndCallback)==null||g.call(this,o,r);break}}}_setupEvents(){this.lastMouseX=-1,this.lastMouseY=-1,this.currentHoverIndex=-1,this._autoCleanup&&(this._mutationObserver=new MutationObserver(e=>{for(let t=0;t<e.length;t++){let r=e[t];if(r.type=="childList"&&r.removedNodes.length>0)for(let o=0;o<r.removedNodes.length;o++){let a=r.removedNodes[o];if(a==this.canvasElement||a==this.element){this._mutationObserver.disconnect(),this.cleanup();return}}}}),this._mutationObserver.observe(this.element,{childList:!0}),this._mutationObserver.observe(this.element.parentNode,{childList:!0})),this._clickEventListener=e=>{var o,a;const t=this.canvasElement.getBoundingClientRect();this.lastMouseX=e.clientX,this.lastMouseY=e.clientY;const r=this.pickPoint(this.lastMouseX-t.left,this.lastMouseY-t.top);r>=0?this._callEventFromPickID(r,"click",e):((o=this.onNodeClickCallback)==null||o.call(this,null,e),(a=this.onEdgeClickCallback)==null||a.call(this,null,e))},this._doubleClickEventListener=e=>{var o,a;const t=this.canvasElement.getBoundingClientRect();this.lastMouseX=e.clientX,this.lastMouseY=e.clientY;const r=this.pickPoint(this.lastMouseX-t.left,this.lastMouseY-t.top);r>=0?this._callEventFromPickID(r,"doubleClick",e):((o=this.onNodeDoubleClickCallback)==null||o.call(this,null,e),(a=this.onEdgeDoubleClickCallback)==null||a.call(this,null,e))},this._hoverMoveEventListener=e=>{this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,this.triggerHoverEvents(e)},this._hoverLeaveEventListener=e=>{this.currentHoverIndex>=0&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1,this.lastMouseX=-1,this.lastMouseY=-1)},this._hoverLeaveWindowEventListener=e=>{!e.relatedTarget&&!e.toElement&&this.currentHoverIndex>=0&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1,this.lastMouseX=-1,this.lastMouseY=-1)},this.canvasElement.addEventListener("click",this._clickEventListener),this.canvasElement.addEventListener("dblclick",this._doubleClickEventListener),this.canvasElement.addEventListener("mousemove",this._hoverMoveEventListener),this.canvasElement.addEventListener("mouseleave",this._hoverLeaveEventListener),document.body.addEventListener("mouseout",this._hoverLeaveWindowEventListener)}async _downloadImageData(e,t,r,o=1){let a=new Zt({}),i=document.createElement("canvas"),s=document.createElement("canvas"),l=i.getContext("2d"),u=s.getContext("2d");s.width=e.width,s.height=e.height,console.log(e.width,e.height,r,o),i.width=e.width/r,i.height=e.height/r,l.imageSmoothingEnabled=!0,u.imageSmoothingEnabled=!0,typeof l.imageSmoothingQuality<"u"&&(l.imageSmoothingQuality="high"),typeof u.imageSmoothingQuality<"u"&&(u.imageSmoothingQuality="high"),u.putImageData(e,0,0),u.transform(1,0,0,-1,0,s.height),u.globalCompositeOperation="copy",u.drawImage(u.canvas,0,0),u.globalCompositeOperation="source-over",await a.resize(s,i,{alpha:!0});let h=document.createElement("a");yl&&i.toDataURL(),h.setAttribute("download",t);let c=await a.toBlob(i,"image/png");if(c)if(t.endsWith("svg")){let f=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  width="${i.width/o}" height="${i.height/o}" viewBox="0 0 ${i.width/o} ${i.height/o}" ><image width="${i.width/o}" height="${i.height/o}" xlink:href="${i.toDataURL()}" />`,d=this.svgLayer.innerHTML;f+=d,f+="</svg>",h.setAttribute("download",t);let v=new Blob([f],{type:"image/svg+xml"}),g=URL.createObjectURL(v);h.setAttribute("href",g),h.click()}else{let f=URL.createObjectURL(c);h.setAttribute("href",f),h.click()}else window.alert("An error occured while trying to download the image. Please try again. (Error: blob is null.)")}_framebufferImage(e){const t=e.size.width,r=e.size.height,o=new Uint8ClampedArray(4*t*r),a=this.gl;return a.bindFramebuffer(a.FRAMEBUFFER,e),a.readPixels(0,0,t,r,a.RGBA,a.UNSIGNED_BYTE,o),new ImageData(o,t,r)}exportFigure(e,{scale:t,supersampleFactor:r,width:o=null,height:a=null,backgroundColor:i=null}){typeof t>"u"&&(t=1),typeof r>"u"&&(r=2);let s=this._createOffscreenFramebuffer();o==null&&a==null?(o=this.canvasElement.clientWidth,a=this.canvasElement.clientHeight):o?a||(a=Math.round(o*this.canvasElement.height/this.canvasElement.width)):o=Math.round(a*this.canvasElement.width/this.canvasElement.height),i||(i=this.backgroundColor),s.setSize(o*t*r,a*t*r),s.backgroundColor=i,this._redrawAll(s);let l=this._framebufferImage(s);this._downloadImageData(l,e,r,t),s.discard()}triggerHoverEvents(e,t){if(!this.isReady||this.lastMouseX==-1||this.lastMouseY==-1)return;let r=-1;if(!this.interacting){const o=this.canvasElement.getBoundingClientRect();r=this.pickPoint(this.lastMouseX-o.left,this.lastMouseY-o.top)}r>=0&&this.currentHoverIndex==-1?(this.currentHoverIndex=r,this._callEventFromPickID(r,"hoverStart",e)):r>=0&&this.currentHoverIndex==r?this._callEventFromPickID(r,"hoverMove",e):r>=0&&this.currentHoverIndex!=r?(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=r,this._callEventFromPickID(r,"hoverStart",e)):r==-1&&this.currentHoverIndex!=r&&(this._callEventFromPickID(this.currentHoverIndex,"hoverEnd",e),this.currentHoverIndex=-1)}_setupShaders(){const e=this.gl;this.edgesShaderProgram=new Ce($(e,this._hyperbolic?Nn:zn,e.VERTEX_SHADER),$(e,Fs,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","nearFar","globalOpacityScale","globalWidthScale","globalSizeScale","globalOpacityBase","globalWidthBase","globalSizeBase"],["fromVertex","toVertex","vertexType","fromColor","toColor","fromSize","toSize","encodedIndex"],this.gl),this.edgesFastShaderProgram=new Ce($(e,this._hyperbolic?Ps:Ss,e.VERTEX_SHADER),$(e,zs,e.FRAGMENT_SHADER),["projectionViewMatrix","nearFar","globalOpacityScale","globalOpacityBase"],["vertex","color"],this.gl),this.edgesPickingShaderProgram=new Ce($(e,this._hyperbolic?Nn:zn,e.VERTEX_SHADER),$(e,Ts,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","nearFar","globalOpacityScale","globalWidthScale","globalSizeScale","globalOpacityBase","globalWidthBase","globalSizeBase"],["fromVertex","toVertex","vertexType","fromColor","toColor","fromSize","toSize","encodedIndex"],this.gl),this.nodesShaderProgram=new Ce($(e,this._hyperbolic?Ut:Dt,e.VERTEX_SHADER),$(e,Ns,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl),this.nodesFastShaderProgram=new Ce($(e,this._hyperbolic?Ut:Dt,e.VERTEX_SHADER),$(e,Ds,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl),this.nodesPickingShaderProgram=new Ce($(e,this._hyperbolic?Ut:Dt,e.VERTEX_SHADER),$(e,Os,e.FRAGMENT_SHADER),["viewMatrix","projectionMatrix","normalMatrix","globalOpacityScale","globalSizeScale","globalOutlineWidthScale","globalOpacityBase","globalSizeBase","globalOutlineWidthBase"],["vertex","position","color","size","outlineWidth","outlineColor","encodedIndex"],this.gl)}_buildPickingBuffers(){this.gl,this.pickingFramebuffer=this._createOffscreenFramebuffer()}_buildTrackingBuffers(){this.gl,this._trackingBufferEnabled&&(this._trackingFramebuffer=this._createOffscreenFramebuffer())}_createOffscreenFramebuffer(){const e=this.gl;let t=e.createFramebuffer();t.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t.depthBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.bindFramebuffer(e.FRAMEBUFFER,t),t.size={width:0,height:0},t.setSize=(a,i)=>{e.bindTexture(e.TEXTURE_2D,t.texture);const s=0,l=e.RGBA,u=0,h=e.RGBA,c=e.UNSIGNED_BYTE,f=null,d=a,v=i;e.texImage2D(e.TEXTURE_2D,s,l,d,v,u,h,c,f),e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,d,v),t.size.width=a,t.size.height=i},t.discard=()=>{e.deleteRenderbuffer(t.depthBuffer),e.deleteTexture(t.texture),e.deleteFramebuffer(t)};const r=e.COLOR_ATTACHMENT0,o=0;return e.framebufferTexture2D(e.FRAMEBUFFER,r,e.TEXTURE_2D,t.texture,o),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer),t}_buildNodesGeometry(){const e=this.gl;this.nodesGeometry=br(e,!1,!1),this.nodesPositionBuffer=e.createBuffer(),this.nodesColorBuffer=e.createBuffer(),this.nodesSizeBuffer=e.createBuffer(),this.nodesOutlineWidthBuffer=e.createBuffer(),this.nodesOutlineColorBuffer=e.createBuffer(),this.nodesIndexBuffer=e.createBuffer(),this.nodesIndexArray=new Float32Array(this.network.index2Node.length*4);for(let t=0;t<this.network.index2Node.length;t++)this.nodesIndexArray[4*t]=(t+1>>0&255)/255,this.nodesIndexArray[4*t+1]=(t+1>>8&255)/255,this.nodesIndexArray[4*t+2]=(t+1>>16&255)/255,this.nodesIndexArray[4*t+3]=(t+1>>24&255)/255;e.bindBuffer(e.ARRAY_BUFFER,this.nodesIndexBuffer),e.bufferData(e.ARRAY_BUFFER,this.nodesIndexArray,e.STATIC_DRAW),this.updateNodesGeometry()}updateDensityMap(){var t,r;let e=this.network.positions;return(t=this.densityMap)==null||t.setData(e),(r=this.densityMap)==null||r.setWeights(this.densityWeights),this}updateNodesGeometry(){const e=this.gl;let t=this.network.positions;this.updateDensityMap(),e.bindBuffer(e.ARRAY_BUFFER,this.nodesPositionBuffer),e.bufferData(e.ARRAY_BUFFER,t,e.DYNAMIC_DRAW);let r=this.network.colors;e.bindBuffer(e.ARRAY_BUFFER,this.nodesColorBuffer),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);let o=this.network.sizes;e.bindBuffer(e.ARRAY_BUFFER,this.nodesSizeBuffer),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW);let a=this.network.outlineWidths;e.bindBuffer(e.ARRAY_BUFFER,this.nodesOutlineWidthBuffer),e.bufferData(e.ARRAY_BUFFER,a,e.STATIC_DRAW);let i=this.network.outlineColors;return e.bindBuffer(e.ARRAY_BUFFER,this.nodesOutlineColorBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this}_buildFastEdgesGeometry(){const e=this.gl;let t=this.network.indexedEdges,r=this.network.positions;this.network.colors;let o;this.fastEdgesGeometry=null,this.fastEdgesIndicesArray=null;let a=new Object;if(r.length<65535)o=new Uint16Array(t),a.indexType=e.UNSIGNED_SHORT;else{var i=e.getExtension("OES_element_index_uint");i==null?(o=new Uint16Array(t),a.indexType=e.UNSIGNED_SHORT):(o=new Uint32Array(t),a.indexType=e.UNSIGNED_INT)}a.vertexObject=e.createBuffer(),a.colorObject=e.createBuffer(),a.numIndices=o.length,a.indexObject=e.createBuffer(),this.fastEdgesGeometry=a,this.fastEdgesIndicesArray=o}_buildAdvancedEdgesGeometry(){const e=this.gl;let t=[0,1,0,0,1,1,1,0],r=new Object;r.edgeVertexTypeBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.edgeVertexTypeBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),r.verticesBuffer=e.createBuffer(),r.colorBuffer=e.createBuffer(),r.sizeBuffer=e.createBuffer(),r.indexBuffer=e.createBuffer(),this.edgesGeometry=r,this.edgesGeometry.count=this.network.indexedEdges.length/2,this.edgesGeometry.edgesIndexArray=new Float32Array(this.network.indexedEdges.length*4/2),this._edgeIndicesUpdate=!0}_buildEdgesGeometry(){this.fastEdges?this._buildFastEdgesGeometry():this._buildAdvancedEdgesGeometry(),this.updateEdgesGeometry()}_updateEdgeIndices(){if(this._edgeIndicesUpdate){const e=this.gl;for(let t=0;t<this.network.indexedEdges.length/2;t++){let r=this.network.index2Node.length+t;this._pickeableEdges.has(t)?(this.edgesGeometry.edgesIndexArray[4*t]=(r+1>>0&255)/255,this.edgesGeometry.edgesIndexArray[4*t+1]=(r+1>>8&255)/255,this.edgesGeometry.edgesIndexArray[4*t+2]=(r+1>>16&255)/255,this.edgesGeometry.edgesIndexArray[4*t+3]=(r+1>>24&255)/255):(this.edgesGeometry.edgesIndexArray[4*t]=0,this.edgesGeometry.edgesIndexArray[4*t+1]=0,this.edgesGeometry.edgesIndexArray[4*t+2]=0,this.edgesGeometry.edgesIndexArray[4*t+3]=0)}e.bindBuffer(e.ARRAY_BUFFER,this.edgesGeometry.indexBuffer),e.bufferData(e.ARRAY_BUFFER,this.edgesGeometry.edgesIndexArray,e.DYNAMIC_DRAW),this._edgeIndicesUpdate=!1}}updateEdgesGeometry(){const e=this.gl;this.network.indexedEdges;let t=this.network.positions,r=this.network.colors;if(this.fastEdges)this.fastEdgesGeometry||this._buildEdgesGeometry(),e.bindBuffer(e.ARRAY_BUFFER,this.fastEdgesGeometry.vertexObject),e.bufferData(e.ARRAY_BUFFER,t,e.STREAM_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.fastEdgesGeometry.colorObject),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.fastEdgesGeometry.indexObject),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.fastEdgesIndicesArray,e.STREAM_DRAW);else{const o=this.gl;this.network.updateEdgePositions(),this._edgesColorsFromNodes&&this.network.updateEdgeColors(),this._edgesWidthFromNodes&&this.network.updateEdgeSizes(),this._updateEdgeIndices(),this.network.positions,o.bindBuffer(o.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),o.bufferData(o.ARRAY_BUFFER,this.network.edgePositions,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.edgesGeometry.colorBuffer),o.bufferData(o.ARRAY_BUFFER,this.network.edgeColors,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this.edgesGeometry.sizeBuffer),o.bufferData(o.ARRAY_BUFFER,this.network.edgeSizes,o.DYNAMIC_DRAW)}return this}_resizeGL(e,t){this.canvasElement.width=e,this.canvasElement.height=t,this.pickingFramebuffer.setSize(Math.round(e*this.pickingResolutionRatio),Math.round(t*this.pickingResolutionRatio)),this._lastCanvasDimensions=[this.canvasElement.clientWidth,this.canvasElement.clientHeight];let r=e/t;if(this._trackingBufferEnabled){let o,a;r>1?(o=Math.sqrt(this._trackingMaxPixels*r),a=this._trackingMaxPixels/o):(a=Math.sqrt(this._trackingMaxPixels/r),o=this._trackingMaxPixels/a),this._trackingFramebuffer.setSize(Math.round(o),Math.round(a));let i=this._trackingFramebuffer.size.width*this._trackingFramebuffer.size.height;this._pixelXYOnScreen=Array(i),this._trackingBufferPixels=new Uint8Array(4*i),this._nodesOnScreen=Array(i),this._nodesOnScreen.fill(-1);for(let s=0;s<this._pixelXYOnScreen.length;s++){let l=s%this._trackingFramebuffer.size.width/this._trackingFramebuffer.size.width*this.canvasElement.clientWidth,u=Math.floor(s/this._trackingFramebuffer.size.width)/this._trackingFramebuffer.size.height*this.canvasElement.clientHeight;this._pixelXYOnScreen[s]=[l,u]}}return this.densityPlot&&this.densityMap.resize(e,t),this.render(!0),this}_setupCamera(){this.zoom=is().on("zoom",e=>{var a;this.interacting=!0,this._zoomFactor=e.transform.k,this.triggerHoverEvents(e),this.prevK===void 0&&(this.prevK=e.transform.k);let t=0,r=0;(this.prevK==e.transform.k||this._use2D)&&(this.prevX===void 0||this._use2D?this._use2D?(t=e.transform.x-this.canvasElement.clientWidth/2,r=e.transform.y-this.canvasElement.clientHeight/2):(t=e.transform.x,r=e.transform.y):(t=e.transform.x-this.prevX*this._zoomFactor,r=e.transform.y-this.prevY*this._zoomFactor)),this._use2D||(this.prevX=e.transform.x/this._zoomFactor,this.prevY=e.transform.y/this._zoomFactor),this.prevK=e.transform.k;let o=Se();if(this._use2D||(a=e.sourceEvent)!=null&&a.shiftKey){const i=this.canvasElement.clientHeight,s=Math.PI*2/360*this._fieldOfView,l=2*(this.cameraDistance/this._zoomFactor)*Math.tan(s/2)/i;this._centerNodes.length==0&&(this._use2D?(this.panX=t*l,this.panY=-r*l):(this.panX=this.panX+t*l,this.panY=this.panY-r*l))}else Nt(o),Fn(o,o,Tn(t/2),[0,1,0]),Fn(o,o,Tn(r/2),[1,0,0]),Ot(this.rotationMatrix,o,this.rotationMatrix);this.update(),this.render()}).on("end",e=>{this.interacting=!1}),Z(this.canvasElement).call(this.zoom).on("dblclick.zoom",null)}zoomFactor(e,t){return e!==void 0?(t===void 0?this._use2D?Z(this.canvasElement).call(this.zoom.transform,_e.translate(this.canvasElement.clientWidth/2,this.canvasElement.clientHeight/2).scale(e)):Z(this.canvasElement).call(this.zoom.transform,_e.translate(0,0).scale(e)):this._use2D?Z(this.canvasElement).transition().ease(cn).duration(t).call(this.zoom.transform,_e.translate(this.canvasElement.clientWidth/2,this.canvasElement.clientHeight/2).scale(e)):Z(this.canvasElement).transition().ease(cn).duration(t).call(this.zoom.transform,_e.translate(0,0).scale(e)),this):this._zoomFactor}semanticZoomExponent(e){return e!==void 0?(this._semanticZoomExponent=e,this):this._semanticZoomExponent}_willResizeEvent(e){var a;let t=window.devicePixelRatio||1;(t<2||this.forceSupersample)&&(t=t*2);let r=t*this.canvasElement.clientWidth,o=t*this.canvasElement.clientHeight;requestAnimationFrame(()=>{this._resizeGL(r,o)}),this._updateCameraInteraction(),(a=this.onResizeCallback)==null||a.call(this,e)}_updateCameraInteraction(){if(this.zoom&&this._use2D){const e=this.canvasElement.clientHeight,t=Math.PI*2/360*this._fieldOfView,r=2*(this.cameraDistance/this._zoomFactor)*Math.tan(t/2)/e;Z(this.canvasElement).property("__zoom",_e.translate(this.panX/r+this._lastCanvasDimensions[0]/2,-this.panY/r+this._lastCanvasDimensions[1]/2).scale(this._zoomFactor))}}redraw(){var e;return this._redrawAll(null,"normal"),this._redrawAll(this.pickingFramebuffer,"picking"),this._trackingBufferEnabled&&this._redrawAll(this._trackingFramebuffer,"tracking"),this.triggerHoverEvents(null),this._updateTrackerNodesDataThrottle(),(e=this.onDrawCallback)==null||e.call(this),this}update(e=!1,t=!0,r=!0){return this.scheduler.schedule({name:"9.0.update",callback:null,delay:0,repeat:!1,synchronized:!0,immediateUpdates:e,updateNodesGeometry:t,updateEdgesGeometry:r}),this}render(e=!1){return this.scheduler.schedule({name:"9.1.render",callback:null,delay:0,repeat:!1,synchronized:!0,immediateUpdates:e,redraw:!0}),this}_redrawPrepare(e,t,r){typeof t>"u"&&(t="normal");const o=this.gl,a=(e==null?void 0:e.size.width)||this.canvasElement.width,i=(e==null?void 0:e.size.height)||this.canvasElement.height;e==null?(o.bindFramebuffer(o.FRAMEBUFFER,null),o.clearColor(...this._backgroundColor)):t!="normal"?(o.bindFramebuffer(o.FRAMEBUFFER,e),o.clearColor(0,0,0,0)):(o.bindFramebuffer(o.FRAMEBUFFER,e),typeof e.backgroundColor>"u"?o.clearColor(...this._backgroundColor):o.clearColor(...e.backgroundColor)),typeof r>"u"?o.viewport(0,0,a,i):o.viewport(...r),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.depthFunc(o.LEQUAL),this.projectionMatrix=Se(),this.viewMatrix=Se(),this.projectionViewMatrix=Se();let s=Math.PI*2/360*this._fieldOfView,l=a/i;if(this._use2D||this._orthographic){const u=this.cameraDistance/this._zoomFactor,h=2*u*Math.tan(s/2),c=h*l,f=-c/2,d=c/2,v=-h/2,g=h/2;cs(this.projectionMatrix,f,d,v,g,-100+u,1e4+u)}else us(this.projectionMatrix,s,l,1,null);Nt(this.viewMatrix),Rn(this.viewMatrix,this.viewMatrix,[this.panX,this.panY,-this.cameraDistance/this._zoomFactor]),Ot(this.viewMatrix,this.viewMatrix,this.rotationMatrix),Rn(this.viewMatrix,this.viewMatrix,this.translatePosition),Ot(this.projectionViewMatrix,this.projectionMatrix,this.viewMatrix)}_redrawNodes(e,t){typeof t>"u"&&(t="normal");const r=this.gl;let o=r.getExtension("ANGLE_instanced_arrays"),a=1/Math.pow(this._zoomFactor,this._semanticZoomExponent);t!="normal"&&(a=1/Math.pow(this._zoomFactor,.75*this._semanticZoomExponent));let i;t=="normal"?(r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this.useShadedNodes?i=this.nodesShaderProgram:i=this.nodesFastShaderProgram):(r.disable(r.BLEND),i=this.nodesPickingShaderProgram),i.use(r),i.attributes.enable("vertex"),i.attributes.enable("position"),i.attributes.enable("size"),i.attributes.enable("outlineWidth"),i.attributes.enable("outlineColor"),i.attributes.enable("encodedIndex"),r.bindBuffer(r.ARRAY_BUFFER,this.nodesGeometry.vertexObject),r.vertexAttribPointer(i.attributes.vertex,3,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.vertex,0),this.nodesGeometry.indexObject&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.nodesGeometry.indexObject),r.uniformMatrix4fv(i.uniforms.projectionMatrix,!1,this.projectionMatrix),r.uniformMatrix4fv(i.uniforms.viewMatrix,!1,this.viewMatrix),r.uniform1f(i.uniforms.globalOpacityScale,this._nodesGlobalOpacityScale),r.uniform1f(i.uniforms.globalOpacityBase,this._nodesGlobalOpacityBase),r.uniform1f(i.uniforms.globalSizeScale,this._nodesGlobalSizeScale*a),r.uniform1f(i.uniforms.globalSizeBase,this._nodesGlobalSizeBase*a),r.uniform1f(i.uniforms.globalOutlineWidthScale,this._nodesGlobalOutlineWidthScale*a),r.uniform1f(i.uniforms.globalOutlineWidthBase,this._nodesGlobalOutlineWidthBase*a);let s=as();ss(s,this.viewMatrix),r.uniformMatrix3fv(i.uniforms.normalMatrix,!1,s),this.network.colors,this.network.positions,this.network.sizes,this.network.outlineWidths,r.bindBuffer(r.ARRAY_BUFFER,this.nodesPositionBuffer),r.enableVertexAttribArray(i.attributes.position),r.vertexAttribPointer(i.attributes.position,3,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.position,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesColorBuffer),r.enableVertexAttribArray(i.attributes.color),r.vertexAttribPointer(i.attributes.color,4,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.color,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesSizeBuffer),r.enableVertexAttribArray(i.attributes.size),r.vertexAttribPointer(i.attributes.size,1,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.size,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesOutlineColorBuffer),r.enableVertexAttribArray(i.attributes.outlineColor),r.vertexAttribPointer(i.attributes.outlineColor,4,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.outlineColor,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesOutlineWidthBuffer),r.enableVertexAttribArray(i.attributes.outlineWidth),r.vertexAttribPointer(i.attributes.outlineWidth,1,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.outlineWidth,1),r.bindBuffer(r.ARRAY_BUFFER,this.nodesIndexBuffer),r.enableVertexAttribArray(i.attributes.encodedIndex),r.vertexAttribPointer(i.attributes.encodedIndex,4,r.FLOAT,!1,0,0),o.vertexAttribDivisorANGLE(i.attributes.encodedIndex,1),this.nodesGeometry.indexObject?o.drawElementsInstancedANGLE(r.TRIANGLES,this.nodesGeometry.numIndices,this.nodesGeometry.indexType,0,this.network.positions.length/3):o.drawArraysInstancedANGLE(r.TRIANGLE_STRIP,0,this.nodesGeometry.numIndices,this.network.positions.length/3),i.attributes.disable("vertex"),i.attributes.disable("position"),i.attributes.disable("size"),i.attributes.disable("outlineWidth"),i.attributes.disable("outlineColor"),i.attributes.disable("encodedIndex")}_redrawEdges(e,t){typeof t>"u"&&(t="normal");let r=this.onEdgeClickCallback||this.onEdgeHoverMoveCallback||this.onEdgeHoverStartCallback||this.onEdgeHoverEndCallback||this.onEdgeDoubleClickCallback||this.onEdgeClickCallback;if(t!="normal"&&(this.fastEdges||!r))return;let o=1/Math.pow(this._zoomFactor,this._semanticZoomExponent);t!="normal"&&(o=1/Math.pow(this._zoomFactor,.5*this._semanticZoomExponent));const a=this.gl;let i=a.getExtension("ANGLE_instanced_arrays"),s;t=="normal"?(a.enable(a.BLEND),this.useAdditiveBlending?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE),this.fastEdges?s=this.edgesFastShaderProgram:s=this.edgesShaderProgram):(a.disable(a.BLEND),s=this.edgesPickingShaderProgram),this.fastEdges?(s.use(a),s.attributes.enable("vertex"),s.attributes.enable("color"),a.bindBuffer(a.ARRAY_BUFFER,this.fastEdgesGeometry.vertexObject),a.vertexAttribPointer(s.attributes.vertex,3,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(s.attributes.vertex,0),a.bindBuffer(a.ARRAY_BUFFER,this.fastEdgesGeometry.colorObject),a.vertexAttribPointer(s.attributes.color,4,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(s.attributes.color,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.fastEdgesGeometry.indexObject),a.uniformMatrix4fv(s.uniforms.projectionViewMatrix,!1,this.projectionViewMatrix),a.uniform1f(s.uniforms.globalOpacityScale,this._edgesGlobalOpacityScale),a.uniform1f(s.uniforms.globalOpacityBase,this._edgesGlobalOpacityBase),a.drawElements(a.LINES,this.fastEdgesGeometry.numIndices,this.fastEdgesGeometry.indexType,0),s.attributes.disable("vertex"),s.attributes.disable("color")):(s.use(a),s.attributes.enable("fromVertex"),s.attributes.enable("toVertex"),s.attributes.enable("vertexType"),s.attributes.enable("fromColor"),s.attributes.enable("toColor"),s.attributes.enable("fromSize"),s.attributes.enable("toSize"),s.attributes.enable("encodedIndex"),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.edgeVertexTypeBuffer),a.vertexAttribPointer(s.attributes.vertexType,2,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(s.attributes.vertexType,0),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),a.vertexAttribPointer(s.attributes.fromVertex,3,a.FLOAT,!1,4*3*2,0),i.vertexAttribDivisorANGLE(s.attributes.fromVertex,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.verticesBuffer),a.vertexAttribPointer(s.attributes.toVertex,3,a.FLOAT,!1,4*3*2,4*3),i.vertexAttribDivisorANGLE(s.attributes.toVertex,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.colorBuffer),a.vertexAttribPointer(s.attributes.fromColor,4,a.FLOAT,!1,4*4*2,0),i.vertexAttribDivisorANGLE(s.attributes.fromColor,1),a.vertexAttribPointer(s.attributes.toColor,4,a.FLOAT,!1,4*4*2,4*4),i.vertexAttribDivisorANGLE(s.attributes.toColor,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.sizeBuffer),a.vertexAttribPointer(s.attributes.fromSize,1,a.FLOAT,!1,4*2,0),i.vertexAttribDivisorANGLE(s.attributes.fromSize,1),a.vertexAttribPointer(s.attributes.toSize,1,a.FLOAT,!1,4*2,4),i.vertexAttribDivisorANGLE(s.attributes.toSize,1),a.bindBuffer(a.ARRAY_BUFFER,this.edgesGeometry.indexBuffer),a.enableVertexAttribArray(s.attributes.encodedIndex),a.vertexAttribPointer(s.attributes.encodedIndex,4,a.FLOAT,!1,0,0),i.vertexAttribDivisorANGLE(s.attributes.encodedIndex,1),a.uniformMatrix4fv(s.uniforms.projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(s.uniforms.viewMatrix,!1,this.viewMatrix),a.uniform1f(s.uniforms.globalOpacityScale,this._edgesGlobalOpacityScale),a.uniform1f(s.uniforms.globalOpacityBase,this._edgesGlobalOpacityBase),a.uniform1f(s.uniforms.globalWidthScale,this._edgesGlobalWidthScale),a.uniform1f(s.uniforms.globalWidthBase,this._edgesGlobalWidthBase),a.uniform1f(s.uniforms.globalSizeScale,this._nodesGlobalSizeScale*o),a.uniform1f(s.uniforms.globalSizeBase,this._nodesGlobalSizeBase*o),i.drawArraysInstancedANGLE(a.TRIANGLE_STRIP,0,4,this.edgesGeometry.count),s.attributes.disable("fromVertex"),s.attributes.disable("toVertex"),s.attributes.disable("vertexType"),s.attributes.disable("fromColor"),s.attributes.disable("toColor"),s.attributes.disable("fromSize"),s.attributes.disable("toSize"),s.attributes.disable("encodedIndex"))}_redrawAll(e,t){typeof t>"u"&&(t="normal");const r=this.gl;this._redrawPrepare(e,t),t=="normal"&&this.densityPlot&&(r.disable(this.gl.DEPTH_TEST),e!=null&&e.size.width||this.canvasElement.width,e!=null&&e.size.height||this.canvasElement.height,this.densityMap.drawScene(this.projectionMatrix,this.viewMatrix)),r.depthMask(!0),this._use2D?(r.disable(r.DEPTH_TEST),r.depthMask(!1),t!="tracking"&&this._edgesGlobalOpacityScale>0&&this._redrawEdges(e,t),this._redrawNodes(e,t)):(r.enable(r.DEPTH_TEST),this._redrawNodes(e,t),r.depthMask(!1),t!="tracking"&&this._edgesGlobalOpacityScale>0&&this._redrawEdges(e,t),r.depthMask(!0))}_updateCenterNodesPosition(){if(this.targetTranslatePosition[0]=0,this.targetTranslatePosition[1]=0,this.targetTranslatePosition[2]=0,this._centerNodes&&this._centerNodes.length>0){for(let t=0;t<this._centerNodes.length;t++){let r=this._centerNodes[t].position;this.targetTranslatePosition[0]-=r[0],this.targetTranslatePosition[1]-=r[1],this.targetTranslatePosition[2]-=r[2]}let e=this._centerNodes.length;this.targetTranslatePosition[0]/=e,this.targetTranslatePosition[1]/=e,this.targetTranslatePosition[2]/=e}}centerOnNodes(e,t){this._centerNodes=[];for(let r=0;r<e.length;r++){let o=e[r];o.ID===void 0&&(o=this.network.nodes[o]),this._centerNodes.push(o)}return this._updateCameraInteraction(),this.lastTranslatePosition[0]=this.translatePosition[0],this.lastTranslatePosition[1]=this.translatePosition[1],this.lastTranslatePosition[2]=this.translatePosition[2],this.lastPanX=this.panX,this.lastPanY=this.panY,t===void 0||t<=0?(this.translateDuration=0,this.translateStartTime=null):(this.translateDuration=t,this.translateStartTime=performance.now()),this._scheduleCameraInterpolation(),this}centeredNodes(){return this._centerNodes}_updateCameraInterpolation(e=!1){if(this.translateDuration==0)return e||(this.translatePosition[0]=this.targetTranslatePosition[0],this.translatePosition[1]=this.targetTranslatePosition[1],this.translatePosition[2]=this.targetTranslatePosition[2],this.panX=0,this.panY=0,this._use2D),!1;{let t=(performance.now()-this.translateStartTime)/this.translateDuration;return t>1&&(t=1),this.translatePosition[0]=(1-t)*this.lastTranslatePosition[0],this.translatePosition[1]=(1-t)*this.lastTranslatePosition[1],this.translatePosition[2]=(1-t)*this.lastTranslatePosition[2],this.translatePosition[0]+=t*this.targetTranslatePosition[0],this.translatePosition[1]+=t*this.targetTranslatePosition[1],this.translatePosition[2]+=t*this.targetTranslatePosition[2],this.panX=(1-t)*this.lastPanX,this.panY=(1-t)*this.lastPanY,this.panX+=t*this.targetPanX,this.panY+=t*this.targetPanY,this._use2D,!(t>=1)}}_scheduleCameraInterpolation(){let e={name:"1.1.cameraInterpolator",callback:(t,r)=>{this._updateCenterNodesPosition(),this._updateCameraInterpolation()||this.scheduler.unschedule("1.1.cameraInterpolator")},delay:0,repeat:!0,synchronized:!0,immediateUpdates:!1,redraw:!0,updateNodesGeometry:!1,updateEdgesGeometry:!1};this.scheduler.schedule({name:"1.0.cameraInterpolator",callback:(t,r)=>{this.scheduler.schedule(e)},delay:0,repeat:!1,synchronized:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})}onResize(e){return this.onResizeCallback=e,this}onNodeClick(e){return this.onNodeClickCallback=e,this}onNodeDoubleClick(e){return this.onNodeDoubleClickCallback=e,this}onNodeHoverStart(e){return this.onNodeHoverStartCallback=e,this}onNodeHoverEnd(e){return this.onNodeHoverEndCallback=e,this}onNodeHoverMove(e){return this.onNodeHoverMoveCallback=e,this}onEdgeClick(e){return this.onEdgeClickCallback=e,this}onEdgeDoubleClick(e){return this.onEdgeDoubleClickCallback=e,this}onEdgeHoverStart(e){return this.onEdgeHoverStartCallback=e,this}onEdgeHoverEnd(e){return this.onEdgeHoverEndCallback=e,this}onEdgeHoverMove(e){return this.onEdgeHoverMoveCallback=e,this}onZoom(e){return this.onZoomCallback=e,this}onRotation(e){return this.onRotationCallback=e,this}onLayoutStart(e){return this.onLayoutStartCallback=e,this==null||this.layoutWorker.onStart(()=>{var t;(t=this.onLayoutStartCallback)==null||t.call(this)}),this}onLayoutStop(e){return this.onLayoutStopCallback=e,this==null||this.layoutWorker.onStop(()=>{var t;(t=this.onLayoutStopCallback)==null||t.call(this)}),this}onDraw(e){return this.onDrawCallback=e,this}onReady(e){this.isReady?e==null||e(this):this.onReadyCallback=e}backgroundColor(e){return typeof e>"u"?this._backgroundColor:(this._backgroundColor=e,this)}nodeColor(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.colors;if(typeof e=="function"){let r=this.network.index2Node;for(let o=0;o<r.length;o++){let a=r[o],i=e(a,o,this.network);this.network.colors[o*4+0]=i[0],this.network.colors[o*4+1]=i[1],this.network.colors[o*4+2]=i[2],i.length>3&&(this.network.colors[o*4+3]=i[3])}}else{if(typeof e=="number")return this.network.colors[this.network.ID2index[e]];{let r=this.network.index2Node;for(let o=0;o<r.length;o++)this.network.colors[o*4+0]=e[0],this.network.colors[o*4+1]=e[1],this.network.colors[o*4+2]=e[2],e.length>3&&(this.network.colors[o*4+3]=e[3])}}}else if(typeof e=="function"){let r=this.network.ID2index[t],o=e(t,r,this.network);this.network.colors[r*4+0]=o[0],this.network.colors[r*4+1]=o[1],this.network.colors[r*4+2]=o[2],o.length>3&&(this.network.colors[r*4+3]=o[3])}else{let r=this.network.ID2index[t];this.network.colors[r*4+0]=e[0],this.network.colors[r*4+1]=e[1],this.network.colors[r*4+2]=e[2],e.length>3&&(this.network.colors[r*4+3]=e[3])}return this}nodeSize(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.sizes;if(typeof e=="function"){let r=this.network.index2Node;for(let o=0;o<r.length;o++){let a=r[o],i=e(a,this.network);this.network.sizes[o]=i}}else{let r=this.network.index2Node;for(let o=0;o<r.length;o++)this.network.sizes[o]=e}}else if(typeof e=="function"){let r=e(t,this.network),o=this.network.ID2index[t];this.network.sizes[o]=r}else{let r=this.network.ID2index[t];this.network.sizes[r]=e}return this}nodeOutlineColor(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.outlineColors;if(typeof e=="function"){let r=this.network.index2Node;for(let o=0;o<r.length;o++){let a=r[o],i=e(a,o,this.network);this.network.outlineColors[o*4+0]=i[0],this.network.outlineColors[o*4+1]=i[1],this.network.outlineColors[o*4+2]=i[2],i.length>3&&(this.network.outlineColors[o*4+3]=i[3])}}else{if(typeof e=="number")return this.network.outlineColors[this.network.ID2index[e]];{let r=this.network.index2Node;for(let o=0;o<r.length;o++)this.network.outlineColors[o*4+0]=e[0],this.network.outlineColors[o*4+1]=e[1],this.network.outlineColors[o*4+2]=e[2],e.length>3&&(this.network.outlineColors[o*4+3]=e[3])}}}else if(typeof e=="function"){let r=this.network.ID2index[t],o=e(t,r,this.network);this.network.outlineColors[r*4+0]=o[0],this.network.outlineColors[r*4+1]=o[1],this.network.outlineColors[r*4+2]=o[2],o.length>3&&(this.network.outlineColors[r*4+3]=o[3])}else{let r=this.network.ID2index[t];this.network.outlineColors[r*4+0]=e[0],this.network.outlineColors[r*4+1]=e[1],this.network.outlineColors[r*4+2]=e[2],e.length>3&&(this.network.outlineColors[r*4+3]=e[3])}return this}nodeOutlineWidth(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.outlineWidths;if(typeof e=="function"){let r=this.network.index2Node;for(let o=0;o<r.length;o++){let a=r[o],i=e(a,this.network);this.network.outlineWidths[a.index]=i}}else{let r=this.network.index2Node;for(let o=0;o<r.length;o++)this.network.outlineWidths[o]=e}}else if(typeof e=="function"){let r=e(t,this.network),o=this.network.ID2index[t];this.network.outlineWidths[o]=r}else{let r=this.network.ID2index[t];this.network.outlineWidths[r]=e}return this}edgeColor(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.edgeColors;if(typeof e=="function"){let r=this.network.index2Node,o=this.network.indexedEdges;for(let a=0;a<o.length/2;a++){let i=r[o[a*2]],s=r[o[a*2+1]],l=e(a,i,s,this.network);l.length==2?(this.network.edgeColors[a*2*4+0]=l[0][0],this.network.edgeColors[a*2*4+1]=l[0][1],this.network.edgeColors[a*2*4+2]=l[0][2],this.network.edgeColors[(a*2+1)*4+0]=l[1][0],this.network.edgeColors[(a*2+1)*4+1]=l[1][1],this.network.edgeColors[(a*2+1)*4+2]=l[1][2],l[0].length>3&&(this.network.edgeColors[(a*2+1)*4+3]=l[0][3]),l[1].length>3&&(this.network.edgeColors[(a*2+1)*4+3]=l[1][3])):(this.network.edgeColors[a*2*4+0]=l[0],this.network.edgeColors[a*2*4+1]=l[1],this.network.edgeColors[a*2*4+2]=l[2],this.network.edgeColors[(a*2+1)*4+0]=l[0],this.network.edgeColors[(a*2+1)*4+1]=l[1],this.network.edgeColors[(a*2+1)*4+2]=l[2],l.length>3&&(this.network.edgeColors[(a*2+1)*4+3]=l[3],this.network.edgeColors[(a*2+1)*4+3]=l[3]))}}else{if(typeof e=="number")return[this.network.edgeColors[e*2+0],this.network.edgeColors[e*2+1]];{let r=this.network.index2Node,o=this.network.indexedEdges;for(let a=0;a<o.length/2;a++)r[o[a*2]],r[o[a*2+1]],e.length==2?(this.network.edgeColors[a*2*4+0]=e[0][0],this.network.edgeColors[a*2*4+1]=e[0][1],this.network.edgeColors[a*2*4+2]=e[0][2],this.network.edgeColors[(a*2+1)*4+0]=e[1][0],this.network.edgeColors[(a*2+1)*4+1]=e[1][1],this.network.edgeColors[(a*2+1)*4+2]=e[1][2],e[0].length>3&&(this.network.edgeColors[(a*2+1)*4+3]=e[0][3]),e[1].length>3&&(this.network.edgeColors[(a*2+1)*4+3]=e[1][3])):(this.network.edgeColors[a*2*4+0]=e[0],this.network.edgeColors[a*2*4+1]=e[1],this.network.edgeColors[a*2*4+2]=e[2],this.network.edgeColors[(a*2+1)*4+0]=e[0],this.network.edgeColors[(a*2+1)*4+1]=e[1],this.network.edgeColors[(a*2+1)*4+2]=e[2],e.length>3&&(this.network.edgeColors[(a*2+1)*4+3]=e[3],this.network.edgeColors[(a*2+1)*4+3]=e[3]))}}}else{typeof e=="function"&&e(nodeID,r,this.network);let r=this.network.ID2index[nodeID];e.length==2?(this.network.edgeColors[edgeIndex*2*4+0]=e[0][0],this.network.edgeColors[edgeIndex*2*4+1]=e[0][1],this.network.edgeColors[edgeIndex*2*4+2]=e[0][2],this.network.edgeColors[(edgeIndex*2+1)*4+0]=e[1][0],this.network.edgeColors[(edgeIndex*2+1)*4+1]=e[1][1],this.network.edgeColors[(edgeIndex*2+1)*4+2]=e[1][2],e[0].length>3&&(this.network.edgeColors[(edgeIndex*2+1)*4+3]=e[0][3]),e[1].length>3&&(this.network.edgeColors[(edgeIndex*2+1)*4+3]=e[1][3])):(this.network.edgeColors[edgeIndex*2*4+0]=e[0],this.network.edgeColors[edgeIndex*2*4+1]=e[1],this.network.edgeColors[edgeIndex*2*4+2]=e[2],this.network.edgeColors[(edgeIndex*2+1)*4+0]=e[0],this.network.edgeColors[(edgeIndex*2+1)*4+1]=e[1],this.network.edgeColors[(edgeIndex*2+1)*4+2]=e[2],e.length>3&&(this.network.edgeColors[(edgeIndex*2+1)*4+3]=e[3],this.network.edgeColors[(edgeIndex*2+1)*4+3]=e[3]))}return this}edgeWidth(e,t){if(typeof t>"u"){if(typeof e>"u")return this.network.edgeColors;if(typeof e=="function"){let r=this.network.index2Node,o=this.network.indexedEdges;for(let a=0;a<o.length/2;a++){let i=r[o[a*2]],s=r[o[a*2+1]],l=e(i,s,a,this.network);typeof l=="number"?(this.network.edgeSizes[a*2]=l,this.network.edgeSizes[a*2+1]=l):(this.network.edgeSizes[a*2]=l[0],this.network.edgeSizes[a*2+1]=l[1])}}else{let r=this.network.indexedEdges;for(let o=0;o<r.length/2;o++)typeof e=="number"?(this.network.edgeSizes[o*2]=e,this.network.edgeSizes[o*2+1]=e):(this.network.edgeSizes[o*2]=e[0],this.network.edgeSizes[o*2+1]=e[1])}}else if(typeof e=="function"){let r=this.network.index2Node,o=this.network.indexedEdges,a=r[o[t*2]],i=r[o[t*2+1]],s=e(a,i,t,this.network);typeof s=="number"?(this.network.edgeSizes[t*2]=s,this.network.edgeSizes[t*2+1]=s):(this.network.edgeSizes[t*2]=s[0],this.network.edgeSizes[t*2+1]=s[1])}else typeof e=="number"?(this.network.edgeSizes[t*2]=e,this.network.edgeSizes[t*2+1]=e):(this.network.edgeSizes[t*2]=e[0],this.network.edgeSizes[t*2+1]=e[1]);return this}getProjectedPositions(e){if(e===void 0&&(e=this.network.nodes),e.length>0){this.gl;let t=new Uint32Array(e.length);if(typeof e[0]=="number")for(let s=0;s<e.length;s++)t[s]=e[s];else{t=new Uint32Array(e.length);for(let s=0;s<e.length;s++)t[s]=e[s].index}let r=this.network.positions,o=new Float32Array(e.length*4),[a,i]=this._lastCanvasDimensions;for(let s=0;s<e.length;s++){let l=t[s],u=[r[l*3],r[l*3+1],r[l*3+2],1],h=yr();fs(h,u,this.projectionViewMatrix);let c=1/h[3],f=a/2+h[0]*a*.5*c,d=i/2-h[1]*i*.5*c;o[s*4]=f,o[s*4+1]=d,o[s*4+2]=h[2],o[s*4+3]=h[3]}return o}else return Float32Array(0)}pickPoint(e,t){const r=this.canvasElement.width*this.pickingResolutionRatio,o=this.canvasElement.height*this.pickingResolutionRatio,a=Math.round(e*r/this.canvasElement.clientWidth-.5),i=Math.round(o-t*o/this.canvasElement.clientHeight-.5),s=new Uint8Array(4),l=this.gl;return l.bindFramebuffer(l.FRAMEBUFFER,this.pickingFramebuffer),l.readPixels(a,i,1,1,l.RGBA,l.UNSIGNED_BYTE,s),s[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24)-1}_consolidateCentroids(e,t){for(const[r,o]of e){const a=t.get(r);o[0]/=a,o[1]/=a}}_calculateCentroidForAttribute(e,t,r,o){r.has(e)||(r.set(e,[0,0]),o.set(e,0));const a=r.get(e);a[0]+=t[0],a[1]+=t[1];const i=o.get(e);o.set(e,i+1)}_updateTrackerNodesData(){const e=this.gl,t=this._trackingBufferPixels,r=this._nodesOnScreen;e.bindFramebuffer(e.FRAMEBUFFER,this._trackingFramebuffer),e.readPixels(0,0,this._trackingFramebuffer.size.width,this._trackingFramebuffer.size.height,e.RGBA,e.UNSIGNED_BYTE,t);for(let o=0;o<t.length;o+=4){const a=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+(t[o+3]<<24)-1;r[o/4]=a}}updateAttributeTrackers(e=!1){if(!this._trackingBufferEnabled||Object.keys(this._attributeTrackers).length===0)return this;const t=this._attributeTrackers,r=this._trackingFramebuffer.size.width*this._trackingFramebuffer.size.height,o=this._nodesOnScreen,a=this._pixelXYOnScreen;e||this._updateTrackerNodesData();for(let i in t){const s=t[i],l=s.pixelCounter,u=l.getSortedKeys();s.smoothness;const h=s.minProportion,c=s.calculateCentroid,f=s.centroidPositions,d=s.attribute,v=s.maxLabels,g=new Map,p=new Map,_=performance.now();let E=_-this._trackingLastTime||_;E>1e3&&(E=1e3);const x=Math.exp(-E/300);this._trackingLastTime=_;for(let m=0;m<u.length;m++){u[m];const y=l.get(u[m])*x;if(y>h){if(l.set(u[m],y),c&&f.has(u[m])){const A=f.get(u[m]);A&&(A[0]*=x,A[1]*=x)}}else l.delete(u[m]),c&&f.delete(u[m])}if(d=="index")for(let m=0;m<o.length;m++){const y=o[m];if(y>=0){const A=(l.get(y)||0)+1/r*(1-x);l.set(y,A),c&&this._calculateCentroidForAttribute(y,a[m],g,p)}}else if(d=="node")for(let m=0;m<o.length;m++){const y=this.network.index2Node;if(nodeIndex>=0){const A=y[nodeIndex],k=(l.get(A)||0)+1/r*(1-x);l.set(A,k),c&&this._calculateCentroidForAttribute(A,a[m],g,p)}}else if(typeof d=="function"){const m=this.network.index2Node;for(let y=0;y<o.length;y++){const A=o[y];if(A>=0){const k=m[A],C=d(k,A),R=(l.get(C)||0)+1/r*(1-x);l.set(C,R),c&&this._calculateCentroidForAttribute(C,a[y],g,p)}}}else{const m=this.network.index2Node;for(let y=0;y<o.length;y++){const A=o[y];if(A>=0){const k=m[A][d],C=(l.get(k)||0)+1/r*(1-x);l.set(k,C),c&&this._calculateCentroidForAttribute(k,a[y],g,p)}}}if(c){this._consolidateCentroids(g,p);for(let[m,y]of g){const A=f.get(m),k=y;A?(A[0]+=k[0]*(1-x),A[1]+=k[1]*(1-x)):f.set(m,k)}}if(v>=0){let m=l.getSortedKeys(),y=m.slice(v,m.length);for(let A=0;A<y.length;A++)l.delete(y[A]),f.delete(y[A])}}return this}trackedAttributesOnScreen(e){if(this._trackingBufferEnabled&&this._attributeTrackers[e]){const t=this._attributeTrackers[e],r=t.pixelCounter;if(t.calculateCentroid){const o=t.centroidPositions,a=r.getSortedPairs();for(let i=0;i<a.length;i++){const s=a[i][0],l=a[i][1],u=o.get(s);a[i]=[s,l,u[0],u[1]]}return a}else return r.getSortedPairs()}}trackedAttributesCentroids(e){if(this._trackingBufferEnabled&&this._attributeTrackers[e])return this._attributeTrackers[e].centroidPositions}_updateTrackerScheduleTask(){const e="9.5.tracker_update";!this._trackingBufferEnabled||Object.keys(this._attributeTrackers).length===0?this.scheduler.hasTask(e)&&this.scheduler.unschedule(e):this.scheduler.hasTask(e)||this.scheduler.schedule({name:e,callback:(t,r)=>{this.updateAttributeTrackers(!0);for(let o in this._attributeTrackers){const a=this._attributeTrackers[o];a.onTrack&&a.onTrack(this.trackedAttributesOnScreen(o),a)}},delay:0,repeatInterval:this._trackingNodeMinimumUpdateInterval,repeat:!0,synchronized:!0,afterRedraw:!0,immediateUpdates:!1,redraw:!1,updateNodesGeometry:!1,updateEdgesGeometry:!1})}trackAttribute(e,t,{minProportion:r=.001,smoothness:o=.8,maxLabels:a=20,calculateCentroid:i=!1,onTrack:s=null}={}){return e in this._attributeTrackers&&this.untrackAttribute(e),this._attributeTrackers[e]={attribute:t,pixelCounter:new Al(!1),minProportion:r,smoothness:o,maxLabels:a,calculateCentroid:i,centroidPositions:new Map,onTrack:s},this._updateTrackerScheduleTask(),this}untrackAttribute(e){return this._attributeTrackers=this._attributeTrackers.filter(t=>t.attribute!==e),this._updateTrackerScheduleTask(),this}attributesTrackers(){return Object.assign({},this._attributeTrackers)}trackingBufferUpdateInterval(e){return typeof e>"u"?this._trackingBufferUpdateInterval:(this._trackingBufferUpdateInterval=e,this._updateTrackerScheduleTask(),this)}trackingUpdateInterval(e){return typeof e>"u"?this._trackingUpdateInterval:(this._trackingUpdateInterval=e,this._updateTrackerScheduleTask(),this)}edgesGlobalOpacityScale(e){return typeof e>"u"?this._edgesGlobalOpacityScale:(this._edgesGlobalOpacityScale=e,this)}edgesGlobalOpacityBase(e){return typeof e>"u"?this._edgesGlobalOpacityBase:(this._edgesGlobalOpacityBase=e,this)}edgesGlobalWidthScale(e){return typeof e>"u"?this._edgesGlobalWidthScale:(this._edgesGlobalWidthScale=e,this)}edgesGlobalWidthBase(e){return typeof e>"u"?this._edgesGlobalWidthBase:(this._edgesGlobalWidthBase=e,this)}nodesGlobalOpacityScale(e){return typeof e>"u"?this._nodesGlobalOpacityScale:(this._nodesGlobalOpacityScale=e,this)}nodesGlobalOpacityBase(e){return typeof e>"u"?this._nodesGlobalOpacityBase:(this._nodesGlobalOpacityBase=e,this)}nodesGlobalSizeScale(e){return typeof e>"u"?this._nodesGlobalSizeScale:(this._nodesGlobalSizeScale=e,this)}nodesGlobalSizeBase(e){return typeof e>"u"?this._nodesGlobalSizeBase:(this._nodesGlobalSizeBase=e,this)}nodesGlobalOutlineWidthScale(e){return typeof e>"u"?this._nodesGlobalOutlineWidthScale:(this._nodesGlobalOutlineWidthScale=e,this)}nodesGlobalOutlineWidthBase(e){return typeof e>"u"?this._nodesGlobalOutlineWidthBase:(this._nodesGlobalOutlineWidthBase=e,this)}nodeOpacity(e){if(typeof e>"u")return this.network.colors.map(t=>t[3]);if(typeof e=="function"){let t=this.network.index2Node;for(let r=0;r<t.length;r++){let o=t[r],a=e(o,r,this.network);this.network.colors[r*4+3]=a}}else for(let t=0;t<allNodes.length;t++)this.network.colors[t*4+3]=e;return this}edgesColorsFromNodes(e){return typeof e>"u"?this._edgesColorsFromNodes:(this._edgesColorsFromNodes=e,this)}edgesWidthFromNodes(e){return typeof e>"u"?this._edgesWidthFromNodes:(this._edgesWidthFromNodes=e,this)}additiveBlending(e){return typeof e>"u"?this.useAdditiveBlending:(this.useAdditiveBlending=e,this)}shadedNodes(e){return typeof e>"u"?this.useShadedNodes:(this.useShadedNodes=e,this)}pickeableEdges(e){if(typeof e>"u")return this._pickeableEdges;if(this._pickeableEdges=new Set(e),e=="all"){for(let t=0;t<this.network.edges.length;t++)this._pickeableEdges.add(t);this._edgeIndicesUpdate=!0,this.update()}else this._edgeIndicesUpdate=!0,this.update();return this}labelsMaxPixels(e){return typeof e>"u"?this._trackingMaxPixels:(this._trackingMaxPixels=e,_willResizeEvent(0),this)}cleanup(e){var r,o;this.isReady=!1,this.layoutWorker.cleanup(),this.scheduler.stop(),this.layoutWorker=null;const t=this.gl;if(this.onReadyCallback=null,this.onNodeClickCallback=null,this.onNodeDoubleClickCallback=null,this.onNodeHoverStartCallback=null,this.onNodeHoverMoveCallback=null,this.onNodeHoverEndCallback=null,this.onEdgeClickCallback=null,this.onEdgeDoubleClickCallback=null,this.onEdgeHoverStartCallback=null,this.onEdgeHoverMoveCallback=null,this.onEdgeHoverEndCallback=null,this.onZoomCallback=null,this.onRotationCallback=null,this.onResizeCallback=null,this.onLayoutStartCallback=null,this.onLayoutStopCallback=null,this.onDrawCallback=null,this.onReadyCallback=null,this.isReady=!1,this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this.canvasElement&&(this.canvasElement.removeEventListener("click",this._clickEventListener),this.canvasElement.removeEventListener("dblclick",this._doubleClickEventListener),this.canvasElement.removeEventListener("mousemove",this._hoverMoveEventListener),this.canvasElement.removeEventListener("mouseleave",this._hoverLeaveEventListener),document.body.removeEventListener("mouseout",this._hoverLeaveWindowEventListener)),!e&&t){let a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);(r=this.pickingFramebuffer)==null||r.discard(),(o=this._trackingFramebuffer)==null||o.discard();for(let i=0;i<a;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,null),t.bindTexture(t.TEXTURE_CUBE_MAP,null);t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteBuffer(this.nodesPositionBuffer),t.deleteBuffer(this.nodesColorBuffer),t.deleteBuffer(this.nodesSizeBuffer),t.deleteBuffer(this.nodesSizeBuffer),t.deleteBuffer(this.nodesOutlineWidthBuffer),t.deleteBuffer(this.nodesOutlineColorBuffer),t.deleteBuffer(this.nodesIndexBuffer),this.edgesGeometry&&(t.deleteBuffer(this.edgesGeometry.edgeVertexTypeBuffer),t.deleteBuffer(this.edgesGeometry.verticesBuffer),t.deleteBuffer(this.edgesGeometry.colorBuffer),t.deleteBuffer(this.edgesGeometry.sizeBuffer)),this.fastEdgesGeometry&&(t.deleteBuffer(this.fastEdgesGeometry.indexBuffer),t.deleteBuffer(this.fastEdgesGeometry.vertexObject),t.deleteBuffer(this.fastEdgesGeometry.colorObject),t.deleteBuffer(this.fastEdgesGeometry.indexObject))}this.densityMap&&this.densityMap.cleanup(),this._autoCleanup&&(this._mutationObserver.disconnect(),this._mutationObserver=null),this.canvasElement&&(this.canvasElement.remove(),this.canvasElement=null),this._hasCleanup=!0}destroy(){this._hasCleanup||this.cleanup()}}let xr={0:{faction:1},1:{faction:1},2:{faction:1},3:{faction:1},4:{faction:1},5:{faction:1},6:{faction:1},7:{faction:1},8:{faction:2},9:{faction:2},10:{faction:1},11:{faction:1},12:{faction:1},13:{faction:1},14:{faction:2},15:{faction:2},16:{faction:1},17:{faction:1},18:{faction:2},19:{faction:1},20:{faction:2},21:{faction:1},22:{faction:2},23:{faction:2},24:{faction:2},25:{faction:2},26:{faction:2},27:{faction:2},28:{faction:2},29:{faction:2},30:{faction:2},31:{faction:2},32:{faction:2},33:{faction:2}},wl=[{source:"0",target:"1"},{source:"0",target:"2"},{source:"0",target:"3"},{source:"0",target:"4"},{source:"0",target:"5"},{source:"0",target:"6"},{source:"0",target:"7"},{source:"0",target:"8"},{source:"0",target:"10"},{source:"0",target:"11"},{source:"0",target:"12"},{source:"0",target:"13"},{source:"0",target:"17"},{source:"0",target:"19"},{source:"0",target:"21"},{source:"0",target:"31"},{source:"1",target:"2"},{source:"1",target:"3"},{source:"1",target:"7"},{source:"1",target:"13"},{source:"1",target:"17"},{source:"1",target:"19"},{source:"1",target:"21"},{source:"1",target:"30"},{source:"2",target:"3"},{source:"2",target:"7"},{source:"2",target:"8"},{source:"2",target:"9"},{source:"2",target:"13"},{source:"2",target:"27"},{source:"2",target:"28"},{source:"2",target:"32"},{source:"3",target:"7"},{source:"3",target:"12"},{source:"3",target:"13"},{source:"4",target:"6"},{source:"4",target:"10"},{source:"5",target:"6"},{source:"5",target:"10"},{source:"5",target:"16"},{source:"6",target:"16"},{source:"8",target:"30"},{source:"8",target:"32"},{source:"8",target:"33"},{source:"9",target:"33"},{source:"13",target:"33"},{source:"14",target:"32"},{source:"14",target:"33"},{source:"15",target:"32"},{source:"15",target:"33"},{source:"18",target:"32"},{source:"18",target:"33"},{source:"19",target:"33"},{source:"20",target:"32"},{source:"20",target:"33"},{source:"22",target:"32"},{source:"22",target:"33"},{source:"23",target:"25"},{source:"23",target:"27"},{source:"23",target:"29"},{source:"23",target:"32"},{source:"23",target:"33"},{source:"24",target:"25"},{source:"24",target:"27"},{source:"24",target:"31"},{source:"25",target:"31"},{source:"26",target:"29"},{source:"26",target:"33"},{source:"27",target:"33"},{source:"28",target:"31"},{source:"28",target:"33"},{source:"29",target:"32"},{source:"29",target:"33"},{source:"30",target:"32"},{source:"30",target:"33"},{source:"31",target:"32"},{source:"31",target:"33"},{source:"32",target:"33"}],xl=[.23,.45,.68],El=[.7,.78,.9];Object.values(xr).forEach(n=>{n.color=n.faction==1?xl:El});let Xe=new _l({elementID:"netviz",nodes:xr,edges:wl,use2D:!1});Xe.backgroundColor([0,0,0,1]);Xe.nodesGlobalSizeScale(.5);Xe.edgesGlobalOpacityScale(.75);Xe.edgesGlobalWidthScale(.1);Xe.zoomFactor(20)});export default kl();
